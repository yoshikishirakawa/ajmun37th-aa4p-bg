<script>
  (function () {
    try {
      var storedTheme = localStorage.getItem('quarto-theme');
      if (!storedTheme || storedTheme === 'auto') return;
      document.documentElement.setAttribute('data-theme', storedTheme);
      var applyThemeToBody = function () {
        if (!document.body) {
          requestAnimationFrame(applyThemeToBody);
          return;
        }
        document.body.setAttribute('data-theme', storedTheme);
      };
      applyThemeToBody();
    } catch (err) {
      console.warn('Failed to apply stored theme early', err);
    }
  })();
</script>
<div class="header-ui">
  <div id="js-header" class="js-header">
    <div class="js-header__inner">
      <div class="js-header__left">
        <div class="js-header__logo">
          <span class="js-header__title"><span class="title-main">平和への課題：補遺</span><span class="title-sub">Background Guide</span></span>
        </div>
      </div>
      <div class="js-header__right">
        <div class="js-header__controls">
          <!-- 設定メニューボタン -->
          <button class="js-settings-toggle-btn" id="settings-toggle-btn" aria-label="設定メニューを開く">
            <span class="settings-toggle-icon" aria-hidden="true"></span>
            <span class="settings-toggle-text">表示設定</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 格納型設定メニュー -->
  <div class="settings-menu" id="settings-menu">
    <div class="settings-menu__inner">
      <div class="settings-menu__header">
        <h3>表示設定</h3>
        <button class="settings-menu__close" id="settings-menu-close">×</button>
      </div>
      <div class="settings-menu__content">
        <!-- 文字サイズ -->
        <div class="settings-item">
          <label for="font-size-select">文字サイズ：</label>
          <select class="js-font-size-select" id="font-size-select" aria-label="文字サイズ">
            <option value="3XS">3XS</option>
            <option value="2XS">2XS</option>
            <option value="XS">XS</option>
            <option value="S">S</option>
            <option value="M" selected>M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
          </select>
        </div>
        
        <!-- テーマ切替 -->
        <div class="settings-item">
          <label for="theme-select">テーマ：</label>
          <select class="js-theme-select" id="theme-select" aria-label="テーマ">
            <option value="light">ライト</option>
            <option value="dark">ダーク</option>
            <option value="auto">自動</option>
          </select>
        </div>
        
        <!-- コメント機能 -->
        <div class="settings-divider"></div>
        <div class="settings-section-title">コメント機能</div>
        <div class="settings-item">
          <button class="js-comments-export-page" id="comments-export-page">コメント出力(このページ)</button>
        </div>
        <div class="settings-item">
          <button class="js-comments-export-all" id="comments-export-all">全コメント出力</button>
        </div>
        <div class="settings-item">
          <label for="comments-import" class="js-comments-import-label">コメント読込：</label>
          <input type="file" id="comments-import" class="js-comments-import" accept="application/json" style="display:none;">
          <button class="js-comments-import-button" id="comments-import-button">ファイル選択</button>
        </div>
        
        <!-- プレビューのトースト表示数 -->
        <div class="settings-item">
          <label for="gdoc-toast-max">プレビューのトースト数：</label>
          <input type="range" id="gdoc-toast-max" min="0" max="9" value="3" aria-label="プレビューのトースト数">
          <span id="gdoc-toast-max-value">3</span>
        </div>

        <!-- 各種設定リセット -->
        <div class="settings-divider"></div>
        <div class="settings-section-title">リセット</div>
        <div class="settings-item settings-item--reset-buttons">
          <button type="button" id="reset-ui-settings">UI系をリセット</button>
          <button type="button" id="reset-memo-settings">メモ系をリセット</button>
          <button type="button" id="reset-preview-settings">プレビューをリセット</button>
          <button type="button" id="reset-all-settings">すべてをリセット</button>
        </div>
      </div>
    </div>
  </div>
  <div class="settings-menu-overlay" id="settings-menu-overlay"></div>
</div>

<div class="toc-overlay">
  <div class="toc-overlay__backdrop"></div>
  <div class="toc-sheet">
    <div class="toc-sheet__header">
      <h3>ナビゲーション</h3>
      <button class="toc-sheet__close">×</button>
    </div>
    <div class="toc-sheet__content">
      <!-- 左パネル相当の内容はJavaScriptで生成 -->
    </div>
  </div>
</div>
