<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>第6章　国連の制度 – 平和への課題：補遺</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../content/07_ch07.html" rel="next">
<link href="../content/05_ch05.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d2604bcb90b21ac6bc3164282300c13a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "一致なし",
    "search-matching-documents-text": "一致した文書",
    "search-copy-link-title": "検索へのリンクをコピー",
    "search-hide-matches-text": "追加の検索結果を非表示",
    "search-more-match-text": "追加の検索結果",
    "search-more-matches-text": "追加の検索結果",
    "search-clear-button-title": "消去",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "検索",
    "search-label": "サーチ"
  }
}</script>
<style>
  :root {
    --sidebar-width: 280px;
    --margin-width: 150px;
    --gutter-width: 12px;
  }
</style>
<style>
  :root {
    --sidebar-width: 280px;
    --margin-width: 150px;
    --gutter-width: 12px;
  }
</style>
<link rel="preload" href="../fonts/BIZUDPMincho-Regular.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../fonts/BIZUDPMincho-Bold.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../fonts/BIZUDPGothic-Regular.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../fonts/BIZUDPGothic-Bold.woff2" as="font" type="font/woff2" crossorigin="">


<link rel="stylesheet" href="../src/css/font-udpmincho.css">
<link rel="stylesheet" href="../src/css/base.css">
<link rel="stylesheet" href="../src/css/simple-theme.css">
<link rel="stylesheet" href="../src/css/right-panel.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../content/06_ch06.html"><span class="chapter-title">第6章　国連の制度</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="サーチ" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">平和への課題：補遺</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="サーチ"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">AJMUN 37th 平和への課題：補遺</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/00_front.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">フロント挨拶</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/01_ch01.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">第1章 プロジェクトの概要</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/02_ch02.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">第2章 技術的課題と解決策</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/03_ch03.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">第3章 実装方針</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/20_col01.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">コラム1：Webフォントの歴史</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/21_col02.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">コラム2：アクセシビリティの重要性</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/04_ch04.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">第4章 UI/UX設計</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/05_ch05.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">第5章 パフォーマンス最適化</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/06_ch06.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">第6章　国連の制度</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/07_ch07.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">第7章 まとめと展望</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/22_col03.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">コラム3：今後の技術動向</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/90_afterword.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">編集後記</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/95_references.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">参考文献</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/96_index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">索引</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#はじめに" id="toc-はじめに" class="nav-link active" data-scroll-target="#はじめに"><strong>はじめに</strong></a></li>
  <li><a href="#第1節-国連という組織" id="toc-第1節-国連という組織" class="nav-link" data-scroll-target="#第1節-国連という組織"><strong>第1節　国連という組織</strong></a>
  <ul class="collapse">
  <li><a href="#第1項-概要組織構造" id="toc-第1項-概要組織構造" class="nav-link" data-scroll-target="#第1項-概要組織構造">第1項　概要・組織構造</a></li>
  <li><a href="#第2項-安全保障理事会06_ch06-5" id="toc-第2項-安全保障理事会06_ch06-5" class="nav-link" data-scroll-target="#第2項-安全保障理事会06_ch06-5">第2項　安全保障理事会[^06_ch06-5]</a></li>
  <li><a href="#第3項-国連の紛争対処" id="toc-第3項-国連の紛争対処" class="nav-link" data-scroll-target="#第3項-国連の紛争対処">第3項 国連の紛争対処</a></li>
  <li><a href="#第4項-安保理決議に基づく義務" id="toc-第4項-安保理決議に基づく義務" class="nav-link" data-scroll-target="#第4項-安保理決議に基づく義務">第4項　安保理決議に基づく義務</a></li>
  </ul></li>
  <li><a href="#コラム-安保理決議の拘束力" id="toc-コラム-安保理決議の拘束力" class="nav-link" data-scroll-target="#コラム-安保理決議の拘束力"><strong>コラム　安保理決議の拘束力</strong></a></li>
  <li><a href="#第2節-国連財政" id="toc-第2節-国連財政" class="nav-link" data-scroll-target="#第2節-国連財政"><strong>第2節　国連財政</strong></a>
  <ul class="collapse">
  <li><a href="#第2項-pko予算" id="toc-第2項-pko予算" class="nav-link" data-scroll-target="#第2項-pko予算">第2項　PKO予算</a></li>
  </ul></li>
  <li><a href="#第3節-国連による経済制裁" id="toc-第3節-国連による経済制裁" class="nav-link" data-scroll-target="#第3節-国連による経済制裁"><strong>第3節 国連による経済制裁</strong></a>
  <ul class="collapse">
  <li><a href="#第1項-国際連合憲章における経済制裁措置" id="toc-第1項-国際連合憲章における経済制裁措置" class="nav-link" data-scroll-target="#第1項-国際連合憲章における経済制裁措置">第1項　国際連合憲章における経済制裁措置</a></li>
  <li><a href="#第2項-冷戦下の経済制裁-対南ローデシア制裁と対南アフリカ制裁" id="toc-第2項-冷戦下の経済制裁-対南ローデシア制裁と対南アフリカ制裁" class="nav-link" data-scroll-target="#第2項-冷戦下の経済制裁-対南ローデシア制裁と対南アフリカ制裁">第2項　冷戦下の経済制裁　対南ローデシア制裁と対南アフリカ制裁</a></li>
  <li><a href="#第3項-冷戦後の経済制裁" id="toc-第3項-冷戦後の経済制裁" class="nav-link" data-scroll-target="#第3項-冷戦後の経済制裁">第3項 冷戦後の経済制裁</a></li>
  <li><a href="#第3項-経済制裁に伴う問題とその後" id="toc-第3項-経済制裁に伴う問題とその後" class="nav-link" data-scroll-target="#第3項-経済制裁に伴う問題とその後">第3項 経済制裁に伴う問題とその後</a></li>
  <li><a href="#第4項-国連憲章第50条の注解第二校" id="toc-第4項-国連憲章第50条の注解第二校" class="nav-link" data-scroll-target="#第4項-国連憲章第50条の注解第二校">第4項 国連憲章第50条の注解（第二校）</a></li>
  </ul></li>
  <li><a href="#第4節-国連平和維持活動pko" id="toc-第4節-国連平和維持活動pko" class="nav-link" data-scroll-target="#第4節-国連平和維持活動pko"><strong>第4節 国連平和維持活動(PKO)</strong></a></li>
  <li><a href="#参考文献" id="toc-参考文献" class="nav-link" data-scroll-target="#参考文献"><strong>参考文献</strong></a>
  <ul class="collapse">
  <li><a href="#第1節" id="toc-第1節" class="nav-link" data-scroll-target="#第1節">第1節</a></li>
  <li><a href="#第2節" id="toc-第2節" class="nav-link" data-scroll-target="#第2節">第2節</a></li>
  <li><a href="#第3節" id="toc-第3節" class="nav-link" data-scroll-target="#第3節">第3節</a></li>
  <li><a href="#第4節" id="toc-第4節" class="nav-link" data-scroll-target="#第4節">第4節</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<div class="header-ui">
  <!-- ハンバーガーメニューボタン（左上常設） -->
  <button class="hamburger-menu-btn" id="hamburger-menu-btn" aria-label="メニューを開く" aria-expanded="false" aria-controls="hamburger-menu-panel">
    <span class="hamburger-menu-icon">
      <span></span>
      <span></span>
      <span></span>
    </span>
  </button>

  <!-- ハンバーガーメニュー（展開パネル） -->
  <div id="hamburger-menu-panel" class="hamburger-menu-panel" role="menu">
    <div class="hamburger-menu-content">
      <!-- メニュー項目はJavaScriptで生成 -->
    </div>
    <div class="hamburger-menu-notch"></div>
  </div>
  <div class="hamburger-menu-overlay" id="hamburger-menu-overlay"></div>

  <div id="js-header" class="js-header">
    <div class="js-header__inner">
      <div class="js-header__left">
        <div class="js-header__logo">
          <span class="js-header__title">平和への課題：補遺</span>
        </div>
      </div>
      <div class="js-header__right">
        <div class="js-header__controls">
          <!-- モバイル用目次ボタン -->
          <button class="js-toc-mobile-btn" id="toc-mobile-btn" aria-label="目次">☰</button>
          
          <!-- 設定メニューボタン -->
          <button class="js-settings-toggle-btn" id="settings-toggle-btn" aria-label="設定メニューを開く">⚙️</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 格納型設定メニュー -->
  <div class="settings-menu" id="settings-menu">
    <div class="settings-menu__inner">
      <div class="settings-menu__header">
        <h3 class="anchored">表示設定</h3>
        <button class="settings-menu__close" id="settings-menu-close">×</button>
      </div>
      <div class="settings-menu__content">
        <!-- 文字サイズ -->
        <div class="settings-item">
          <label for="font-size-select">文字サイズ：</label>
          <select class="js-font-size-select" id="font-size-select" aria-label="文字サイズ">
            <option value="XS">XS</option>
            <option value="S">S</option>
            <option value="M" selected="">M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
          </select>
        </div>
        
        <!-- テーマ切替 -->
        <div class="settings-item">
          <label for="theme-select">テーマ：</label>
          <select class="js-theme-select" id="theme-select" aria-label="テーマ">
            <option value="light">ライト</option>
            <option value="dark">ダーク</option>
            <option value="auto">自動</option>
          </select>
        </div>
        
        <!-- コメント機能 -->
        <div class="settings-divider"></div>
        <div class="settings-section-title">コメント機能</div>
        <div class="settings-item">
          <button class="js-comments-export-page" id="comments-export-page">コメント出力(このページ)</button>
        </div>
        <div class="settings-item">
          <button class="js-comments-export-all" id="comments-export-all">全コメント出力</button>
        </div>
        <div class="settings-item">
          <label for="comments-import" class="js-comments-import-label">コメント読込：</label>
          <input type="file" id="comments-import" class="js-comments-import" accept="application/json" style="display:none;">
          <button class="js-comments-import-button" id="comments-import-button">ファイル選択</button>
        </div>
      </div>
    </div>
  </div>
  <div class="settings-menu-overlay" id="settings-menu-overlay"></div>
</div>

<div class="toc-overlay">
  <div class="toc-overlay__backdrop"></div>
  <div class="toc-sheet">
    <div class="toc-sheet__header">
      <h3 class="anchored">目次</h3>
      <button class="toc-sheet__close">×</button>
    </div>
    <div class="toc-sheet__content">
      <!-- 目次はJavaScriptで生成 -->
    </div>
  </div>
</div>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">第6章　国連の制度</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに"><strong>はじめに</strong></h2>
<p>本章では国連の制度と題して、第1節で国連の組織構造や各種主要機関の役割、第2節で国連財政、第3節で経済制裁の仕組みと事例、第4節でPKOの仕組みを解説する。第1節は以降のセクションや本BGの他のセクションに必要な基礎的な知識を具備することを目的とした、教科書的内容である。第2節は本会議における明示的に設定された争点ではないものの種々の措置への各国の利益設定や実現可能性に影響する要素としての国連財政のシステムや1995年当時の状況を把握してもらうことを目的としている。そして第3節や第4節では、本会議の論点であるPKOと経済制裁が実際にどのようなものでありどのようなプロセスで実施されるものであるかを確認した上で、当時における問題意識を把握してもらうことを目的としている。</p>
<p>本章は全体として少々文量が多い上に、非常に教科書的内容に近いため直接的に議論や国益設定を導くものではないが、「欠かすことのできない要素を頭の隅に留めておく」くらいの力加減で把握してもらえると良いだろう。</p>
<p>安保理の限界は103条とか25条とかのからみで<br>
第三国被害の補償と集団安全保障の負担の共有は49条や50条で</p>
</section>
<section id="第1節-国連という組織" class="level2">
<h2 class="anchored" data-anchor-id="第1節-国連という組織"><strong>第1節　国連という組織</strong></h2>
<p>本節では第1項にて国連の目的や原則等の基本的事柄や全体的な組織構造を、第2項にて今回の議場である安全保障理事会の概要を、第3項にて国連とりわけ安全保障理事会がとりうる紛争への対処として憲章6章(紛争の平和的解決), 7章(平和に対する脅威)前半を、第4項にて集団行動に対する協力義務として憲章48~50条を解説する。</p>
<section id="第1項-概要組織構造" class="level3">
<h3 class="anchored" data-anchor-id="第1項-概要組織構造">第1項　概要・組織構造</h3>
<p>国際連合は国連憲章を設立根拠とする地球上で最も多くの加盟国をもち、最も強大な権限を持つ組織である。<br>
その目的と原則は国連憲章の第1条と第2条に記されている。</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">国連憲章<br>第1条 国際連合の目的は、次のとおりである。 国際の平和及び安全を維持すること。そのために、平和に対する脅威の防止及び除去と侵略行為その他の平和の破壊の鎮圧とのため有効な集団的措置をとること並びに平和を破壊するに至る虞のある国際的の紛争又は事態の調整又は解決を平和的手段によって且つ正義及び国際法の原則に従って実現すること。 人民の同権及び自決の原則の尊重に基礎をおく諸国間の友好関係を発展させること並びに世界平和を強化するために他の適当な措置をとること。 経済的、社会的、文化的又は人道的性質を有する国際問題を解決することについて、並びに人種、性、言語又は宗教による差別なくすべての者のために人権及び基本的自由を尊重するように助長奨励することについて、国際協力を達成すること。 これらの共通の目的の達成に当って諸国の行動を調和するための中心となること。 第2条 この機構及びその加盟国は、第1条に掲げる目的を達成するに当っては、次の原則に従って行動しなければならない。 この機構は、そのすべての加盟国の主権平等の原則に基礎をおいている。 すべての加盟国は、加盟国の地位から生ずる権利及び利益を加盟国のすべてに保障するために、この憲章に従って負っている義務を誠実に履行しなければならない。 すべての加盟国は、その国際紛争を平和的手段によって国際の平和及び安全並びに正義を危くしないように解決しなければならない。 すべての加盟国は、その国際関係において、武力による威嚇又は武力の行使を、いかなる国の領土保全又は政治的独立に対するものも、また、国際連合の目的と両立しない他のいかなる方法によるものも慎まなければならない。 すべての加盟国は、国際連合がこの憲章に従ってとるいかなる行動についても国際連合にあらゆる援助を与え、且つ、国際連合の防止行動又は強制行動の対象となっているいかなる国に対しても援助の供与を慎まなければならない。 この機構は、国際連合加盟国でない国が、国際の平和及び安全の維持に必要な限り、これらの原則に従って行動することを確保しなければならない。 この憲章のいかなる規定も、本質上いずれかの国の国内管轄権内にある事項に干渉する権限を国際連合に与えるものではなく、また、その事項をこの憲章に基く解決に付託することを加盟国に要求するものでもない。但し、この原則は、第7章に基く強制措置の適用を妨げるものではない。</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>第1条では国連の4つの主要な目的をおおまかに次の様に定めている。</p>
<ol type="1">
<li>国際の平和と安全の維持<br>
</li>
<li>人民の同権と自決の原則に基づく諸国家間の友好関係の発展<br>
</li>
<li>経済社会文化人道的問題の解決と人権及び基本的自由の尊重のための国際協力の達成<br>
</li>
<li>これらの目的の達成にあたっての各国の行動を調和させる中心となること</li>
</ol>
<p>また、第2条においてはおおまかに次のような内容を定めている。</p>
<ol type="1">
<li>主権平等の原則<br>
</li>
<li>憲章に従って負う義務の誠実な履行<br>
</li>
<li>紛争の平和的解決義務<br>
</li>
<li>武力不行使原則<br>
</li>
<li>国連が取る措置への援助義務・防止行動や阻止行動への協力義務<br>
</li>
<li>国連非加盟国への協力要請<br>
</li>
<li>国連機構による加盟国の国内管轄事項への不干渉(国内管轄事項不干渉原則[^06_ch06-1])</li>
</ol>
<p>国連憲章を基礎とする国連システムでは特に1条の目的のための各種機関への協力[^06_ch06-2]や、</p>
<p>これら第1条に定められた目的や第2条の原則を実現するにあたって国連は総会・安全保障理事会・経済社会理事会・信託統治理事会・国際司法裁判所・事務局の6つの主要機関を中心とする国連システムを擁している(7条)。</p>
<p>このうちの総会は<strong>すべての加盟国によって構成され</strong>(9条)、憲章の範囲内にある問題や事柄など事実上すべての事柄を討議することができる(10条)。また、安全保障理事会が同じ議題を扱っていない限り[^06_ch06-3](12条)、総会はその討議の結果として法的拘束力を有しない勧告を加盟国や安保理に発することができる(10条)。総会はその性質からあらゆる議題に関して、世界のほとんどすべての国が集った状態で議論を行える外交フォーラム的性質を持つと言える。<br>
総会は第1委員会から第6委員会までの主要委員会をはじめとして各種の下部機関を持つ。本会議において出てくる可能性があるのは以下の通りだろう。</p>
<p>第5委員会：国連の行財政（第4節の国連財政にて詳述する。）<br>
第6委員会：国際法規の整備や国際法の法典化<br>
集団措置特別委員会：総会決議377A(いわゆる平和のための結集決議)により設立<br>
平和維持活動に関する特別委員会：総会決議2006により設立<br>
国連憲章およびその役割の強化に関する特別委員会：総会決議3349により設立</p>
<p>これら各種委員会は総会決議などによって設定された議題を公開ないし非公開会合の形で議論し、報告書や決議、決定の形で総会の全体会議に勧告を行う機能を持つ。また、権限の競合については、経済社会理事会や信託統治理事会との間では総会が優越するが、安全保障理事会との間では総会は副次的な役割にとどまる。</p>
<p>これら総会やその他機関における会議の事務的サポートや情報提供、ひいては限定的であるとはいえ社会経済分野の支援活動やPKOなどの政治的行動など国連の超国家的な活動を実際に行う主体となるものが国連事務局(UN Secretariat)である。そのうちの一部の局をここで紹介する。<br>
行政管理局：国連の財務・人事・総務および外交フォーラム提供のための会議サービスを実施する<br>
国連政治局：差し迫った危機に関して総会や安保理へ警告するための情報の収集・分析を行う他、紛争における小規模な仲介などの介入活動を行う。安保理や総会の議題決定支援や決議案・声明案の起草支援を行う。<br>
平和維持活動局[^06_ch06-4]：名前の通りPKOの活動を監督する。軍事顧問団やロジスティクスを行う作戦部(FOD), などからなる。ガリによる国連機構改革によって新設された。<br>
この他にも国連事務局には軍縮局や総会・会議サービス局、広報局、経営管理局、内務監視サービス局、法務局などが存在し、巨大な官僚機構を構成している。</p>
</section>
<section id="第2項-安全保障理事会06_ch06-5" class="level3">
<h3 class="anchored" data-anchor-id="第2項-安全保障理事会06_ch06-5">第2項　安全保障理事会[^06_ch06-5]</h3>
<section id="概要" class="level4">
<h4 class="anchored" data-anchor-id="概要"><strong>概要</strong></h4>
<p>安全保障理事会は憲章1条1項に定めるところの国連の目的である”国際の平和と安全の維持”のための機関である。そのために安全保障理事会は15カ国からなる理事国が集権的に広い裁量のもとで国際の平和と安全のための措置に関する決定をおこなう。そのために安全保障理事会は①国連システムのなかで<strong>他の機関に対して優越した権限をもち</strong>(24条)、②加盟国に対して<strong>法的拘束力を持つ決定を行うことができ</strong>(25条)、③平和的手段(6章)に限らず<strong>制裁や軍事的措置といった強制措置(7章)を実施でき</strong>、④<strong>いかなる紛争・自体に対して介入するかを安保理自身が自律的に決定できる</strong>(34, 39条)など特権的立場を有している。</p>
<p>安保理の任務や与えられた権限については憲章の24条や25条に定められている。</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">国連憲章<br>第24条 国際連合の迅速且つ有効な行動を確保するために、国際連合加盟国は、国際の平和及び安全の維持に関する主要な責任(primary responsibility)を安全保障理事会に負わせるものとし、且つ、安全保障理事会がこの責任に基く義務を果すに当って加盟国に代って行動することに同意する。 前記の義務を果すに当たっては、安全保障理事会は、国際連合の目的及び原則に従って行動しなければならない。この義務を果すために安全保障理事会に与えられる特定の権限は、第6章、第7章、第8章及び第12章で定める。 安全保障理事会は、年次報告を、また、必要があるときは特別報告を総会に審議のため提出しなければならない。 第25条 国際連合加盟国は、安全保障理事会の決定をこの憲章に従って受諾し且つ履行することに同意する。</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>安全保障理事会は国連加盟国から紛争への介入行動についての責任を付託され国際社会の名において介入を行う。国連の中立性や普遍性を背景として国際社会全体を代表する公的性格を持たせていることが、安保理の介入行動に政治的・法的正当性が付与されているといえる。「安保理の決定を国際社会の大多数の国、あるいは多くの有力な国が支持し、国際世論が指示している」という政治的事実による政治的正当性と、「安保理の決定がその地位と権限を定めた国連憲章に照らして適法である」との法的事実による法的正当性の2つが安保理の正当性を支えている。<br>
まとめると安保理の果たす役割とは、憲章などによる<strong>法的正当性</strong>や安保理が国際社会を代表しているという<strong>政治的正当性に基き</strong>、<strong>集権的な意思決定を行うことで</strong>、紛争解決の<strong>具体的行動の実施や実施の指示を</strong>、介入主体や被介入主体(紛争当事者)や非介入主体(国際社会)に対して<strong>合理化・正当化すること</strong>であるといえよう。</p>
</section>
<section id="安保理の構成" class="level4">
<h4 class="anchored" data-anchor-id="安保理の構成"><strong>安保理の構成</strong></h4>
<p>安全保障理事会の理事国は、米英仏中露の常任理事国5カ国(P5)と、総会から選挙によって任期2年で選出される非常任理事国10カ国(E10)で構成される。E10としてアジア(2), アフリカ(3), ラ米＆カリブ諸国(2), 東欧(1), 西欧&amp;その他(2)の5地域からそれぞれ括弧内の数の席が割り当てられている[^06_ch06-6]。それぞれの地域内では事前に統一候補を絞ることができ、多くのグループ内では立候補順を決めて満遍なく議席が回ってくるように工夫している[^06_ch06-7]。</p>
<p>そもそもこのような地域ごとに議席を配分するシステムは理事国の構成を定めた国連憲章23条1項[^06_ch06-8]で言うところの「衡平な地理的分配」のためであろう。憲章23条1項は非常任理事国の選挙にあたって国連に対する貢献と「衡平な地理的分配」に妥当な考慮を払うことを定めており、後者は1963年の総会決議1991Aにて先述の各地域ごとの議席割り当てとして定められたのである。このようなシステムは世界のどの地域も自地域が代表されてないとの異議申し立てができない程度に理事国を配分し、安保理の普遍性や国際社会の代表としての性格を担保する効果を持っている。しかし紛争対処能力よりも地理的配分があまりに優先された結果として、紛争解決の実績や意思・能力が不十分な加盟国がE10として選出される問題がある。<br>
ともあれE10の中にもローテーションによって受動的に地域代表となった国から、自らのプレゼンス確保や利益追求のために能動的にE10となった国まで幅広く存在する。その上で、いずれにしても国際社会の代表や地域グループの代表としての性格を持つと言えるだろう。安保理が議場として設定された会議にE10として出る時には自国が選出された経緯を確認すると良いだろう。</p>
</section>
<section id="拒否権α" class="level4">
<h4 class="anchored" data-anchor-id="拒否権α"><strong>拒否権+α</strong></h4>
<p>国際社会の中で至上の権限を持つと言っていい安保理の内部にもまた、権力構造が存在する。憲章27条3項では安保理の実質事項[^06_ch06-9]に関する決定を「常任理事国の同意投票[^06_ch06-10]を含む9理事国の賛成投票によって行われる」ものとしている。これがいわゆる拒否権である。拒否権はP5にとって到底受け入れられない決議案を問答無用で否決に追い込む力があり、またその事実がP5に強力な交渉力を与えている。そのために安保理の急を要する決議の起草においてはP5の間で密室交渉が行われ、そこで決議案の骨格が固められるといったことが行われる。</p>
<p>ただし、拒否権に多大な利益がある一方でその発動にはコストも存在する。特に拒否権発動は安保理の円滑な行動を前提とする集団安全保障システムを麻痺させるものである。またそれに伴う国際世論の反発やP5が独占する地位の改革まで考えられる。世界の集団安全保障システムの中核を担う力はないものの、P5の一員として世界の紛争処理に主導的な立場を発揮できる状態は一部のP5にとって大きな利益である。そしてこれらのためにP5への権力集中に対する批判を回避することは利益の大きさや改革の蓋然性などへの認識の違いによる代償はあれどP5の共同利益であり、特に冷戦終結後にはP5間の致命的な対立を自律的に修復し、P5の協力・協調に腐心する姿が見られる。</p>
<p>また、あまり模擬国連会議では体感するものではないものの、拒否権以外についてもP5がE10に対して優越している点が存在する。安保理は独自の複雑で尚且つ常に変化する手続きにより成り立っているために、常に安保理に議席を持つことの利益は大きい。また安保理と緊密な関係にある事務局へもP5は情報共有の優先や、事務局のポストへの自国人材の送り込みなど影響力を確保している。このような常に常任理事国にいることの人材面での優位性がP5には存在する。逆に模擬においてはそのようなP5とE10やその他諸国の間での差異が実際よりも軽減される傾向にあることに注意すると良いだろう。</p>
</section>
<section id="安保理の下部機関" class="level4">
<h4 class="anchored" data-anchor-id="安保理の下部機関"><strong>安保理の下部機関</strong></h4>
<p>安全保障理事会は総会と同様、その活動のために下部機関を設立することができる(29条[^06_ch06-11])。下部機関としては、ICTY[^06_ch06-12]やICTR[^06_ch06-13], UNSCOM[^06_ch06-14]のような専門の技能を必要とするために設立されたかなりの自由度を持ったタイプの機関と、安全保障理事会の意思決定を補佐しその具体的な作業内容に対しても安保理が介入できる下部委員会が存在する。下部委員会は基本的に安保理の全理事国がメンバーとなり、理事会の決定事項の技術的細目を決定する。<br>
下部委員会としては、各紛争ごとに設置される制裁委員会や、湾岸戦争に伴う国連補償委員会[^06_ch06-15]や国連イラク・クウェート国境画定委員会などのアドホック委員会が存在する。<br>
最近には安保理と総会の双方の下部機関として2005年[^06_ch06-16]に平和構築特別委員会が設立されているが、これは特殊な例である。</p>
</section>
<section id="安保理の各種文書" class="level4">
<h4 class="anchored" data-anchor-id="安保理の各種文書"><strong>安保理の各種文書</strong></h4>
<p>安保理による紛争介入では、決議や議長声明、プレスステートメント、議長ノート、安保理議長発所管、その他の安保理決定が用いられる。また安保理の議論過程では紛争当事者や加盟国、事務局や下部機関が作成し、安保理議長宛の書簡として認めた安保理配布文書が存在する。<br>
このうち基本的に何かの紛争への介入行動のほとんどでは<strong>安保理決議</strong>が用いられる。安保理決議は公式討議にて常任理事国の反対票がない状態での9理事国の賛成投票により採択がされる。決議には宣言的な内容を持つ<strong>前文</strong>と実施の必要を伴う内容を持つ<strong>主文</strong>によって構成される。ただし前文と主文の明確な境界線はなく、前文と主文で文言を行き来させる交渉手法が実際においても模擬においてもよく行われる。</p>
<p><strong>安保理議長声明</strong>は決議の次に政治的に重要な文書であり、紛争の状況評価や既存決議の枠組み内の決定事項表明、強すぎない安保理のメッセージや安全保障理事会全体の意思表明を行う時に用いられる。新たな介入措置の決定が盛り込まれることは基本的になく、事務局に対する法的拘束力を持つ決定は行えるが、加盟国に対して拘束力を持つ決定は行えず、新たな介入措置の決定はできない。議長声明はその全体が決議の前文に近い性質をもち、前文主文の区別がなく全てのパラグラフが主語と同志を持つ独立の文によって構成される。議長声明は常にコンセンサス採択であり、非公式会合にてコンセンサスの成立を確認した上で、その後の公式会合にて議長が全文を読み上げる形で採択がなされる。<br>
議長声明は決議に比べて政治的重要性が劣るため同一の内容であっても議長声明としたほうが可決の見通しが立つ場合がある。逆に、議長声明案はコンセンサス採択であるために決議による採択の方針となると、反対側の交渉力が低下する。このような性質から議長声明と決議を行き来させるといった交渉もまたよく行われるのである。</p>
</section>
</section>
<section id="第3項-国連の紛争対処" class="level3">
<h3 class="anchored" data-anchor-id="第3項-国連の紛争対処">第3項 国連の紛争対処</h3>
<p>さてここまで、国連全体のシステムや安保理の概要を見てきた。この項からは具体的に安保理が紛争への介入にあたってどのようなことができるのかを安保理による紛争対処の一般的な流れをベースにしてみていこう。具体的な事例については本BGの第4章にあたってもらうと良い。ここで、紛争への介入にはその①紛争の状況評価(憂慮・避難・歓迎)、②解決策(停戦・和平案)の提示、③強制措置(制裁・武力行使)、④定着の確保措置(PKO・平和構築ミッション)までを射程とし、このような分類を用いる。</p>
<section id="第6章-紛争への初期の介入" class="level4">
<h4 class="anchored" data-anchor-id="第6章-紛争への初期の介入"><strong>〜第6章〜　紛争への初期の介入</strong></h4>
<p>ある地域において政治的緊張が高まっているものの大規模な武力衝突には至っていない時には紛争予防として、安保理による警告的な議長声明の発出がなされる。そして軍事的緊張が高まってくると、安保理による紛争当事者への自制の呼びかけや武力行使停止要求、事務総長への仲介や周旋の要請が行われる。</p>
<p>この段階において安保理の行動を基礎付けるものが憲章6章である。憲章6章の33条では、第1項で国際の平和と安全を危うくするおそれのある紛争について紛争当事者に平和的解決[^06_ch06-17]をまず第一に求めることを義務付け、第2項で安保理が平和的解決を紛争当事者に要請することが定められている。基本的にこの段階における短期的な目的は紛争当事者間の停戦合意とその履行による武力行使の停止であり、最終的な目的は紛争当事者が同意する紛争解決枠組みの成立、すなわち和平合意である。それにあたって安保理による公的介入として①紛争の状況評価から②解決策の提示や、水面下での非公式の介入が並行して行われる。このように紛争解決策の提示や受け入れ要請の段階は<strong>平和創造</strong>と呼ばれる。</p>
</section>
<section id="第7章-強制措置" class="level4">
<h4 class="anchored" data-anchor-id="第7章-強制措置"><strong>〜第7章〜　強制措置</strong></h4>
<p>安保理や事務総長などが提示した解決策や停戦の要求を紛争当事者が受け入れない場合や履行がなされない場合には、その受け入れや履行を強制するための強制措置が決定されることがある。このように強制措置によって平和を作り出すことは、<strong>平和強制</strong>と呼ばれる。強制措置は憲章7章にて規定される。</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">国連憲章7章（第39条〜第42条を抜粋）<br> 第39条 安全保障理事会は、平和に対する脅威、平和の破壊又は侵略行為の存在を決定し、並びに、国際の平和及び安全を維持し又は回復するために、勧告をし、又は第41条及び第42条に従っていかなる措置をとるかを決定する。 第40条 事態の悪化を防ぐため、第39条の規定により勧告をし、又は措置を決定する前に、安全保障理事会は、必要又は望ましいと認める暫定措置に従うように関係当事者に要請することができる。この暫定措置は、関係当事者の権利、請求権又は地位を害するものではない。安全保障理事会は、関係当時者がこの暫定措置に従わなかったときは、そのことに妥当な考慮を払わなければならない。<br> 第41条 安全保障理事会は、その決定を実施するために、兵力の使用を伴わないいかなる措置を使用すべきかを決定することができ、且つ、この措置を適用するように国際連合加盟国に要請することができる。この措置は、経済関係及び鉄道、航海、航空、郵便、電信、無線通信その他の運輸通信の手段の全部又は一部の中断並びに外交関係の断絶を含むことができる。 第42条 安全保障理事会は、第41条に定める措置では不充分であろうと認め、又は不充分なことが判明したと認めるときは、国際の平和及び安全の維持又は回復に必要な空軍、海軍又は陸軍の行動をとることができる。この行動は、国際連合加盟国の空軍、海軍又は陸軍による示威、封鎖その他の行動を含むことができる。</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>憲章7章に基づく強制措置を安保理が決定するにあたっては、その紛争の状態を”平和に対する脅威”や”平和の破壊”、”侵略行為”などと安保理が認定する(以下、”脅威認定”と呼ぶ)必要がある。この安保理による法的認定が強制措置の発動決定の決定根拠である。ただし”平和に対する脅威”などの基準は憲章に記載されていなく安保理の裁量となっているほか、そもそも国際の平和と安全の維持の目的にあたって脅威認定が必要かどうかも安保理の判断事項となっており、安保理に広範な自由度が与えられている。また、一般に憲章7章に基づく安保理の決定は加盟国に対して法的拘束力をもち、総会決議や6章等に基づく勧告的な決議とは一線を画している。同時に、7章下の権限は憲章2条にて定められた武力不行使原則や内政不干渉原則の例外でもあり、内政干渉や武力行使が容認される。このように広範な自由度と強大な権限とを与えられた安保理の決定のもとでの集団安全保障が構築されているのである。</p>
<p>そして脅威認定がなされた時には停戦や和平案などの紛争解決策を当事者に受け入れさせるため、憲章41、42条に基づく強制措置が実施される。憲章41条は軍事力を伴わない広範な強制行動すなわち制裁について定めている。制裁の詳細については本章3節にて後述する。憲章42条では、非軍事的制裁が不十分である限定的な場合の強制措置として軍事的措置について定められている。もともと軍事的措置は加盟国から提供された部隊を安保理が指揮することで実施される予定であった(憲章43~47条)が、冷戦後すぐに頓挫してしまった。その後の42条の運用として朝鮮戦争における国連軍の組織があったが、冷戦終結後には湾岸戦争における多国籍軍を契機に安保理が設定する目的のもと、加盟国が自発的に形成する<strong>多国籍軍に「必要なあらゆる手段(All necessary means)」を取る権限を安保理決議によって「付与(authorize)する</strong>」ことで軍事的措置が代替されるようになった。</p>
<p>基本的にこれら強制措置の目的は停戦や兵力撤収、和平の受け入れなど安保理が決定した紛争解決策を当事者に受け入れさせ、ひいては平和に対する脅威等を除去することにあり、強制措置は当然に手段にすぎないものである。ただしこうした強制措置を行う決議内にて、目的は書かれることが多いもののその内容はかなり抽象的なことが多く、制裁や強制措置の解除条件が曖昧であったり「ゴールポストを動かされる」などと批判されることがあり、『平和への課題：補遺』においても言及がなされている。</p>
</section>
<section id="平和構築平和維持" class="level4">
<h4 class="anchored" data-anchor-id="平和構築平和維持"><strong>平和構築・平和維持</strong></h4>
<p>その後和平合意が結ばれ、具体的な紛争解決の枠組みが定まって情勢も沈静化すると、紛争対処の目的は和平合意の内容を紛争当事者に履行させることに移行する。和平合意では一般に停戦や武装解除、暫定政府の権力分有、避難民帰還、選挙実施などの移行措置の実施が合意される。<strong>この過程における外部からの介入行動は一般に平和構築と呼ばれる</strong>。</p>
<p>また、停戦合意後から和平協定締結までの間や和平協定締結後の履行にあたり、武力紛争の停止を紛争当事者間の軍事的緊張が和らぐまで、国際社会からの軍事的プレゼンスによる監視や抑止によって保障することがある。これは<strong>平和維持</strong>と呼ばれ、国連が行う場合にはPKO(Peace Keeping Organization; 国連平和維持活動)もその一種である。PKOについては第二節で後述する。</p>
<p>このような過程を経て和平協定の締結やその履行により紛争が解決に向かうと国連の介入レベルも引き下げられ、多国籍軍やPKOの縮小・廃止、制裁措置の解除が行われる。無論、実際の紛争では停戦協定の期限切れ後に大規模な武力衝突に回帰したり、和平協定の締結後も履行が進まず内戦状態へ逆戻り[^06_ch06-18]したりする。こうしたケースバイケースの対応や、PKO・多国籍軍などの憲章にない新たな手法を生み出しつつ安保理は憲章の6, 7章の枠組みで紛争の対応を行うのである。</p>
</section>
</section>
<section id="第4項-安保理決議に基づく義務" class="level3">
<h3 class="anchored" data-anchor-id="第4項-安保理決議に基づく義務">第4項　安保理決議に基づく義務</h3>
<p>本項では安全保障理事会の決定に対して加盟国が負う義務に関し、憲章25, 48, 49, 50, 103条を中心に解説する。安保理決議</p>
<section id="安保理決議に基づく義務の発生" class="level4">
<h4 class="anchored" data-anchor-id="安保理決議に基づく義務の発生"><strong>安保理決議に基づく義務の発生</strong></h4>
<p>憲章25条と48, 103条を見ていこう。</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">国連憲章 第25条 国際連合加盟国は、安全保障理事会の決定をこの憲章に従って受諾し且つ履行することに同意する。<br> 第48条 国際の平和及び安全の維持のための安全保障理事会の決定を履行するのに必要な行動は、安全保障理事会が定めるところに従って国際連合加盟国の全部又は一部によってとられる。 前記の決定は、国際連合加盟国によって直接に、また、国際連合加盟国が参加している適当な国際機関におけるこの加盟国の行動によって履行される。 第103条 国際連合加盟国のこの憲章に基く義務と他のいずれかの国際協定に基く義務とが抵触するときは、この憲章に基く義務が優先する</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>まず、憲章25条はその条文通り加盟国全てに対し、<strong>憲章に従って</strong>安保理の<strong>決定</strong>を履行する義務を与えている。そして同時に48条では安保理による強制行動の具体的な実施方法として、全ての加盟国が行う方法と一部の加盟国が行う方法の双方を安保理が決定できる旨が定められている。そして103条によりこれら<strong>安保理決議に基づく義務をはじめとする憲章上の義務のその他の国際協定の義務に対する優越性</strong>が定められている。これが安全保障理事会決議が法的拘束力を持つといわれる所以である。一般に、安全保障理事会決議に定められた義務は他の条約上の義務を理由に回避することはできず、履行しなければ国連憲章違反となって国家責任が生じる。</p>
<p>ただし、憲章48条により安全保障理事会は何かの措置を行う際にその措置を行う主体を一部の加盟国に限定することが可能であり、明示的に特定の加盟国を言及しないことも行われる。実際に例えば湾岸戦争時の多国籍軍のように、加盟国に対して武力行使の権限を「許可」するとき、全ての加盟国へ強制行動の対象国に武力行使を行う法的義務を与えているものではなく、あくまで自発的な参加を勧告しているに近い。</p>
<p>ただし安全保障理事会が加盟国に課すことのできる義務の範囲が無制限であるかについては複数の立場が存在する。<br>
まず、憲章24条において安保理は憲章の目的と原則に従って行動する旨が定められており、”国連憲章の目的と原則”、すなわち先述の憲章1条, 2条は安保理の行動範囲を制限しうるだろう[^06_ch06-19]。さらに、憲章25条[^06_ch06-20]での”憲章に従って”の但し書きについては、「安保理の決定を、加盟国が憲章に従って受諾する」との解釈と、「憲章に従っている範囲内の安保理の決定を、受諾する」との解釈が存在する。後者の立場からは、憲章によって与えられた権限を逸脱する安保理決議や極めて違法な決議に関しては加盟国に義務を生じさせず、結果として憲章25条は安保理の裁量の限界を定めているとの見解を導けるだろう[^06_ch06-21]。</p>
<p>また、憲章103条では”他のいずれかの国際協定に基づく義務”に対する国連憲章上の義務、ひいては安保理の決定の優越を定めているが、”他のいずれかの国際協定に基づく義務”の内容は不明瞭である。一般に条約や慣習法が含まれるとされるものの、強行規範との優越関係については定かでない。<br>
これらを踏まえて、安保理の決議として</p>
<p>国連憲章<br>
第49条<br>
国際連合加盟国は、安全保障理事会が決定した措置を履行するに当って、共同して相互援助を与えなければならない。</p>
<p>第50条<br>
安全保障理事会がある国に対して防止措置又は強制措置をとったときは、他の国でこの措置の履行から生ずる特別の経済問題に自国が当面したと認めるものは、国際連合加盟国であるかどうかを問わず、この問題の解決について安全保障理事会と協議する権利を有する。<br>
cfr</p>
<p>https://www.unic.or.jp/info/un/un_organization/sc/special_courts/</p>
</section>
</section>
</section>
<section id="コラム-安保理決議の拘束力" class="level2">
<h2 class="anchored" data-anchor-id="コラム-安保理決議の拘束力"><strong>コラム　安保理決議の拘束力</strong></h2>
<p>⇨あまりに違法性の高い安保理決議に関しても加盟国は従わなければいけないのかどうか<br>
<a href="https://www.publication.law.nihon-u.ac.jp/pdf/law/law_88_2/each/06.pdf" class="uri">https://www.publication.law.nihon-u.ac.jp/pdf/law/law_88_2/each/06.pdf</a></p>
</section>
<section id="第2節-国連財政" class="level2">
<h2 class="anchored" data-anchor-id="第2節-国連財政"><strong>第2節　国連財政</strong></h2>
<p>『平和への課題：補遺』の時代に国連は財政難に瀕していた。国連とて資金は必要であり、なおかつ新たな制度やシステムを作ろうと思えばその予算をどのように調達するかの問題が発生する。そこで本節では模擬国連においては日の目を見ることが少ないものの、具体的な行動を伴う加盟国毎の意思決定や加盟国全体における意思決定に対して確実な影響をもたらす国連財政を概観する。国連の予算は事務局や各種の国連機関の運営のための通常予算とPKO予算に大別される。まずは通常予算と分担金について見ていこう。なお各年末における分担金の割当額や支払済み額、未払い額については下記リンクの文書にまとめられているので、適宜見ると良いだろう。<a href="https://www.un.org/en/ga/contributions/status.shtml" class="uri">https://www.un.org/en/ga/contributions/status.shtml</a></p>
<section id="通常予算の決定" class="level4">
<h4 class="anchored" data-anchor-id="通常予算の決定"><strong>通常予算の決定</strong></h4>
<p>国連の通常予算は2年間を一予算年度とする方式[^06_ch06-22]をとり、総会において決定される。偶数年の総会で事務総長が予算提案の概要を提案して総会のコンセンサスによって承認し、奇数年の総会にて次の2年間分の予算を承認する流れである。基本的に通常予算は国連職員の給与や会議サービス提供にかかる経費がほとんどであり、開発協力や人道援助などの資金は予算外資金で、PKOに直接的に関わる経費は特別のPKO予算によって賄われる。1994[^06_ch06-23]-1995の2年間における通常予算[^06_ch06-24]はおよそ約25億8千万ドル[^06_ch06-25]であり、これによって国連は10171人の職員を雇用する。収入は4億7000万ドル程度であり、これを支出から差し引いて年額に直した10億ドル程度が加盟国の分担金1年分で賄われる。<br>
国連の予算決定についてはどの分野にどれだけの予算を回し[^06_ch06-26]、どのように経費を削減するか[^06_ch06-27]について、事務総長や国連の各部局、加盟国の間で非常に激しい対立が発生する[^06_ch06-28]。ただし国連通常予算はあくまで国連という官僚組織の組織運営費であり、予算の配分といっても分野ごとにせいぜい担当職員を10人規模で増やすか否かという程度である。また、そもそも予算については第5委員会と総会本会合の2段階のコンセンサスによって採択されるものであり、予算の総額もかなり厳しく抑制がされている。そのため、通常予算の決定自体は我田引水の政治的な対立の場というよりも事務局の監視の場となっている。</p>
</section>
<section id="分担比率の決定と滞納" class="level4">
<h4 class="anchored" data-anchor-id="分担比率の決定と滞納"><strong>分担比率の決定と滞納</strong></h4>
<p>こうして決まった予算のほとんどは加盟国の分担金によって賄われる。IMFや世界銀行では分担金額に応じて投票力が変わるが、国連では分担金額がどれほど少なくても最大の分担金支払国であるアメリカと”同等”の1票を持つことができる。そのため分担比率をどのような基準で決定するかや、どの統計使用を用いるか、各国の特殊な事情に伴い分担金の減免を行うかについて加盟国間で政治的な対立が発生するが、大枠としては最低分担率0.01%[^06_ch06-29]と最大分担率25%[^06_ch06-30]のもとで基本的には国民所得を基礎としつつIMFが発表する為替レートを用いて分担率を決定する方式が用いられている。</p>
<p>国連の財政規則により加盟国は事務局の分担金支払請求を受けてから1ヶ月以内(だいたいの場合1月中)に支払う義務が存在するが、加盟国の大半はこの期日に間に合わず、総会が始まる9月に駆け込み的に支払ってなんとか1年を乗り切る場当たり的な運営状態となっている[^06_ch06-31]。憲章19条により分担金を2年分以上滞納すると総会における投票権を失う規定があるものの、逆に2年分を常に滞納し続けることも珍しくない。<br>
実際に93年の8月末には事務総長により通常予算とPKO分担金を満額支払っている国が184カ国中7カ国であることや、約2週間で手持ち資金が枯渇すること、そのために9月からの会議数の強制削減や休日・夜間のサービス停止などの経費削減措置を行うことが表明されることもあった[^06_ch06-32]。また、本会議の直近である1994年の12月末には以下のような支払状況である。</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th>1994年徴収額 (100万ドル)</th>
<th>1994年末時点の総未納金額 (100万ドル)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">通常予算</td>
<td>$1,062</td>
<td>$480</td>
</tr>
<tr class="even">
<td style="text-align: left;">国連緊急軍 (UNEF) 及び国連兵力引き離し監視軍 (UNDOF)</td>
<td>$31</td>
<td>$25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">国連レバノン暫定軍 (UNIFIL)</td>
<td>$138</td>
<td>$203</td>
</tr>
<tr class="even">
<td style="text-align: left;">国連イラン・イラク軍事監視団 (UNIIMOG)</td>
<td>$0</td>
<td>-$6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">国連アンゴラ検証団 (UNAVEM)</td>
<td>$18</td>
<td>$13</td>
</tr>
<tr class="even">
<td style="text-align: left;">国連ナミビア独立支援グループ (UNTAG)</td>
<td>$0</td>
<td>-$7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">国連イラク・クウェート監視団 (UNIKOM)</td>
<td>$17</td>
<td>$30</td>
</tr>
<tr class="even">
<td style="text-align: left;">国連西サハラ住民投票監視団 (MINURSO)</td>
<td>-</td>
<td>$20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">国連エルサルバドル監視団 (ONUSAL)</td>
<td>$18</td>
<td>$24</td>
</tr>
<tr class="even">
<td style="text-align: left;">国連カンボジア暫定統治機構 (UNTAC)</td>
<td>$100</td>
<td>$108</td>
</tr>
<tr class="odd">
<td style="text-align: left;">国連保護軍 (UNPROFOR)</td>
<td>$1,534</td>
<td>$457</td>
</tr>
<tr class="even">
<td style="text-align: left;">国連ソマリア活動 (UNOSOM)</td>
<td>$735</td>
<td>$191</td>
</tr>
<tr class="odd">
<td style="text-align: left;">国連モザンビーク活動 (ONUMOZ)</td>
<td>$302</td>
<td>$72</td>
</tr>
<tr class="even">
<td style="text-align: left;">国連キプロス平和維持隊 (UNFICYP)</td>
<td>$22</td>
<td>$8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">国連グルジア監視団 (UNOMIG)</td>
<td>$6</td>
<td>$0</td>
</tr>
<tr class="even">
<td style="text-align: left;">国連ハイチ・ミッション (UNMIH)</td>
<td>$2</td>
<td>$0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">国連リベリア監視団 (UNOMIL)</td>
<td>$40</td>
<td>$6</td>
</tr>
<tr class="even">
<td style="text-align: left;">国連ルワンダ支援団 (UNAMIR)</td>
<td>$229</td>
<td>$125</td>
</tr>
<tr class="odd">
<td style="text-align: left;">国連カンボジア軍事連絡班 (UNMLT)</td>
<td>$1</td>
<td>$0</td>
</tr>
<tr class="even">
<td style="text-align: left;">PKO予算合計</td>
<td>$3,192</td>
<td>$1,270</td>
</tr>
<tr class="odd">
<td style="text-align: left;">全体合計</td>
<td>$4,254</td>
<td>$1,750</td>
</tr>
</tbody>
</table>
<p>//ST/ADM/SER.B/458ベース　チェックはだるすぎるので後回し　PKO毎のはいらないかな</p>
</section>
<section id="第2項-pko予算" class="level3">
<h3 class="anchored" data-anchor-id="第2項-pko予算">第2項　PKO予算</h3>
<p>国連におけるPKOのほとんどは通常予算とは別会計でその費用が賄われている。その規模は94年の徴収額で32億ドル(通常予算は10億ドル)ほどであり、当時最大のPKOであるボスニア情勢のUNPROFOR単独で15億ドルほどと通常予算を凌駕している。</p>
<section id="pko予算の決定" class="level4">
<h4 class="anchored" data-anchor-id="pko予算の決定"><strong>PKO予算の決定</strong></h4>
<p>PKOは通常、安保理が緊急の必要に対応して作成するものであり、なおかつ安保理がPKOに与える任務範囲自体も想定される予算規模から影響されるものである。そのため、安保理がPKOを設立する際にはそれに先立って事務総長に予算規模作成の要請がされ、事務局のPKO局により安保理のイメージに従って予算見積もりが作成され、非公式に安保理へと報告される。その後にPKO設立決議が採択されれば、事務総長による緊急支出[^06_ch06-33]で暫定的な資金を確保しつつ、事務局による詳細な予算見積もりの作成と第五委員会および総会による承認を経てPKO予算が決定される。</p>
<p>PKO予算はその兵員や文民、軍事監視員の経費や旅費、滞在費、事務機器や航空機材のチャーター費、燃料費などに使用される。PKO要員の経費はPKO要員を派遣した加盟国に経費償還として還元される。94年当時では1人あたり1月で1061米ドルの支払いであり、どの国が派遣しても同じ金額が国連から加盟国に支払われる。ただし、国によって要員への給与や手当は異なり手当のうち10%程度しか国連から償還されず残り90%ほどは自国負担となってしまう国や、逆に国連からの償還金より給与や手当が安いがためにPKO要員1人の派遣により1ヶ月あたり600ドルの利益をあげている国が存在する[^06_ch06-34]。</p>
</section>
<section id="pko予算の分担率決定" class="level4">
<h4 class="anchored" data-anchor-id="pko予算の分担率決定"><strong>PKO予算の分担率決定</strong></h4>
<p>PKOについてはそもそも国連憲章においてその規定がないことや、設立の当初から費用の分担について激しい対立があったこともあり、PKO毎に予算制度や費用の拠出方法が決められるアドホックな方式となっている。ここではそれぞれの方式を紹介しよう。</p>
<p>①通常予算方式<br>
PKOの予算を通常予算によって賄う方式である。この場合、PKOの費用の分担は通常予算の分担割合となる。ごく初期のPKOである1948年のUNTSOや1949年のUNMOGIPの他、1958年のUNOGIL、1988年のUNGOMAP[^06_ch06-35]など、小規模でなおかつ政治的対立も少ないがために、その費用の拠出に関して対立が発生せずにすんなりと承認されたのである。</p>
<p>②自発的拠出方式<br>
紛争当事国や有志諸国からの拠出や、PKO要員派遣国による派遣費用の請求取り下げによって運営される方式である。特に1960年代の初頭などPKO財政をめぐる危機が深刻化した時代に作成されたPKOに多い。UNSF(国連西ニューギニア安全保障軍)や、UNYOM(国連イエメン監視団)、UNFICYP(国連キプロス平和維持部隊)などが挙げられる。UNSFについては全額が紛争当事国によって負担されて成功裡に終わったが、UNYOMは当事国が財政負担を拒んだことで引き揚げとなり、UNFICYPは有志諸国からの支払いが不足して10年分の経費未払い状態となり紆余曲折を経た後に通常予算方式へと切り替えられた。</p>
<p>③通常予算外の分担金方式<br>
通常予算とは異なる勘定で、特殊な分担率によって決定された加盟国の分担金によって賄われる方式であり、ほとんどのPKOはこの方式を用いている。その大元となるガイドラインが作成されたのが1963年の総会決議1874である。この決議では平和維持活動に関する資金が国連加盟国の共同責任でありつつも、先進国と後進国の貢献能力の差や安保理常任理事国の”特別の責任”が平和維持活動への貢献と関連して考慮されるべきであるとされた。それらを踏まえて、分担率は次のようなシステムで決定されている[^06_ch06-36]。</p>
<ol type="1">
<li>常任理事国以外の先進国グループ(Bグループ)に通常予算と同等の分担率を割り当てる。<br>
</li>
<li>発展途上国(Cグループ)に通常予算の分担率の1/5を割り当てる。<br>
</li>
<li>後発発展途上国(Bグループ)に通常予算の分担率の1/10を割り当てる。<br>
</li>
<li>常任理事国(Aグループ)に残りの金額を通常予算の分担率の割合で割り当てる。</li>
</ol>
<p>すなわち発展途上国や後発発展途上国のPKO分担金は通常予算の割合よりもさらに割引がなされ、それを常任理事国が安保理における政治的影響力の代償として代わりに負担する形式である。それに伴って、常任理事国の負担はPKO予算の6割前後、常任理事国と先進国の負担を合わせると9割以上が負担されており、途上国の財政的貢献はもっぱらPKOを加盟国全体の共同責任とするための象徴的意義によってなされている。<br>
1990年代になってPKO自体の増加や任務の拡大によってPKO予算は膨れ上がっていった。そして通常予算同様、PKO予算も分担金の滞納が頻発し国連の財政を圧迫していた。ただし、当時の世界全体の軍事予算が1兆2000億ドル程度であり[^06_ch06-37]、PKO予算はその375分の1であったことを加味すれば規模としては微々たるものであると言えるだろう。ただし、</p>
<p>『平和への課題』における改革案の話？<br>
PDD-25の話？</p>
</section>
</section>
</section>
<section id="第3節-国連による経済制裁" class="level2">
<h2 class="anchored" data-anchor-id="第3節-国連による経済制裁"><strong>第3節 国連による経済制裁</strong></h2>
<p>経済制裁は禁輸や金融封鎖など<strong>経済的な力の行使によって被制裁国への報復や政策転換の強制を行う行為</strong>である。本稿では集団安全保障の一環で国連とりわけ安全保障理事会の決定に基づき行われる政策転換の強制のための制裁を扱うが、一般には個別国家間での違法行為に対する対抗措置や復仇、先行違法行為が存在しない状態での国益および安全保障の担保のための経済的な力の行使をも含むものである。</p>
<p>武力不行使原則等の発展により、個別国家による軍事的な力の行使へ国際法的に強い制限がかかり、国連による強制措置としても非常に高いハードルが存在する。それに対して経済制裁については個別国家によるものは安全保障例外の枠組みや対抗措置として被制裁国による違法行為の存在と均衡性などの要件を満たす限り許容される。経済的な力の行使は軍事的な力の行使よりも格段に行いやすい強制措置[^06_ch06-38]なのである。</p>
<p>しかし経済制裁は時に軍事力の行使よりも広範に、すなわち被制裁国の一般市民や被制裁国と深い貿易関係にあった第三国などの制裁の真のターゲット以外に大きな被害を与えることがある。そして逆に、被害を受けることを恐れて集団的な制裁に対して拒否や不履行(制裁破り)を決め込む国家があれば制裁の効果は大きく損なわれる。また、軍事力の行使については国際人道法や人権法の発展により行使の方法についてまで規制が進んだものの、経済制裁についての同様の議論は乏しく、実際に人道・人権上の問題を引き起こした上でその法的責任を問われることはなかった。そして制裁破りやそれを防止する第三国の権利保障(補償)、制裁によって生じる人道危機への対処や予防などといった理念上の問題と、実行において生じた実問題とを踏まえて『平和への課題：補遺』ではその問題の提示と各種メカニズムの提案がなされた。</p>
<p>そこで本節では、大論点2に関連して国連の集団安全保障システムに組み込まれた経済制裁についてその淵源や憲章上の地位、重要事例の概説を行う。あくまでこの会議で扱うのは、違法行為などに対する対抗措置ないし政策転換の強制として、国際連合が行う集団的な経済制裁であり、個別国家が行う制裁や勢力拡大などのために行われる制裁は扱わない。まず、第1項で1990年代までに至る経済制裁の歴史や国連憲章における経済制裁の制度を概観する。その上で第2項にて『平和への課題：補遺』に至る1990年代における経済制裁の事例を踏まえ、</p>
<p>第3項にて安保理が経済制裁を行うまでの流れ<br>
その後、第4経済制裁と人道・人権の問題</p>
<p>50条<br>
で</p>
<section id="第1項-国際連合憲章における経済制裁措置" class="level3">
<h3 class="anchored" data-anchor-id="第1項-国際連合憲章における経済制裁措置">第1項　国際連合憲章における経済制裁措置</h3>
<p>経済制裁は、物理的暴力ではなく経済的な力によって対象国への報復や政策転換を迫る行為である。古くは紀元前にアテナイが報復として特定国への貿易を禁止したメガラ法令や、ナポレオンの大陸封鎖令に遡ることができる。そして各国の経済が自給自足的でなくなり各国の経済の相互依存性が高まった現代において経済制裁は非常に大きな力を発揮できるようになった。</p>
<section id="国際連盟期" class="level4">
<h4 class="anchored" data-anchor-id="国際連盟期"><strong>国際連盟期</strong></h4>
<p>第一次世界大戦後、紛争処理の方法が武力から非武力へと限定されていく過程で、非軍事的な力の行使、すなわち経済制裁が主要な集団安全保障の手段となっていった[^06_ch06-39]。国際連盟期には連盟規約第16条にて規約に反して戦争へ訴えた加盟国を、ほか全ての加盟国に対して戦争行為を行なったものとみなして、通商・金融・交通通信関係の断絶を行うことを定めた。国際連盟はこのような経済制裁を”<em>経済的武器 l’arme économique</em>”と呼んで集団安全保障体制の主要な手段に据えたのである。</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">国際連盟規約　第16条〔制裁〕<br><br>1　第一二条、第一三条又ハ第一五条ニ依ル約束ヲ無視シテ戦争ニ訴ヘタル聯盟国ハ、当然他ノ総テノ聯盟国ニ対シ戦争行為ヲ為シタルモノト看倣ス。他ノ総テノ聯盟国ハ、之ニ対シ直ニ一切ノ通商卜又ハ金融上ノ関係ヲ断絶シ、自国民ト違約国国民トノ一切ノ交通ヲ禁止シ、且聯盟国タルト否トヲ問ハス他ノ総テノ国ノ国民ト違約国国民トノ間ノ一切ノ金融上、通商上又ハ個人的交通ヲ防遇スヘキコトヲ約ス。 2　聯盟理事会ハ、前項ノ場合ニ於テ聯盟ノ約束擁護ノ為使用スヘキ兵力ニ対スル聯盟各国ノ陸海又ハ空軍ノ分担程度ヲ関係各国政府ニ提案スルノ義務アルモノトス。 3　聯盟国ハ、本条ニ依リ金融上及経済上ノ措置ヲ執リタル場合ニ於テ之ニ基ク損失及不便ヲ最小限度ニ止ムル為相互ニ支持スヘキコト、聯盟ノ一国ニ対スル違約国ノ特殊ノ措置ヲ抗拒スル為相互ニ支持スヘキコト、並聯盟ノ約束擁護ノ為協力スル聯盟国軍隊ノ版図内通過ニ付必要ナル処置ヲ執ルヘキコトヲ約ス。 4　聯盟ノ約束ニ違反シタル聯盟国ニ付テハ、聯盟理事会ニ代表セラルル他ノ一切ノ聯盟国代表者ノ聯盟理事会ニ於ケル一致ノ表決ヲ以テ、聯盟ヨリ之ヲ除名スル旨ヲ声明スルコトヲ得。</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>連盟規約における経済制裁は、規約の違反国(≒戦争開始国)に対して即座に自動的に経済制裁が発動される仕組みとなっているが、規約違反の認定を加盟国や連盟理事会などどの主体が行うのかの規定がなかった。連盟総会にて連盟理事会に規約が違反されたかの意見を述べる権限を与えるなどといった規約改正案が採択されたものの批准には至らず、最終的に規約違反の認定を個別国家が行い、なおかつ制裁実施国の損失や不利益が最小限度の場合にのみ制裁を行う制度[^06_ch06-40]となった。また同時に連盟による集団的な制裁発動の決定は連盟理事会の全会一致によるもので制裁対象国の反対票によって容易に封じることができるなど、制度の上でも問題があった。</p>
<p>国際連盟期の制裁として最も主要なものはイタリアのエチオピア侵略に端を発する対イタリア制裁である[^06_ch06-41]。連盟による対イタリア制裁では当事国をのぞいた調整委員会によって制裁内容や履行確保の方法が審議され以下のような措置が採択された。<br>
①対イタリアの武器等輸出禁止<br>
②対イタリア金融制裁<br>
③イタリア産物品輸入禁止<br>
④特定動物・鉱物等の対イタリア輸出禁止<br>
⑤制裁によって経済的困難に陥る国に対する相互支援<br>
特に②の金融制裁はイタリアに、通貨の信用低下や金準備高の現象、国際収支の支払い超過をもたらしたものの、石油等の重要物資が制裁の対象外であったり、連盟側の足並みも揃わなかったために、イタリアによるエチオピア併合が完了して制裁が終了する形となった。対イタリア制裁は連盟期に唯一効果的な経済制裁であったが、最終的には失敗に終わったのである。</p>
</section>
<section id="国連憲章における経済制裁と集団安全保障の負担-憲章41条49条50条" class="level4">
<h4 class="anchored" data-anchor-id="国連憲章における経済制裁と集団安全保障の負担-憲章41条49条50条"><strong>国連憲章における経済制裁と集団安全保障の負担　憲章41条・49条・50条</strong></h4>
<p>国際連盟における経済制裁を主軸とした集団安全保障は、そのシステム自体の脆弱性や分権性によって失敗した。その失敗を受けて国際連合および国連憲章では、安全保障理事会が集権的に集団安全保障システムを担保する制度が構築された。そして安全保障理事会が”脅威認定”した上でとりうる措置として、41条の非軍事的措置と42条の軍事的措置が定められた。</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">国連憲章　第41条 安全保障理事会は、その決定を実施するために、兵力の使用を伴わないいかなる措置を使用すべきかを決定することができ、且つ、この措置を適用するように国際連合加盟国に要請することができる。この措置は、経済関係及び鉄道、航海、航空、郵便、電信、無線通信その他の運輸通信の手段の全部又は一部の中断並びに外交関係の断絶を含むことができる。</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>この41条に基づく非軍事的な強制措置が”国連による経済制裁”である。連盟規約における16条1項が加盟国の自主判断による分権的な措置であったのに対して、41条および39条では安保理が集権的に強制措置を発動すべき事態の認定とその措置の実施方式を集権的に決定できる形式となった。また連盟規約16条3項の制裁により生じる経済問題の相互援助義務については、憲章49条と50条の形で結実した。</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">国連憲章<br> 第49条 国際連合加盟国は、安全保障理事会が決定した措置を履行するに当って、共同して相互援助を与えなければならない。 第50条 安全保障理事会がある国に対して防止措置又は強制措置をとったときは、他の国でこの措置の履行から生ずる特別の経済問題に自国が当面したと認めるものは、国際連合加盟国であるかどうかを問わず、この問題の解決について安全保障理事会と協議する権利を有する。</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>第1節にてみてきたように、安保理がこのような措置を決定すればその決定の履行を行う憲章上の義務が憲章25条に基づき国連加盟国に課される。また、連盟規約16条3項における制裁実施国の損失や不便の最小化のための協力については、憲章50条にて制裁の履行により生じる特別な問題についての安保理との協議権の形で反映され、自国の不利益を恐れて経済制裁に参加しない国家が発生することの防止が図られた。このようにして国際連合による経済制裁は連盟の時代よりも強化された形で制度設計がなされたのである[^06_ch06-42]。</p>
<p>ただしこのような49条および50条については憲章の起草過程、すなわちダンバートンオークス提案の起草過程や当該提案をもとに国連憲章を起草するサンフランシスコ会議において幾分かの議論が発生した。当該条項は今回の会議の経済制裁により生じる第三国被害の保障に直接的につながるのみならず、国連の集団安全保障の負担の共有ということに関して非常に示唆に富むものであるため、ここで起草過程を簡単に確認しよう。</p>
</section>
<section id="ダンバートンオークス提案における憲章49-50条" class="level4">
<h4 class="anchored" data-anchor-id="ダンバートンオークス提案における憲章49-50条"><strong>ダンバートンオークス提案における憲章49, 50条</strong></h4>
<p>国連憲章の主たる原案であるダンバートンオークス提案を起草するにあたっての米国試案[^06_ch06-43]において、のちの憲章49条および50条は次のような条文であった。</p>
<p>加盟国は、執行理事会が実施する武力行使を含む安全保障措置への参加を通じて過度の負担を負う国に対し、救済と援助を提供するための相互努力に参加する(to join in mutual efforts to)。</p>
<p>そもそもその条文の目的は先述の通り、経済制裁や軍事制裁の履行による自国の負担を危惧して制裁の拒否や不履行がされることを加盟国間の相互援助によって防止することであり、連盟規約の16条(3)および憲章49条に近い内容となっている。その後の最終的なダンバートンオークス提案では上記の内容の変更や、安保理との協議権を定めた条項の追加を経て、8章B節10項および11項に現在の憲章49条と50条の原案が完成した。</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ダンバートンオークス提案[^06_ch06-44]　第8章B節 第10項 国際連合加盟国は、安全保障理事会が決定した措置を履行するにあたり、相互援助に参加すべきである(should join in affording)。 第11項 国際連合加盟国であるか否かを問わず、安全保障理事会が決定した措置の履行から生ずる特別な経済問題に直面したいかなる国(any state)も、それらの問題の解決に関して安全保障理事会と協議する権利を有する。</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</section>
<section id="サンフランシスコ会議における憲章49-50条" class="level4">
<h4 class="anchored" data-anchor-id="サンフランシスコ会議における憲章49-50条"><strong>サンフランシスコ会議における憲章49, 50条</strong></h4>
<p>ダンバートンオークス提案は国連憲章を起草するサンフランシスコ会議において、主たる草案となった。上記の憲章49条および50条、当時のダンバートンオークス提案8章B節10項, 11項について最終的に表現上の修正しかなされなかったものの、幾つかの修正提案や提言、声明が発せられた[^06_ch06-45]。南アフリカの修正提案、ノルウェー、ベネズエラ、カナダの提言[^06_ch06-46]をここで扱おう。</p>
<p><strong>南アフリカ修正提案</strong><br>
第8章A節の規定に従って平和的手段により紛争を調整もしくは解決することを怠り(のちに”拒否し”へ修正)、また、その結果、本節の第3項(非軍事的措置)及び第4項(軍事的措置)に従って行動がとられた国は、いずれの国も、当該強制行動にかかる費用を支払い、かつその行動によって被る損失及び損害の補償を行わなければならない。強制行動に参加した諸国はかかった費用に関し、また被った損失および損害の補償に関して、安全保障理事会に対して自国の要求を提示し、安全保障理事会はその要求を承認し、その支払いを確保するために必要な行動をとることになる。</p>
<p>南アフリカの修正提案は、経済制裁や国連軍の派遣によって発生した費用や損失・損害を大元の問題を発生させた国家に強制的に払わせるものである。この時点においても国連の集団安全保障は小国にとって多大な負担を発生させかねない認識が存在したのである。ただしこの修正案については米国によって、安全保障理事会の運営に支障を及ぼしかねないとの懸念と「<strong>8章B節11項が執行措置への参加の結果として一部の国が被る可能性のある経済的困難の救済を既に規定している</strong>」との説明を行い、当該修正は南アおよびイランの賛成2票と反対19票によって否決される結果となった。</p>
<p>またノルウェーにより、集団行動によって義務付けられた行動に伴う特別の財政支出に関して全ての国が協力することを定めた条項を考えるべきであるとの提言がなされたほかベネズエラにより、関係国の安保理への協議権だけでなく安保理が実際にその問題を解決するための措置が取ることも重要であるとの提言がなされた。同様にカナダからも、10項と11項をを併せて解釈すれば必要なら加盟国間で執行措置の費用を分担する取決めを行うことができ、そうでなければ機構を代表して行動する特定の加盟国に不公平な財政的負担がかかる可能性があるとの発言がなされた[^06_ch06-47]。しかしながらダンバートンオークス提案の文言は修正がなされることなく全会一致で可決された。</p>
<p>その後、調整委員会にて表現上の修正がなされ、協議権(提案11項もしくは憲章50条)について確実に権利の存在を明確にすることを目的に提案ではshould have the right to…であったのがshall[^06_ch06-48] have the right to…へと強化された。また、制裁対象国が協議権の受益者とならない趣旨を明確化することを目的に、any stateからany other stateへと修正がなされた。また、同様に集団安全保障措置の履行における相互援助 (提案10項もしくは憲章49条)についても、should join in affordingからshall join in affordingへと強化がなされることとなった。かくして、憲章49条および50条の相互援助と協議権が成立したのである。</p>
</section>
<section id="国連憲章起草後の集団安全保障" class="level4">
<h4 class="anchored" data-anchor-id="国連憲章起草後の集団安全保障"><strong>国連憲章起草後の集団安全保障</strong></h4>
<p>サンフランシスコ会議での起草を経て成立した国連憲章並びに国際連合であったが、憲章43から47条で規定された国連軍の制度は成立せず(詳しくは第4節を見ること)、憲章42条の本来の意図での使用が封じられる事態となった。そのため一部の例外を除いて経済制裁は国連が集団安全保障で取りうるほぼ唯一の強制手段となり、憲章49条および50条の運用も経済制裁の枠組みでのみ行われたのである。次項では経済制裁の制度設計が行われた集団措置特別委員会の報告書や、冷戦下に行われた主要な制裁として対南ローデシア制裁と南アフリカ制裁を見ていこう。</p>
</section>
</section>
<section id="第2項-冷戦下の経済制裁-対南ローデシア制裁と対南アフリカ制裁" class="level3">
<h3 class="anchored" data-anchor-id="第2項-冷戦下の経済制裁-対南ローデシア制裁と対南アフリカ制裁">第2項　冷戦下の経済制裁　対南ローデシア制裁と対南アフリカ制裁</h3>
<section id="集団措置特別委員会" class="level4">
<h4 class="anchored" data-anchor-id="集団措置特別委員会"><strong>集団措置特別委員会</strong></h4>
<p>冷戦下においても国連の集団安全保障体制をより実行的なものとするべくその見直しを行なった事例は存在した。1950年の朝鮮戦争の際に運よく安保理は軍事的な措置の発動に成功したものの、憲章43条の特別協定の不存在や対応の遅れによりその措置は憲章の起草時に理想とされていたものを実現できなかったのである。そういった問題への対処や安保理が機能不全となった際の対応策として総会にて1950年11月3日に採択された総会決議377(通称平和の為の結集決議; U4P)のセクションDでは国連即応部隊構想も含めた集団的な強制措置を強化するための<strong>集団措置特別委員会[^06_ch06-49]</strong>が設立された。集団措置特別委員会は主たる報告書として第1~第3報告書(それぞれA/1891, A2215, A/2713)を提出し、第三報告書の提出を了承する総会決議809[^06_ch06-50]にて休止されることとなった。</p>
<p>おそらく細かい内容は実際に各種報告書(日本語訳を別途配布している)を読んでもらったほうが早いがここで簡潔に内容をまとめるものとする。</p>
<p>第1報告書(A/1891)では国連の経済制裁として用いることができる措置の形態の列挙や、<strong>制裁を普遍的かつ迅速に行うことの重要性の確認</strong>、およびそれに伴い必要な加盟国の国内的措置の実施状況の受領や調整を行う制裁調整委員会の設立を提言がなされた。そして被制裁国だけでなく制裁発動国側も貿易関係の遮断や被制裁国からの報復行動により被害を受けること、その被害は被制裁国の近隣国や経済関係の深い国に集中しうることや、そのような国が制裁の履行に後ろ向きとなり集団行動が弱まりうることが確認された。またその現象の対処のために代替市場や原材料の提供、援助や貸付、助成金の提供を行いうること、並びにそのような厳格な規則を定めることができないとしつつも「<strong>個々の国家への過度の困難を軽減し、侵略に対する国連の行動から生じる総負担が広くかつ公平に分配されることを確保するための適切な措置がとられることが明らかに望ましい</strong>」とし、「<strong>加盟国の完全な参加を奨励する上で、侵略に対する共同行動で適用される様々な措置から生じる犠牲の公平な分担のために十分な規定が設けられることが非常に重要である</strong>」とされた。</p>
<p>また第2報告書(A/2215)は同様の趣旨を引き継ぎつつ、集団的措置の運用における相互援助の重要性を強調した上で平和の為の結集によって発動される制裁措置にも憲章49条, 50条の規定が適用されることを確認した。さらに、制裁の履行に伴い生じる不公平な負担については、第1報告書と同様に幾つかの負担の調整のための手法を挙げた上で、どのような手法により対処すべきかはケースバイケースとした。ただし、<strong>相互援助の取極や負担を公平に分配するシステムが制裁へ参加する意欲に直接的に影響するとして制裁に伴う不公平な負担への援助問題を迅速に協議するための機構を安保理または総会が設置すべきであるとし、それこそが国連憲章50条に合致するとした</strong>。</p>
<p>このような集団措置特別委員会の議論並びに報告書は部分的に以降の対ローデシア・対南アフリカ制裁に活かされることとなった。第1報告書において提言された制裁の調整委員会は対ローデシア・対南アフリカ制裁において安保理の下部機関（制裁委員会）としてアドホックに設立され、加盟国からの情報収集や制裁手段の調整が行われることとなる。また制裁に伴って発生する制裁を実行する側の負担の存在やそれが被制裁国の近隣諸国に集中して発生すること、ならびに近隣諸国の制裁破りによって制裁の効果が著しく低下することの指摘は実際に対ローデシア・対南アフリカ制裁で発生することとなった。</p>
</section>
<section id="対南ローデシア制裁" class="level4">
<h4 class="anchored" data-anchor-id="対南ローデシア制裁"><strong>対南ローデシア制裁</strong></h4>
<p>冷戦下において、安保理による[^06_ch06-51]本格的な[^06_ch06-52]経済制裁が初めて用いられたのは1966年の南ローデシア制裁である。英領南ローデシア地域では少数の白人のみが参政権を持つ極端な人種差別体制が存在し、それ故に南ローデシアから英国への独立要請が拒否され続けてきた。そして1965年11月11日には当時のイアン・スミス政権により一方的な独立宣言が発され、それを反乱行為とみなした英国により同日中に独自の経済制裁が行われ、翌日には安全保障理事会へ付託がなされた。</p>
<p>安保理では11/12日中に決議216を採択し、一方的独立宣言の非難の上で、加盟国に対する南ローデシア政権の承認と援助を控えることの要請(勧告)が行われた。また20日の決議217[^06_ch06-53]で脅威認定を行い、翌年4月9日の決議221で決議216の勧告に反して石油供給がなされていることの指摘と、その結果として南ローデシアの事態が平和に対する脅威を構成する旨の決定等がなされた。</p>
<p>これらを経て平和に対する脅威と認定された南ローデシア情勢では、1966年12月16日の決議232にて憲章39条および41条に基づき<strong>部分的制裁</strong>が決定され、特定産品[^06_ch06-54]の輸入やそれに伴う資金移動の停止や自国民および自国領内および自国籍船舶・航空機の活動の阻止、石油や軍事関連物資の供給停止などを加盟国に義務付けた。同決議では主文にて「この決議の日の前に結ばれた契約または与えられた許可に関わらず」との記載があり、<strong>決議採択以前の私人の契約や権利等も制裁の枠組みで訴求的に停止される</strong>ことが決定された。</p>
<p>決議232では決議内で指定された産品のみが禁輸対象となる部分的制裁であったが、さらに1年半後の1968年5月29日の決議253[^06_ch06-55]では南ローデシアから輸出される全ての産品の輸入禁止が決定され、包括的制裁が行われるようになった。そのうえ決議253では、年金や医療・人道・教育・食料のための支払いを例外として南ローデシア政権や商業・工業・公益企業に対する資金移動の禁止や金融凍結が定められたほか、加盟国に対して憲章41条のもと可能な全ての行動をとるよう要請がなされた。</p>
<p>また、決議253では加盟国に対しこれらの決定を憲章25条に従って実施するよう要請し、決定の不履行または履行拒否が憲章25条の違反となることの喚起がされた[^06_ch06-56]。具体的にこのような制裁不履行を行なっていた代表的な国家は南アフリカおよびポルトガルである[^06_ch06-57]。南アの法体系においては条約は対応する国内法の制定によって初めて国内法上の効力を持つが、南アは決議232や253に対応する国内法の制定を行わなかった。またポルトガルは決議履行のための国内的措置を講じず、決議232の採択時に棄権した常任理事国がいたことや決議232が”内陸国の海洋の自由並びに海洋にアクセスする自由”を定める国際条約に反すること、南アフリカの事項が国内問題であって安保理の管轄でないことなどを挙げて決議232が無効であるとの主張を行なった。それを受けて決議253では制裁の履行が加盟国の義務であり、履行の拒否や不履行が憲章への違反を構成する旨が盛り込まれたのである。</p>
<p>また、決議253では画期的な出来事として南ローデシアと隣国関係にあり[^06_ch06-58]なおかつ特に南ローデシアから敵対行動を受けていたザンビアについて、包括的制裁によって生じる「特別な経済問題」の解決を助ける目的で<strong>ザンビアへの援助を加盟国や国連・国際機関に要請する主文が盛り込まれた</strong>。当時は先述の通り南アやポルトガル、およびその他の加盟国による制裁破りが横行し、南ローデシアが1年分の石油備蓄を用意できるほどであった。対してもともとローデシアを経由して石油が供給されていたザンビアは対南ローデシアの石油禁輸によって石油の供給が絶たれる事態となった。そのため決議253ではザンビアへの援助要請が盛り込まれたのであり[^06_ch06-59]、憲章49条や50条が援用されていないものの、経済制裁により生じた「特別な経済問題」の安保理による解決が試みられた[^06_ch06-60]一例となった。</p>
<p>憲章50条の援用自体は決議232から決議253の過程で行われていた。1967年2月には決議232に基づく履行状況調査のための加盟国から事務総長への書簡[^06_ch06-61]の中で、ポルトガルは「南ローデシアに対する制裁を履行すればポルトガル領モザンビークが経済的困難に陥るとして憲章50条に基づく協議の要請と経済制裁への不参加の意思を発し、同様の趣旨をザンビアやボツワナ、マラウイが表明していた。</p>
<p>その後の1973年には対南ローデシア制裁に対する南アフリカの妨害行為についてのザンビアの要請[^06_ch06-62]に基づいて安全保障理事会が招集[^06_ch06-63]され、2月7日の決議326にて経済制裁措置がザンビアに特別の経済問題をもたらすことの認識と、南ローデシアを迂回する代替輸送ルートの需要調査のための特別使節団の派遣が決定された。そして特別使節団による報告[^06_ch06-64]3月10日の決議329では特別使節団報告に従って全ての国にザンビアへの財政援助が要請され、国連各種機関にもザンビアへの援助要請がなされた[^06_ch06-65]。またその後の1976年には、憲章49条と50条を念頭に置きつつモザンビークの制裁履行を称賛し、加盟国や各種機関に対してモザンビークへの即時の支援を要請する決議386[^06_ch06-66]が採択された。こうして南ローデシア情勢は実際に49条および50条が適用された事例となったのである。</p>
<p>ただし、対南ローデシアの制裁自体は全体として失敗に終わったといえよう。制裁により南ローデシア経済は打撃を受けたものの、ポルトガル領モザンビークや南アフリカを通じた制裁逃れによって南ローデシア経済や石油の供給体制は崩壊しなかった。その後の1975年にモザンビークがポルトガルから独立し対南ローデシア制裁に踏み切ったことや、南ローデシア国内の対ゲリラ戦費、慢性的な経済財政状況の悪化により決議232の強制措置開始から10年以上を経て1979年に英国の暫定統治が回復し、その後の民主化・独立を受けて制裁措置は終了した。</p>
</section>
<section id="対南アフリカ制裁" class="level4">
<h4 class="anchored" data-anchor-id="対南アフリカ制裁"><strong>対南アフリカ制裁</strong></h4>
<p>アパルトヘイト政策やナミビア地域の占領政策をとっていた南アフリカに対しては個別国家による禁輸措置などが行われていた。1962年には総会決議1761により、禁輸や南アフリカ籍船舶・航空機の自国領域通過禁止措置などが呼びかけられ、1963年の安保理決議181でも自主的な武器禁輸措置が要請された。そして1977年の安保理決議418[^06_ch06-67]では強制的な武器・軍事物資の禁輸が決定されたものの、軍事物資以外を含めた包括的禁輸には至らなかった。1981年には安保理にて強制的な包括的経済制裁を定めた決議案などへの米英仏の拒否権行使がなされ、第8回緊急特別総会の開催と安保理に対して強制的な包括的制裁を実施するよう促すとともに加盟国へ自主的に包括的制裁を行うよう求める決議の採択が行われた。</p>
<p>その後、1980年代に入り対南アフリカ制裁においは南アフリカからの軍事攻撃や侵攻によって生じた周辺国の直接的な損害について南アフリカに補償を要求するとともに、憲章49条や50条を暗黙に念頭に置いて各国に援助を求める決議[^06_ch06-68]が採択されることとなった。南アフリカは国連の経済制裁を実施する近隣諸国に対抗し、南アフリカから近隣諸国への経済制裁の実施や、近隣諸国の鉄道路への破壊工作による南アフリカを経由した輸送ルートへの依存の強制を行っていたのである。これを受け、軍事物資や武器禁輸などに加えて、加盟国に自主的な経済制裁を呼びかける1985年の安保理決議569に先立つ安保理2733回会合においては、包括的経済制裁が南アフリカ政府よりも制裁対象国の近隣国家（最前線諸国）への打撃となる旨の主張や、南アフリカへの依存度を減らすための経済援助の提言、逆にそもそも制裁そのものが最前線諸国を含めたアフリカ地域の要望によって行われたものであり援助は不要とする旨の反論などが行われることとなった。<br>
また1986年には米国議会の包括的反アパルトヘイト法の可決を経てアメリカによる自主的な包括的経済制裁（禁輸・投資禁止・航空機乗り入れ禁止など）が行われ、西側の多くの企業が南アフリカから撤退することとなった。ただ強制的な包括的経済制裁の実施までには至らず、1988年の3月[^06_ch06-69]には南アフリカに対する包括的経済制裁を加盟国に強制する決議案S/19585の採択が試みられるも英米の拒否権により棄却されている。</p>
<p>さらに総会においては1988年の総会決議43/209にて<br>
プレトリア政権のアパルトヘイト政策に起因する、南部アフリカにおける状況の継続的な悪化により、最前線諸国とその他の国境諸国が直面する経済問題がさらに悪化していることを深く懸念し、<br>
国際社会に対し、南アフリカまたは国際社会が南アフリカに対して講じる経済措置の影響に抵抗するための最前線諸国およびその他の周辺諸国の個別的および集団的能力を高めるために必要な財政的、物資的および技術的支援を、各国の国家および地域的計画と戦略に従って、適時に効果的な方法で引き続き提供するよう強く求める。<br>
といった内容が採択されるなど憲章49条および50条を念頭に置いた行動自体は存在した。</p>
<p>その後冷戦構造の崩壊[^06_ch06-70]や、長期の経済的孤立による南アフリカ経済の悪化、国内治安情勢の悪化によりアパルトヘイト政策の転換や政治犯の釈放が行われた。そして各国による自主的な経済制裁の解除や1994年の安保理決議919による国連の武器禁輸措置解除などにより南アフリカ制裁は終了することとなる。</p>
</section>
<section id="冷戦下における経済制裁措置の総評" class="level4">
<h4 class="anchored" data-anchor-id="冷戦下における経済制裁措置の総評"><strong>冷戦下における経済制裁措置の総評</strong></h4>
<p>冷戦下では大概の情勢ないし事態が東西冷戦の対立構造へと組み込まれ、それに対する強力な措置は拒否権の対象となるために大規模な制裁は行われなかった。また、被制裁国の経済状況も、当然にある程度の打撃を受けたものの近隣国やその他の国による制裁破りが横行したため制裁の威力が限られたものになり、被制裁国の国内における人道危機が国際社会で問題となることはなかった[^06_ch06-71]。ただ被制裁国の近隣諸国における制裁の実施に伴う被害や、被制裁国からの対抗制裁などの”制裁の最前線諸国”の問題は認識されていた。しかし制裁によって生じる第三国被害についても、制裁や被害の規模が限られており加盟国間の援助などにより比較的対処可能なレベルであった。</p>
<p>さらに言えば、そもそも経済制裁は武力行使よりも直接的な犠牲を伴わない穏当で平和的な手段であり、なおかつ国連や安保理、集団安全保障の名において行われる経済制裁はただその一点において合法化・正当化される”正戦”であった。そのために経済制裁が問題視されることは少なかったのだろう。そして経済制裁の主要なブレーキであった冷戦が終結した90年代において経済制裁は盛んに行われるようになり、様々な問題を露呈することになるのである。</p>
</section>
</section>
<section id="第3項-冷戦後の経済制裁" class="level3">
<h3 class="anchored" data-anchor-id="第3項-冷戦後の経済制裁">第3項 冷戦後の経済制裁</h3>
<p>冷戦終結後の1990年代は制裁の10年; Sanction Decadeとも称されるほど、経済制裁がよく行われた時代であった。1945年の国連成立から1990年までに安保理が強制力を持って(すなわち41条を用いて)経済制裁を行なったのは2回に止まったのに対し、1990年代の10年間には13の情勢において制裁が行われた。ここではその代表的なものとして、湾岸戦争に端を発する対イラク制裁や対ユーゴ制裁、対ハイチ制裁、対リビア制裁の制裁内容や影響を見ていこう。</p>
<section id="対イラク制裁" class="level4">
<h4 class="anchored" data-anchor-id="対イラク制裁"><strong>対イラク制裁</strong></h4>
<p>クウェート侵攻ならびに湾岸戦争の顛末は第4章に譲るとして、まずイラクによるクウェート侵攻の4日後に採択された1990年8月6日の<strong>決議661号</strong>の制裁内容を見ていこう。安保理決議661号では、イラクに対する完全撤退要求を履行させるため、制裁委員会の設置と加盟国に次の措置の決定を行なった。</p>
<p>①イラクおよびクウェートを原産とする全製品の輸入禁止<br>
②イラクおよびクウェートからの輸出を促進させる自国民または自国籍の船舶または自国領内の活動や資金移転の禁止<br>
③イラクおよびクウェートに対する自国民または自国籍による、もしくは自国量ないからの全ての製品 (厳密に医療目的とされるもの、および人道的状況下での食糧を除く) の供給停止<br>
④イラクおよびクウェートに対する金融凍結 (医療目的および人道的状況下での食糧を除く)</p>
<p>この通り対イラク制裁は医療物資および一部の食料品とその関連の支払いのための送金を除いて<strong>輸出入や金融取引を全面的に禁止する包括的制裁</strong>であった。そして制裁の開始後しばらくするとイラクの人道状況は大幅に悪化し、イラクにおける人道危機問題もまた安保理における最優先の議題として議論されるに至った。これを受け、食料品と衣料品の供給について制裁委員会の各メンバーの保留や反対がない限り合法的に購入・供給が行えるシステム(異議なし手続き；No Objection Procedure)が採用されたが、〜〜〜〜〜保留が多くなされた結果、人道的状況の改善はなされなかった。</p>
<p>8月25日の決議665ではイラク・クウェート近海に海上戦力を展開している加盟国に対して、安保理の権限のもとでイラクへ入出港する船舶の停止や積載物の検査を行う措置（事実上の海上封鎖）をとるよう要請し、決議661の制裁実施を確保しようとした。</p>
<p>制裁開始から5週間後の1990年9月13日、安保理は決議666にてイラクの人道状況が深刻化していることについて初めて言及を行い、必要に応じてイラク・クウェートへの食料供給を行うことを決定した。</p>
<p>1990年11月29日に安保理は決議678を採択し、91年1月15日までの45日間でイラク軍がクウェートから撤退しない場合、撤退の確保や安保理決議の履行強制などのための必要なあらゆる措置を加盟国に授権する（≒武力行使の権限を与える）と決定した。そしてイラク軍の撤退がなされることはなく、91年1月16日には米英仏を中心とする多国籍軍が武力行使を開始し湾岸戦争が勃発した。湾岸戦争では42日間の空爆と6日間の地上作戦が行われ、その過程で発電所や水道、</p>
<p>などが破壊される</p>
<p>これらを受けて、安全保障理事会は議長声明(S/22322)にてイラクにおける緊急の人道支援の必要性を評価するため、アーティサーリ国連事務次官を中心とする調査団の派遣を行なった。<br>
アーティサーリレポートの</p>
<p>イラクはもともと食料の70%を輸入に依存しており、制裁によって供給が絶たれることとなった。また外国産の野菜類の種子や農薬・肥料、灌漑用の燃料、飼料、家畜用ワクチン[^06_ch06-72]の禁輸に伴い、国内での食糧生産能力も危機的状況となった。結果として主要食料品の月間国民割り当ては制裁開始時の90年9月時点から91年1月までの4ヶ月間で60%減少[^06_ch06-73]した。</p>
<p>また燃料の供給停止により工場労働者の90%が出勤停止となるなど国民の収入も減少し、預金の引き出し制限も課された一方で、制裁開始時からほとんどの基本生活必需品の価格が1000%以上上昇するなど、一般市民は最低限度の生活水準を満たす購買力すら欠いている状況である</p>
<p>同様に上下水道やゴミ処理などの衛生分野、医療・保健分野についても制裁による必要な物資の供給停止や紛争に伴う施設の破壊などによって機器的状況を迎えている。そして物流・通信・エネルギー供給についても、爆撃による橋や鉄道・電話線・製油所・発電施設などの破壊によって壊滅的な被害を受けており、エネルギーの大規模供給なくして援助すらままならない状況である。<br>
これらの対処のため主要食料品の制裁解除ならびに食料品や燃料の緊急供給、製油所や発電施設の応急修理が必要である。</p>
<p>これらを元にアーティサーリレポートでは、主要食料品の制裁解除ならびに食料品の緊急供給、</p>
<p>S/22328</p>
<p>灌漑に必須の燃料の供給停止により収穫量の見通しは壊滅的であるとされた。</p>
<p>そして安保理は1991年4月3日の決議687にて停戦の条件としてイラクによる大量破壊兵器や中距離以上の弾道ミサイルの廃棄やその国際的な査察の無条件受け入れを提示し、これをイラクが受け入れたことで湾岸戦争の正式な停戦が成立した。決議687では国際的な査察を行う委員会としてUNSCOM(United Nations Special COMissionl; 国連特別委員会)が設立されIAEAとともにイラク現地での査察が行われることとなる。また、決議687では決議661で決定されたイラクへの包括的制裁は食料品・医療品、必要な民政物資の供給の承認プロセスが簡略化されたことを除いて維持され、大量破壊兵器の廃棄が確認されるまで制裁が継続されることとなった。</p>
</section>
<section id="対ユーゴ制裁" class="level4">
<h4 class="anchored" data-anchor-id="対ユーゴ制裁"><strong>対ユーゴ制裁</strong></h4>
<p><a href="https://www3.gmu.edu/programs/icar/ijps/vol3_1/Delvic.htm" class="uri">https://www3.gmu.edu/programs/icar/ijps/vol3_1/Delvic.htm</a></p>
</section>
<section id="対ハイチ制裁" class="level4">
<h4 class="anchored" data-anchor-id="対ハイチ制裁"><strong>対ハイチ制裁</strong></h4>
</section>
</section>
<section id="第3項-経済制裁に伴う問題とその後" class="level3">
<h3 class="anchored" data-anchor-id="第3項-経済制裁に伴う問題とその後">第3項 経済制裁に伴う問題とその後</h3>
<p>制裁破り問題　加盟国レベル - 起票レベル<br>
制裁が効くまで時間がかかる＆ワンチャン逆効果になる<br>
制裁履行国側の被害<br>
人道危機<br>
が問題であった。昔から問題だったし冷戦下では特に制裁破りと制裁履行国側の被害が、冷戦後にはさらに人道危機がとりわけ問題になった。<br>
だからガリが「〜〜」って言ったわけだね。</p>
</section>
<section id="第4項-国連憲章第50条の注解第二校" class="level3">
<h3 class="anchored" data-anchor-id="第4項-国連憲章第50条の注解第二校">第4項 国連憲章第50条の注解（第二校）</h3>
<p>タイトル落ちである。</p>
<p>「特別の経済問題」とはなにか<br>
「無関係の国は」協議権を有するが経済的損失の補償まで含められると解することができるのか　すなわち、補償や援助を権利として要求しうるのか　もしその場合に安保理は損失を被った国の損失を補償すべき義務を負うのか<br>
50条は協議権の付与によって命令的経済制裁の履行を促す誘因を提供するように設定されたのか<br>
安保理が援助や補償を決定した場合、どんな形でそれが行われるのか　憲章の他の条文からどのような形態が示唆されるのか</p>
<p>41条はあくまで平和と安全の脅威となる行動をきょうせいてきに修正すること　処罰ではない. それを目的にして制裁対象国を孤立させることを規定している。<br>
41条で経済制裁を発動したら25条に基づいて全ての加盟国に義務付与　ただし48(1)により安保理が免除を認めれば除外　でも経済制裁は普遍的に履行をすることで実効性が高まる。2(6)により非加盟国も含めて全ての国に制裁を履行するよう要請してきた。</p>
<p>安保理の制裁は各国の国内法令によって履行される。だから2(7)の例外　これによってタイムラグが生じうる<br>
私人の私的権利についても「この決議の日の前に締結された契約や与えられた許可に関わらず」取引や貿易を禁止する形で阻害する。<br>
他の国際協定に基づく義務や権利についても、憲章103条によって憲章上の義務が優越し、その義務と抵触する義務を生じる条約の該当義務は麻痺する。他の国際協定に基づく義務を履行できずとも国家責任は生じない。ウィーン条約法条約60条の重大な違反であっても条約の終了根拠とならない</p>
<p>制裁を発動した国もまた経済的損失を必ず被ることになる。経済制裁が意図するものではない制裁履行国の困窮、死活的ともなりかねない国家の個別利益と憲章上の義務の衝突が起きる</p>
<p>42条は死んだからそこで50条は使われなかった。あと、41条の非命令的な措置（外交関係途絶）とかで経済的な問題はそんなに発生しなかったので、50条の援用は安保理による命令的経済制裁の発動の際に限定された[^06_ch06-74]。<br>
対南ローデシア経済制裁　対いらく制裁　対ユーゴスラビア制裁がある</p>
<p>50は非加盟国にも安保理との協議権を与えている（起草過程からの理由は不明らしい）。条約法条約では条約当事国が第三国に権利付与を意図している場合[§36(1)]、権利を行使しようとする第三国は条約に定められている条件を遵守する必要がある[§36(2)]。すなわち50に基づく協議権は協議要請国が安保理の発動した経済制裁を履行した時のみ<br>
非加盟国の「特別の経済問題」は加盟国の制裁履行により生じた問題から、非加盟国の制裁履行後、間接的に生じる問題まで十分に含みうる。</p>
<p>そもそも50条は経済制裁の履行によって生じる経済問題にスコープを当てていて、先行違法行為による被害の苦境は考えていない。湾岸戦争ではこのような損害に対するイラクの国際責任を安保理が認定することと、国連補償委員会や国連補償基金により運営される請求メカニズムの創設(S/res/687, 692)を通じて取り扱われた。</p>
<p>あと制裁が履行される前に協議をする件はない。でも予防的なものとか先行するものも有益かもしれないし、逆に7章の目的のもと制裁を柔軟に行うことや制裁を発動することの障害ともなりうる。</p>
<p>50条の目的は、集団安全保障体制維持のために設定された制裁発動上必要とされる負担を履行した国に生じた経済的損失を軽減することに端を発する。39条の認定により強制措置として41条や42条により措置が発動し、25条により加盟国への義務付与、103条により抵触する義務の国家責任回避が行われ、48(1)により安保理が履行形態を決定する。39条により勧告を行うこともできる</p>
<p>50条は命令的経済制裁による経済的不利益を救済する唯一の手段だが、文言的にも協議権までしか定めていない。<br>
7章に基づき安保理に与えられる広範な権限は、安保理が迅速かつ断固として対処することを可能にすべく意図されたもの　平和の脅威は迅速な対処を必要とし、クウェート侵攻のようにいきなり発生する　補償を権利として認めれば、特別の経済問題が生じた時に協議が行われ、その権利主張の真偽を確かめるために安保理や下部機関が証拠収集を行い、必然的に制裁の発動や実施を遅らせる。実際に補償が認められれば安保理が予見される費用にあてる資金確保の義務が生じ、当該義務も制裁発動を遅らせる要因になる。<br>
ユーゴ制裁の教訓は、制裁の迅速かつ厳格な実施は第三国に生じる経済的損失を軽減するという点で重要であることだった。迅速かつ厳格に制裁を実施することで効果を最大化し、早期に目的を達成することによって制裁体制がより早く解除され、その分付随する被害も減る。</p>
<p>安保理決議の履行はあくまで国内的な実施メカニズムに依存する。国連が独自に監視することで、透明性は高まるが、対ユーゴ制裁の教訓として、そのような制裁不履行の防止に不十分であった。<br>
制裁不履行国に対して安保理が制裁を行う恐れは低いので、国内的な制裁実施措置を促進する手段が必要とされる。被害の補償はそれをなしうる<br>
補償は49条の相互援助により、加盟国や適当な国際機関への要請を通じて行われうるし、48条による制裁免除も可能だろう。ただ、制裁の抜け駆けは制裁の効果を著しく減らしうるものである以上、その免除はかなり厳しい。</p>
<p>ICJによるある種の経費事件の傍論からすれば、補償のための支払いはこの機構の経費として認められうるだろう。92年から国連憲章および機構の役割強化に関する特別委員会で話されてる　95年には同委員会で事務総長により、補償や援助のガイドラインの作成や信託基金の設立、国際金融機関による経済援助が提案されている。</p>
<p>憲章50条になった。</p>
<p>article 50 the charter of the UN Brumo Simma</p>
<p>国連安保理の機能変化<br>
『国際法遵守の管理モデル　新しい主権のあり方』<br>
『経済制裁の研究　経済制裁の政治経済学的位置付け』<br>
UN sanctions burden sharing: Article 50 of the UN charter and assistance to third states→モロこれやん<br>
The Rhodesian Question at the United Nations　J. LEO CEFKIN<br>
レポータリーよもう！<br>
Art. 50, Repertory, Suppl. 4, vol.&nbsp;I (1966-1969)<br>
Art. 50, Repertory, Suppl. 5, vol.&nbsp;II (1970-1978)</p>
<p>Collective Security and the Economic Interventionism of the UN—the need for a coherent and Integrated Approach<br>
<a href="https://archive.globalpolicy.org/component/content/article/202-sanctions/41612-sanctions-an-analysis.html" class="uri">https://archive.globalpolicy.org/component/content/article/202-sanctions/41612-sanctions-an-analysis.html</a><br>
<a href="https://ciaotest.cc.columbia.edu/isa/log01/" class="uri">https://ciaotest.cc.columbia.edu/isa/log01/</a><br>
吉村　EUおよびその加盟国における国連の非軍事的制裁とその適用に関する法的問題<br>
国連の非軍事的制裁における制裁委員会の機能と役割<br>
国連非軍事的制裁の法的問題<br>
国連による経済制裁–国連憲章第50条の意義</p>
<p>United Nations Sanctions Management: A Case Study of the Iraq Sanction Comittee 1990-1994<br>
Erika de Wet The chapter VII Power of the UNSC:studies in sinternational law<br>
Dan Sarooshi The United Nations and the development of Collective security: the delegation by the UN security council of its chapter 7 power</p>
<p>David Cortright and George A Lopes, Smart SAcntions;Targeting Economic Statecraft<br>
MRI daily economic comment<br>
<a href="https://oapub.org/soc/index.php/EJPSS/article/view/1424" class="uri">https://oapub.org/soc/index.php/EJPSS/article/view/1424</a></p>
<p><a href="https://2001-2009.state.gov/r/pa/ho/time/pcw/98678.htm#:~:text=The%20international%20community%20had%20begun,military%20commitment%20in%20occupying%20Namibia" class="uri">https://2001-2009.state.gov/r/pa/ho/time/pcw/98678.htm#:~:text=The%20international%20community%20had%20begun,military%20commitment%20in%20occupying%20Namibia</a></p>
<p><a href="https://history.state.gov/historicaldocuments/frus1951v01/d222#:~:text=adoption%20and%20application%20of%20measures%3B,operation%20of%20the%20collective%20measures" class="uri">https://history.state.gov/historicaldocuments/frus1951v01/d222#:~:text=adoption%20and%20application%20of%20measures%3B,operation%20of%20the%20collective%20measures</a><br>
<a href="https://www.globalsecurity.org/military/ops/mio.htm" class="uri">https://www.globalsecurity.org/military/ops/mio.htm</a></p>
<p>安全保障理事会が憲章25条の規定に基づいて拘束的決定を行える範囲<br>
41, 42条に関してはだいたい慣例的に拘束的と看做されてる<br>
1971ナミビア事件勧告的意見：強制措置に限られない⇨学説も国家実行も一致なし<br>
勧告(適応に関する法的拘束力なし)っぽいやつもある。<br>
<strong>非加盟国に対する制裁については一般国際法上の基準を逸脱できない</strong></p>
<p>安保理決議において勧告には違法性阻却の効果が伴うのか？<br>
・否定的　</p>
<p>通称関係条約との抵触</p>
</section>
</section>
<section id="第4節-国連平和維持活動pko" class="level2">
<h2 class="anchored" data-anchor-id="第4節-国連平和維持活動pko"><strong>第4節 国連平和維持活動(PKO)</strong></h2>
<ol type="1">
<li>PKOの 概要
<ol type="1">
<li>三原則→7章PKO→第三世代<br>
</li>
<li></li>
</ol></li>
<li>PKO 3ヶ月クッキング(決議採択からPKOができるまで)<br>
United Nations Peacekeeping Operations: Principles and Guidelineベースで解説<br>
時間かかるんだよね〜って感じ　6月<br>
</li>
<li>PKOと国連軍、即応体制の歴史的経緯　冷戦下編
<ol type="1">
<li>国連軍の設立失敗（『国連の平和維持活動』とか<a href="https://docs.google.com/document/d/1GbhRkXpmK4YWCETEgJjKOn1gKJgDAQN5HNJhJRdabDE/edit?tab=t.0とか）">https://docs.google.com/document/d/1GbhRkXpmK4YWCETEgJjKOn1gKJgDAQN5HNJhJRdabDE/edit?tab=t.0</a> , <a href="https://docs.google.com/document/d/16VEjLL7InewxU88IIRHTKB55KMbShz6dawFA267f9H4/edit?tab=t.0" class="uri">https://docs.google.com/document/d/16VEjLL7InewxU88IIRHTKB55KMbShz6dawFA267f9H4/edit?tab=t.0</a> とか)<br>
</li>
<li>UNTSOの登場<br>
初期の小さなPKOだったから費用負担とかは気にされなかったよ　国連の通常予算で払われたよ(第2節でもちょっと触れた)<br>
</li>
<li>朝鮮国連軍<br>
43条の特別協定はなかったけどわりと国連が初期に考えていた集団安全保障体制に近いよ〜, アメ公が中心に加盟国の直接の兵力・費用負担だったよ<br>
</li>
<li>UNEF, ONUCの登場<br>
デカすぎで仏ソが支払い拒否　PKOの地位も含めて”ある種の経費事件”いき<br>
⇨総会決議1874 (第2節でもちょっと触れた)<br>
</li>
<li>冷戦下における即応体制向上・集団安保見直しの議論
<ol type="1">
<li>リー事務総長のUN legionとか(萌芽はAnnual report of the Secretary-General on the work of the Organization, 1 July 1947 – 30 June 1948)<br>
</li>
<li>UNEF提唱者のカナダ外相提案　Lester B. Pearson, “Force for UN”<br>
(リップサービスだろうし存在紹介だけでいいと思う)<br>
</li>
<li>1963年9月 ケネディ総会演説a new United Nations Peace Force<br>
(リップサービスだろうし存在紹介だけでいいと思う)<br>
</li>
<li>G. Clark and L. B. Sohn, World Peace Through World Law<br>
</li>
<li>平和のための結集決議　いわゆる平和のための結集制度にスコープが向きがちだけど、総会に集団措置委員会ができたよ。（1次資料の報告書ベースで結果を執筆　A/1891とA/2215 訳文あり）<br>
あと総会決議377(<strong>C</strong>)<br>
</li>
<li>平和維持活動特別委員会の議論『国連の平和維持活動』p349-389, 『国際連合の基本問題』第2章あたり<br>
</li>
</ol></li>
</ol></li>
<li>PKOと国連軍、即応体制の歴史的経緯　冷戦後〜補遺まで
<ol type="1">
<li>湾岸戦争の勝利<br>
└可能ならばなんで国連軍編成に失敗したか（時間かかるからだったと思う）<br>
</li>
<li>『平和への課題』における常設国連軍構想<br>
⇨PDD-25による失敗確定演出<br>
</li>
<li>B. Urquhart提案<br>
</li>
<li>PKO待機取り決めから待機体制UNSASへの改組<br>
UN ’legionの6章あたりを参照するといい（訳文あり）<br>
</li>
<li>PKOの失敗
<ol type="1">
<li>ソマリア：マンデートの度重なる拡大⇨内戦当事者化⇨モガディシオ⇨全面撤退（補遺の議論中に撤退中）<br>
</li>
<li>ルワンダ：現地司令官からの度重なるジェノサイド警告をPKO局が無視⇨決議912による大規模撤退⇨918によりムキムキPKOとなるも待機軍体制がクソの役に立たず⇨929により旧政府側に与するフランスが多国籍軍として介入　PKOの派遣がより困難に<br>
</li>
<li>ボスニア：実はあんま知らん<br>
決議998による重装備部隊の設立<br>
</li>
</ol></li>
</ol></li>
<li>PKOと国連軍、即応体制　補遺とその後
<ol type="1">
<li>『平和への課題：補遺』における常設国連即応部隊構想<br>
中身の解説<br>
</li>
<li>オランダによるUN rapid deployment bridge提案(Urquhart提案の拡張)<br>
</li>
<li>カナダ提案　司令部だけ作ろうぜ！　命令系統に時間がかかることから<br>
</li>
<li>デンマークによるSHIRBRIG<br>
実際に動いたこととか政治状況変化で解散したこととかまで　脚注でもいいかも<br>
</li>
</ol></li>
<li>PKOと国連軍、即応体制　補遺とその後のその後（ざっくり）
<ol type="1">
<li>コソボ紛争における一方的武力行使　ダルフールにおける対応の失敗<br>
</li>
<li>ブラフミ報告<br>
</li>
<li>地域機構における待機制度の発展　NATO, EU, au<br>
</li>
<li>UNEPS構想<br>
</li>
</ol></li>
<li>何が問題なのか</li>
</ol>
<p>PKOができるまでのプロセスのお話。</p>
<p>PKO財政問題<br>
平和維持活動に関する特別委員会</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">総会決議1874<br>総会は、 1962年12月19日の総会決議1954B(XVII)に基づいて提出された国連 の行政及び予算手続の検討に関する作業部会の報告書を評価し、 合意された取決めによって別途カバーされていない範囲で、平和維持活動の財政的負担を公平に分担する必要性を認識し、 1.将来開始される可能性のある多額の支出を伴う平和維持活動の費用を、分担金、任意拠出金、あるいはその組み合わせにより公平に分担するためのガイドラインとして、とりわけ以下の原則が役立つことを確認する。 （a） このような活動の資金調達はすべての国連加盟国の共同責任である。 （b） 経済的により発展した国々は比較的多額の貢献をすることができる立場にあるのに対し、経済的に後進的な国々は多額の支出を伴う平和維持活動に貢献する能力が比較的限られている。 （ｃ） 集団責任の原則を損なうことなく、加盟国からの自発的な拠出を奨励するためにあらゆる努力がなされるべきである。 （ｄ） 安全保障理事会常任理事国の平和と安全の維持に関する特別の責任は、平和と安全活動の資金調達への貢献と関連して考慮されるべきである。 （ｅ） 状況により正当な理由がある場合には、総会は、平和維持活動につながる事件や行動の被害者である加盟国、あるいはこれに関与している加盟国の状況に特別な考慮を払わなければならない。 2.平和維持活動の資金調達のための規定が、活動が承認される時点で総会によってなされることを確保するための適切な行政手続きを確立する必要があると考える。 3.事務総長に対し、必要に応じて行政予算問題諮問委員会と協議の上、平和維持活動の承認時に総会が従うべき財政手続きの改善を目的とした適切な行政手続きを再検討し、この再検討の結果と、将来従うべき手続きに関して事務総長が希望する勧告を総会の第18回会期に報告するよう要請する。</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">総会決議</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</section>
<section id="参考文献" class="level2">
<h2 class="anchored" data-anchor-id="参考文献"><strong>参考文献</strong></h2>
<section id="第1節" class="level3">
<h3 class="anchored" data-anchor-id="第1節">第1節</h3>
<p>中谷和弘「湾岸戦争の事後救済機関としての国連補償委員会」 『国際社会の組織<br>
化と法』（信山社， 1996年） 339頁；<br>
武力紛争による環境損害の<br>
賠償メカニズムの制度化ー一国連補償委員会における環境損害請求の特徴を中心に<br>
儀村英司「国連補償委員会の法的性格 その設立根拠と準司法的機能をめぐって」 『西南学院大学大学院法学研究論集』第19巻 (2001年）101-136頁参照。</p>
<p>松浦　国連安全保障理事会　その限界と可能性<br>
<a href="https://unis.unvienna.org/unis/en/united_nations/un_introduction.html" class="uri">https://unis.unvienna.org/unis/en/united_nations/un_introduction.html</a><br>
<a href="https://www.un.org/en/ga/about/subsidiary/committees.shtml" class="uri">https://www.un.org/en/ga/about/subsidiary/committees.shtml</a><br>
<a href="https://www.mofa.go.jp/mofaj/gaiko/unsokai/index.html" class="uri">https://www.mofa.go.jp/mofaj/gaiko/unsokai/index.html</a></p>
<p><a href="https://www.nationsencyclopedia.com/United-Nations/The-Secretariat-STRUCTURE-AND-COMPOSITION-OF-THE-SECRETARIAT.html?utm_source=chatgpt.com">https://www.nationsencyclopedia.com/United-Nations/The-Secretariat-STRUCTURE-AND-COMPOSITION-OF-THE-SECRETARIAT.html</a></p>
<p><a href="https://www.ejil.org/pdfs/16/5/329.pdf" class="uri">https://www.ejil.org/pdfs/16/5/329.pdf</a></p>
<p>人権保障による平和構築<br>
The Law of the United Nations: A Critical Analysis of Its Fundamental Problems</p>
</section>
<section id="第2節" class="level3">
<h3 class="anchored" data-anchor-id="第2節">第2節</h3>
</section>
<section id="第3節" class="level3">
<h3 class="anchored" data-anchor-id="第3節">第3節</h3>
</section>
<section id="第4節" class="level3">
<h3 class="anchored" data-anchor-id="第4節">第4節</h3>
<p>『国連財政』田所晶章</p>
<p>今回の会議にかかわる安保理との関係の中で国連事務局の役割は以下の4つに類型化できる。<br>
①議事運営を支援する会議サービス(議事録作成や文書翻訳・配布など)の提供<br>
②独自の調査権限や安保理からの要請に基づく紛争の情報収集と安保理への報告<br>
③安保理の要請による国連事務局が実施する紛争の介入の提案や計画、安保理への報告<br>
④安保理の要請による介入措置の実施と結果の安保理への報告</p>
<p>まず拘束力を持つ安保理の”決定”の範囲について見ていこう。この点に関して1971年のナミビア事件勧告的意見[^06_ch06-75]では、7章下の強制措置に限らず憲章に従って採択された全ての安保理の決定が25条に基づいて拘束力をもちうるとし、さらに「決定する(decisions)」といった形式上の動詞が使用されているかどうかに依らず、決議の起草過程の議論や状況、文言全体などを包括的に見た上で法的効果を判断すべしとした。ただ、この勧告的意見における解釈には反対意見も多く、「憲章7章の”脅威認定”が明示的になされた上で決定された7章下の強制措置のみが加盟国に対して拘束力を持つ」というものがある[^06_ch06-76]。</p>
<p>[^06_ch06-1] 内政不干渉原則ともいわれるが筆者の好み(国家間の不干渉原則と紛らわしいため)により、2条7項の言葉を流用して国内管轄事項不干渉原則の名称を用いる。</p>
<p>[^06_ch06-2] 例えば集団安全保障のための安全保障理事会への協力義務など</p>
<p>[^06_ch06-3] 憲章2条7項の国内管轄事項不干渉原則に基づいて総会が討議や勧告できる範囲は制約されるとの見方もあるが、この説明においては省略している。とりわけ冷戦期の総会の議題では扱われがちな議論である。</p>
<p>[^06_ch06-4] 規模としては94-95年予算にて計89人からなる部局となっている。</p>
<p>[^06_ch06-5] この項に関しては特に『国連安全保障理事会』その限界と可能性に依拠している。安保理の非公式会合や一般的な交渉過程などが詳細に書いており、一読することをお勧めする。</p>
<p>[^06_ch06-6] なおアフリカ地域とアジア地域の交代で1議席をアラブ諸国に割り当てることが決まっている。</p>
<p>[^06_ch06-7] アジアグループにはそのようなルールがない。</p>
<p>[^06_ch06-8] 23条1項(抜粋)　総会は、第一に国際の平和及び安全の維持とこの機構のその他の目的とに対する国際連合加盟国の貢献に、更に衡平な地理的分配に特に妥当な考慮を払って、安全保障理事会の非常任理事国となる他の10の国際連合加盟国を選挙する</p>
<p>[^06_ch06-9] 安保理や総会での決定では手続き事項と実質事項がある。議事進行での投票などは手続き事項に属し、決議の採択などは実質事項に属する。</p>
<p>[^06_ch06-10] 慣例的に賛成投票でなくても棄権であれば拒否権行使には当たらない。すなわち「常任理事国の同意投票を含む」の意味するところ「常任理事国が反対票を投じていない」である。元々は字義通りの解釈ではあったが、冷戦下で議論が麻痺したことや現在の解釈でも拒否権の本来の意図は実現されることから、解釈変更がなされ慣例として定着している。</p>
<p>[^06_ch06-11] 安全保障理事会仮手続き規則 規則28にも同様の規定がある。「安全保障理事会は、特定の問題のために、委員会(commission or committee)または報告者を任命することができる。」</p>
<p>[^06_ch06-12] 旧ユーゴスラビア国際刑事裁判所：一連のユーゴスラビア紛争に関して集団殺害・戦争犯罪・人道に対する罪を犯した人間を訴追する安保理の下部機関である。1993年5月25日に安保理決議827で設立された。</p>
<p>[^06_ch06-13] ルワンダ国際刑事裁判所：ルワンダ内戦およびルワンダ虐殺に関して集団殺害や国際人道法の重大な違反を犯した人間を訴追する安保理の下部機関である。1994年11月8日の安保理決議955で設立された。</p>
<p>[^06_ch06-14] 国連特別委員会：湾岸戦争後のイラクにおいて生物・化学兵器や弾道ミサイルに関する武装解除の監視を行う安保理の下部機関である。1991年4月3日の安保理決議687で設立された。その後の特別委員会や対イラク制裁の顛末は〜〜〜〜を確認されたい。</p>
<p>[^06_ch06-15] 湾岸戦争におけるイラクの違法なクウェート侵攻によって生じた被害の責任原因と被害額を裁定する委員会である。安保理決議687で方針が策定され、事務総長レポートS/22559をもとに決議692によって設立された。最終的に2005年に任務が終了し、請求金額約3500億米ドルのうち200億ドルの補償が認定された。</p>
<p>[^06_ch06-16] 当時のアナン事務総長による報告書『より大きな自由に向けて』を受けて2005年世界サミットにより設立が決定され、12月に決議によって設立された。紛争後の平和構築と復旧のための統合戦略を助言・提案する組織である。</p>
<p>[^06_ch06-17] 憲章33条における平和的解決の手段として条文内には「交渉、審査、仲介、調停、仲裁裁判、司法的解決、地域的機関又は地域的取極の利用その他当事者が選ぶ平和的手段による解決」があげられている。</p>
<p>[^06_ch06-18] それぞれ1995年初頭のボスニア紛争および1994年のルワンダ内戦を念頭に置いている。</p>
<p>[^06_ch06-19] 2条7項の国内管轄事項不干渉原則では「但し、この原則は、第7章に基く強制措置の適用を妨げるものではない。」と但し書きがなされるなど一部の条項は適用が除外されている。</p>
<p>[^06_ch06-20] 憲章25条に関しては、”安全保障理事会の決定”の範囲や要件についても解釈に幅があるが、本会議ではあまり問題とならないと想定されるため説明を省略する。基本的に、脅威認定と7章に基づいて行動する旨の記載が記載された決議にて、”decide”や”shall”, (”calls upon”) などを用いた主文における決定が該当すると思ってもらって良いだろう。</p>
<p>[^06_ch06-21] 同時に、この立場においてもあくまで手続き上(採択プロセスなど)の合法性さえ確保されていれば良いとの見解も導ける。</p>
<p>[^06_ch06-22] 米国式のプログラム予算制度を用いていたためである。1974年に導入されたが、2020年頃に改革が行われ、現在では1年を一予算年度とする方式となっている。</p>
<p>[^06_ch06-23] 各国の国際公務員の税制の差を打ち消すための会計処理上発生する名目的な収入(職員課金)が殆どを占める。国連内の物販や見学料などの収益や基金の運用益は微々たるもの(収入の1/7ほど)である。</p>
<p>[^06_ch06-24] 総会決議A/48/231にて採択</p>
<p>[^06_ch06-25] 年額1000億円程度の規模となる。参考までに当時の日本の国家予算は70兆円ほどである。</p>
<p>[^06_ch06-26] 例えば人権(人権問題高等弁務官の設置など)・PKO・社会経済分野・麻薬や国際犯罪分野など</p>
<p>[^06_ch06-27] 例えば高級職員の給与カットや人員削減、果てはビジネスクラスからエコノミーへの航空券の格下げや、英語とフランス語以外の国連公用語への翻訳を遅らせることなど</p>
<p>[^06_ch06-28] A/C.5/48/SR.3や A/C.5/48/SR.4を見てみると面白いだろう。</p>
<p>[^06_ch06-29] 94年時点で80カ国がこの下限値に割り当てられている。この場合、1年あたりの分担金は年間12万ドル(1200万円)程度である。</p>
<p>[^06_ch06-30] 1972年にアメリカの要求を総会が受け入れる形で成立した。</p>
<p>[^06_ch06-31] そもそもに支払い意欲がないことや、ギリギリの滞納によって影響力を確保しようとする目論見があることのほかに、単に予算作成のサイクルが国連と国内で異なるがために、支払いが遅れざるを得ないことや、為替レートがドル安となるタイミングを見計らっていること(日本の言い分)が理由として挙げられる。</p>
<p>[^06_ch06-32] A/C.5/47/SR.71-EN.</p>
<p>[^06_ch06-33] 事務局の予算を監視する事務局内の委員会であるACABQの承認のもと、PKO1つあたり1億ドルまでの支出権限が事務総長にkyかされている。</p>
<p>[^06_ch06-34] A/48/912に基づく。</p>
<p>[^06_ch06-35] それぞれ、UNTSO(国連休戦監視機構)、UNMOGIP(国連インド・パキスタン軍事監視団)、UNOGIL(国連レバノン監視団)、UNGOMAP(国連アフガニスタン・パキスタン仲介ミッション)</p>
<p>[^06_ch06-36] なお会議後ではあるが、2001年には総会決議55/235にてA~Dの4グループによる区分から、A~Jの10グループによる区分へと細分化された。</p>
<p>[^06_ch06-37] https://www.sipri.org/databases/milex</p>
<p>[^06_ch06-38] 例えばこうした紛争において取りうる手段として、外交関係の停止など国家が外交政策の範囲内で行いうる非友好的な措置(報復; retorsion)などがあり象徴的な意味はあるものの、協力な措置とは言えない。そのために個別国家や安保理が何か強制力を行使したい時に一番に浮かぶのは経済制裁になるのである。</p>
<p>[^06_ch06-39] 特に経済的に優位な国がこのような”紛争解決手段としての経済制裁”を指向していた。</p>
<p>[^06_ch06-40] 1920年の連盟第1回総会にて規約16条の運用に関して考察を行う国際封鎖委員会が設置され、連盟第2回総会にて1921年10月4日の決議「規約16条適用の指針」の採択を経てこのような決定がなされた。</p>
<p>[^06_ch06-41] その他の制裁および制裁発動の試みとしては、連盟理事会による制裁発動要請手続き中に当事国が紛争を停止して未発に終わった対ポーランド(リトアニア侵攻)制裁, 対ユーゴスラビア(アルバニア侵攻)制裁, 対ギリシャ(ブルガリア侵攻)制裁や、理事国であったために制裁の発動が起きなかった対日本(満州侵攻)制裁、武器禁輸措置まで至ったが近隣国の制裁履行拒否と最終的な紛争当事国の脱退を招いた対ボリビア・パラグアイ(チャコ戦争)制裁がある。</p>
<p>[^06_ch06-42] ただそもそも、<strong>憲章の起草過程においては国連における主要な集団安全保障の手段は経済制裁ではなく軍事制裁であったようである</strong>。しかしながら軍事的措置の前提となる国連軍および兵力提供の特別協定の計画が頓挫し、当初想定していた軍事制裁による集団安全保障の計画は崩れたのである。</p>
<p>[^06_ch06-43] 直接の草案ではないが、ここから閲覧可能である。https://history.state.gov/historicaldocuments/frus1964-68v33/d333</p>
<p>[^06_ch06-44] ここから閲覧可能　https://www.dipublico.org/doc/instrumentos/163.html</p>
<p>[^06_ch06-45] サンフランシスコ会議における発言抄録はここから閲覧可能である。<a href="https://digitallibrary.un.org/record/1300969/?v=pdf" class="uri">https://digitallibrary.un.org/record/1300969/?v=pdf</a> このうちのvol12にダンバートンオークス提案の8章B節を担当する第3委員会の第3小委員会の発言抄録集がある。</p>
<p>[^06_ch06-46] 順に、(南ア)Doc. 649 III/3/34およびDoc. 704 III/3/36, UNCIO doc2 G/7 n3 doc361-362, UNCIO doc2 G/7 d(1) 3 doc213-214, (カナダ)Doc.782 III/3/41</p>
<p>[^06_ch06-47] 以前の脚注でも補足した通り、憲章起草時において強制措置の手段として主に想定されていたのは軍事的措置でありその措置を行う主体はP5の認識であった。そのためこの発言は経済制裁によって生じる近隣諸国への負担の偏りについてというよりも、43~47条における国連軍による軍事制裁を用いた集団安全保障のP5への負担の偏りについてという方が正しいだろう。</p>
<p>[^06_ch06-48] shallは義務を定める際に使われる。to joinと比べると義務としての相互援助の意味合いが強まったと言えるだろう。</p>
<p>[^06_ch06-49] 委員会の構成国はオーストラリア, ベルギー, ブラジル, ビルマ, カナダ, エジプト, フランス, メキシコ, フィリピン, トルコ, 英国, 米国, ベネズエラ, ユーゴスラビアであり、西側諸国と第三世界諸国によって占められていた。そのため、当時の西側諸国にとっての理想的な集団行動</p>
<p>[^06_ch06-50] 第1報告書(A/1891)は総会決議503, 第2報告書は総会決議703にて報告書の総会によるtake noteがなされている。</p>
<p>[^06_ch06-51] 安保理でない主体(=総会)により決定された経済制裁は別途存在する。1946年の<strong>総会</strong>決議39号ではスペインにおけるフランコ政権の存在を受けて、在スペイン大使・公使の本国召還や国際会議へのスペイン代表の出席拒否（いずれも通常の外交活動の中で行いうる措置である）を加盟国に勧告した。また1948年の<strong>総会</strong>決議193号および288号では、バルカン諸国の国内におけるゲリラに対する軍事支援の継続を受けて、ゲリラを支援する行動やアルバニア・ブルガリア両国に対する武器・軍事物資の供給を控えるよう勧告した。ただしこれら事例は総会における安保理の権限の侵害云々のような問題を発生させたのみである。</p>
<p>[^06_ch06-52] 本格的でない(=非拘束的な)経済制裁もまた別途存在する。1963年の安保理決議181, 182号ではアパルトヘイト政策を継続する南アフリカに対して、安保理決議180, 218号ではアンゴラとモザンビークで植民地支配を継続するポルトガルに対して、”脅威認定”を行わずに加盟国へ武器供給停止や対象国への禁輸を要請している。</p>
<p>[^06_ch06-53] 弊会議と同じくAJMUN37thにて行われている南ローデシア情勢はここを扱ってるようである。</p>
<p>[^06_ch06-54] 石綿, 鉄鉱石, クロム, 砂糖, 銑鉄, タバコ, 銅, 肉およびその加工品, 原皮および皮が指定された。</p>
<p>[^06_ch06-55] 本会議の議論に対して示唆の富んだ決議である。議論過程は安保理1408会合や1428会合を見られたい(訳は別途配布済)。</p>
<p>[^06_ch06-56] 決議253の起草過程において存在した草案S/8545では南ア・ポルトガルを名指しし制裁破りを非難するとともに、南ア・ポルトガルにより安保理の決定が無視され続ける場合には「毅然とした効果的な対応をとることを決定する(Decides to take resolute and effective action)」とした。制裁不履行国に対する強制措置を事実上示唆する文言である。</p>
<p>[^06_ch06-57] 当時国連に加盟していなかったスイスや西ドイツはローデシアとの貿易を継続し、英国や日本、イランなども制裁破りを行なっていた。</p>
<p>[^06_ch06-58] ローデシアはポルトガル領モザンビーク、ボツワナ、ザンビア、南アフリカと接している。</p>
<p>[^06_ch06-59] 決議253の採択過程にてソビエト連邦から、<strong>ザンビアの損失は制裁措置を履行せずローデシアの状況に政治的責任を負う国によって補償されるものと決定する</strong>　といった非常に面白い修正が提案されたが、賛成7, 反対0, 棄権8で否決された。その後ソ連の提案でザンビアへの援助要請の条文は分割投票投票にかけられ、賛成13, 反対0, 棄権2(ソ連およびハンガリー)によって当該条文は維持された。</p>
<p>[^06_ch06-60] 決議253の採択から5ヶ月後にザンビアから送付された書簡(S/8786/Add.2内に存在)の中では、決議253内で援助を定めた条文について実際に援助を行なった加盟国・機関が存在しなかったことが述べられている。ただし後述するように決議329に基づくザンビアへの支援要請について加盟国からの援助は存在したようである。</p>
<p>[^06_ch06-61] S/7781/Add.2から確認可能</p>
<p>[^06_ch06-62] S/10865 およびそれに賛同する書簡としてS/10866, S/10869がある。</p>
<p>[^06_ch06-63] ただしこれは憲章50条の協議というよりも、南アフリカ-ザンビア国境における南アフリカの兵力展開が平和と安全に対するおそれと看做されたためである。</p>
<p>[^06_ch06-64] S/10896.rev1である。同報告書ではザンビアの輸送ルート転換のために陸路用に1億2400万ドル、空路用に月650万ドルが必要とされた。だいたい現在の価値に直すとそれぞれ10億ドルと5000万ドルくらいである。</p>
<p>[^06_ch06-65] ザンビアへの支援は決議の内容通り、加盟国間や国際機関での自主的な援助によって行われた。そのうち最大のものは中国からの4億6000万ドルの融資によるタザラ鉄道建設である。https://www.nytimes.com/1971/01/29/archives/tanzaniazambia-railway-a-bridge-to-china.html</p>
<p>[^06_ch06-66] 同趣旨の決議として総会でも決議31/43が採択されている。両決議をもってモザンビークに対する加盟国による自主的な援助の呼びかけや、UNDP, WFP, 世銀などへの援助要請が行われた。</p>
<p>[^06_ch06-67] ただしあくまでアパルトヘイト政策に対する制裁ではなく、南アフリカによる周辺諸国の侵攻に対する制裁として行われている。</p>
<p>[^06_ch06-68] 例えばレソトに対して決議527, 580、ボツワナに対して決議568, 572, 567、アンゴラに対して決議571, 577がある。ただし支払い自体は2国家間の問題とされ、国連による代払や支払いの強制は行われていない。</p>
<p>[^06_ch06-69] 安全保障理事会第2793~27977回会合　および2799回会合</p>
<p>[^06_ch06-70] そもそも南アフリカが冷戦構造のもとで反共の砦とみなされていたことにより、アパルトヘイト政策やナミビア地域の占領が米国から一定の支持を受けていた。単純に冷戦の対立が緩和されたことのほかにも、ナミビア地域のすぐ北に位置するアンゴラでの内戦の停戦合意やキューバ軍の撤退を受けて反共の砦としての南アフリカ並びに占領下ナミビアの価値は低下したのである。</p>
<p>[^06_ch06-71] 単純に制裁の効果測定や被制裁国・近隣諸国の状況を把握することが難しく制裁の効果と副次的影響を測り難かったことも原因にあるだろう。</p>
<p>[^06_ch06-72] イラク国内では唯一、FAO(国連食糧農業機関)が設立した研究所にて獣医用ワクチンが製造されていたがそれも湾岸戦争時の爆撃で製造能力や在庫が破壊されたようである。</p>
<p>[^06_ch06-73] 343,000t(1990/9)から135,000t(1991/1)へ減少した。</p>
<p>[^06_ch06-74] U4P履行に関する集団的措置委員会が求めたのは、U4Pの履行の際にも49と50のダブルで適用されるべきであること　ただ、総会決議はあくまで勧告で履行が任意であり、別に50を頼らず総会の権限で加盟国に援助を要請できるだろうから、50いらんくね</p>
<p>[^06_ch06-75] 勧告的意見はこれが見やすいだろう</p>
<p>[^06_ch06-76] 例えば米国国務長官から米国大統領に向けてのサンフランシスコ会議の報告書内でもこの解釈が用いられている。<a href="https://babel.hathitrust.org/cgi/pt?id=uiug.30112046487697&amp;seq=80" class="uri">https://babel.hathitrust.org/cgi/pt?id=uiug.30112046487697&amp;seq=80</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "コピーしました");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "コピーしました");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../content/05_ch05.html" class="pagination-link" aria-label="第5章 パフォーマンス最適化">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">第5章 パフォーマンス最適化</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../content/07_ch07.html" class="pagination-link" aria-label="第7章 まとめと展望">
        <span class="nav-page-text"><span class="chapter-title">第7章 まとめと展望</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>
// Inlined UI script for offline file:// compatibility
// Source: src/js/ui-clean.js (inlined)
(function() {
  'use strict';

  const STORAGE_KEYS = {
    tocLocation: 'quarto-toc-location',
    theme: 'quarto-theme',
    fontSize: 'quarto-font-size',
    markers: 'quarto-markers',
    comments: 'quarto-comments',
    scrollPosition: 'quarto-scroll-position',
    rightTab: 'quarto-right-tab'
  };

  // コメントDB（ページパス毎に配列）
  let COMMENTS_DB = {};
  try { COMMENTS_DB = JSON.parse(localStorage.getItem(STORAGE_KEYS.comments) || '{}') || {}; } catch { COMMENTS_DB = {}; }
  function saveComments() { try { localStorage.setItem(STORAGE_KEYS.comments, JSON.stringify(COMMENTS_DB)); } catch (e) { console.warn('Save comments failed', e); } }
  function pageKey() { return window.location.pathname; }

  function readRightTabState() {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEYS.rightTab) || '{}') || {}; }
    catch (e) { console.warn('Failed to read right tab state', e); return {}; }
  }
  function getSavedRightTab() {
    const map = readRightTabState();
    return map[pageKey()] || 'footnotes';
  }
  function saveRightTab(tab) {
    try {
      const map = readRightTabState();
      map[pageKey()] = tab;
      localStorage.setItem(STORAGE_KEYS.rightTab, JSON.stringify(map));
    } catch (e) {
      console.warn('Failed to save right tab state', e);
    }
  }

  function getActiveChapterSection() {
    return document.querySelector('section.chapter-page.active') || null;
  }
  function getCurrentChapterSlug() {
    const active = getActiveChapterSection();
    if (!active) return null;
    const id = active.getAttribute('id') || '';
    return id.startsWith('page-') ? id.slice(5) : (id || null);
  }

  function getSectionSlugFromElement(el) {
    if (!el || !(el instanceof HTMLElement)) return null;
    const sec = el.closest('section.chapter-page');
    if (!sec || !sec.id) return null;
    const id = sec.id;
    return id.startsWith('page-') ? id.slice(5) : id;
  }

  function findCommentAnchorElement(rec) {
    if (!rec || !Array.isArray(rec.ranges)) return null;
    for (const range of rec.ranges) {
      const node = getNodeByPathSafe(range?.s);
      if (!node) continue;
      let el = node.nodeType === Node.ELEMENT_NODE ? node : node.parentElement;
      while (el && !(el instanceof HTMLElement)) el = el.parentElement;
      if (el) return el;
    }
    return null;
  }

  function detectCommentSlug(rec) {
    const el = findCommentAnchorElement(rec);
    return el ? getSectionSlugFromElement(el) : null;
  }

  function isCommentInSection(rec, section) {
    if (!section) return true;
    const el = findCommentAnchorElement(rec);
    return !!(el && section.contains(el));
  }

  function getActiveComments() {
    const list = (COMMENTS_DB[pageKey()] || []);
    const slug = getCurrentChapterSlug();
    if (!slug) return list.slice();
    const activeSection = getActiveChapterSection();
    const result = [];
    let mutated = false;
    list.forEach(rec => {
      if (!rec) return;
      if (!rec.slug) {
        const detected = detectCommentSlug(rec);
        if (detected) {
          rec.slug = detected;
          mutated = true;
        }
      }
      if (rec.slug) {
        if (rec.slug === slug) result.push(rec);
      } else if (isCommentInSection(rec, activeSection)) {
        result.push(rec);
      }
    });
    if (mutated) saveComments();
    return result;
  }

  function gatherActiveCommentsWithElements() {
    return getActiveComments()
      .map(rec => {
        const el = findCommentAnchorElement(rec);
        return el ? { rec, el } : null;
      })
      .filter(Boolean);
  }

  function gatherActiveFootnotes() {
    const active = getActiveChapterSection();
    const refSelector = 'a[role="doc-noteref"], a.footnote-ref';
    const refMap = new Map();
    const scope = active || document;
    Array.from(scope.querySelectorAll(refSelector)).forEach(ref => {
      if (active && !active.contains(ref)) return;
      const href = ref.getAttribute('href') || ref.getAttribute('data-footnote-href');
      if (!href || !href.startsWith('#')) return;
      const id = href.slice(1);
      const top = ref.getBoundingClientRect().top + window.scrollY;
      const existing = refMap.get(id);
      if (!existing || top < existing.pos) {
        refMap.set(id, { id, ref, pos: top });
      }
    });
    const items = [];
    refMap.forEach(entry => {
      let def = document.getElementById(entry.id);
      if (!def) return;
      if (!(def instanceof HTMLElement)) def = def.parentElement;
      if (!def) return;
      let li = def;
      if (li.tagName && li.tagName.toLowerCase() !== 'li') {
        const nearestLi = li.closest('li');
        if (nearestLi) li = nearestLi;
      }
      if (!(li instanceof HTMLElement)) return;
      if (active) {
        const parentSection = li.closest('section.chapter-page');
        if (parentSection && parentSection !== active) return;
      }
      items.push({ id: entry.id, li, ref: entry.ref, pos: entry.pos });
    });
    return items;
  }

  function initUI() {
    try {
      setupHeaderControls();
      setupLeftPanelTabs();
      setupRightSidebar();
      setupMarkerFunctionality();
      setupMobileFootnoteToggle();
      disableDefaultQuartoSearch();
      setupSidebarSearch();
      setupGlobalSearch();
      setupKeyboardShortcuts();
      setupScrollPosition();
      
      // 独自TOCシステムを初期化（DOM構築後）
      setTimeout(() => {
        CustomTOC.initializeCustomTOC();
      }, 100);
      
      console.log('UI initialized');
      setTimeout(refreshRightPanels, 80);
    } catch (e) {
      console.error('UI init failed:', e);
    }
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initUI);
  } else {
    initUI();
  }

  function setupHeaderControls() {
    const tocMobileBtn = document.getElementById('toc-mobile-btn');
    const settingsToggleBtn = document.getElementById('settings-toggle-btn');
    const settingsMenu = document.getElementById('settings-menu');
    const settingsMenuClose = document.getElementById('settings-menu-close');
    const settingsMenuOverlay = document.getElementById('settings-menu-overlay');
    const themeSelect = document.getElementById('theme-select');
    const fontSizeSelect = document.getElementById('font-size-select');
    const commentsExportPage = document.getElementById('comments-export-page');
    const commentsExportAll = document.getElementById('comments-export-all');
    const commentsImport = document.getElementById('comments-import');
    const commentsImportButton = document.getElementById('comments-import-button');

    // ハンバーガーメニュー機能
    const hamburgerBtn = document.getElementById('hamburger-menu-btn');
    const hamburgerPanel = document.getElementById('hamburger-menu-panel');
    const hamburgerOverlay = document.getElementById('hamburger-menu-overlay');
    const hamburgerContent = hamburgerPanel.querySelector('.hamburger-menu-content');
    
    if (hamburgerBtn && hamburgerPanel && hamburgerOverlay) {
      const menuItems = [
        {
          label: "目次を表示",
          action: "show-toc",
          icon: "📋"
        },
        {
          label: "文字サイズ",
          action: "font-size",
          icon: "🔤"
        },
        {
          label: "テーマ切り替え",
          action: "theme",
          icon: "🎨"
        },
        {
          label: "コメント出力(このページ)",
          action: "export-comments-page",
          icon: "📄"
        },
        {
          label: "全コメント出力",
          action: "export-comments-all", 
          icon: "📚"
        },
        {
          label: "コメント読込",
          action: "import-comments",
          icon: "📥"
        },
        {
          label: "PDFダウンロード",
          action: "download-pdf",
          icon: "📑"
        }
      ];

      // メニュー項目を生成
      const menuList = document.createElement('ul');
      menuList.className = 'hamburger-menu-list';
      
      menuItems.forEach(item => {
        const menuItem = document.createElement('li');
        menuItem.className = 'hamburger-menu-item';
        const menuLink = document.createElement('a');
        menuLink.className = 'hamburger-menu-link';
        menuLink.href = '#';
        menuLink.innerHTML = `${item.icon} ${item.label}`;
        menuLink.setAttribute('role', 'menuitem');
        menuLink.setAttribute('aria-label', item.label);
        
        menuLink.addEventListener('click', (e) => {
          e.preventDefault();
          handleHamburgerMenuAction(item.action);
          closeHamburgerMenu();
        });
        
        menuItem.appendChild(menuLink);
        menuList.appendChild(menuItem);
      });
      
      hamburgerContent.innerHTML = '';
      hamburgerContent.appendChild(menuList);

      // メニュー開閉機能
      const openHamburgerMenu = () => {
        hamburgerBtn.setAttribute('aria-expanded', 'true');
        hamburgerBtn.setAttribute('aria-label', 'メニューを閉じる');
        hamburgerPanel.classList.add('open');
        hamburgerOverlay.classList.add('open');
        
        // 最初の項目にフォーカス
        const firstLink = hamburgerPanel.querySelector('.hamburger-menu-link');
        if (firstLink) {
          firstLink.focus();
        }
      };

      const closeHamburgerMenu = () => {
        hamburgerBtn.setAttribute('aria-expanded', 'false');
        hamburgerBtn.setAttribute('aria-label', 'メニューを開く');
        hamburgerPanel.classList.remove('open');
        hamburgerOverlay.classList.remove('open');
        hamburgerBtn.focus();
      };

      hamburgerBtn.addEventListener('click', openHamburgerMenu);
      hamburgerOverlay.addEventListener('click', closeHamburgerMenu);
      
      // ESCキーで閉じる
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && hamburgerPanel.classList.contains('open')) {
          closeHamburgerMenu();
        }
      });

      // アクセシビリティのため、キーボードナビゲーションをサポート
      hamburgerBtn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openHamburgerMenu();
        }
      });

      // アクティベーションツキップでキーボードナビゲーションを有効化
      let currentFocusIndex = -1;
      const focusableElements = () => hamburgerPanel.querySelectorAll('.hamburger-menu-link');

      hamburgerPanel.addEventListener('keydown', (e) => {
        if (!hamburgerPanel.classList.contains('open')) return;
        
        const elements = focusableElements();
        if (elements.length === 0) return;

        switch (e.key) {
          case 'ArrowDown':
            e.preventDefault();
            currentFocusIndex = (currentFocusIndex + 1) % elements.length;
            elements[currentFocusIndex].focus();
            break;
          case 'ArrowUp':
            e.preventDefault();
            currentFocusIndex = currentFocusIndex <= 0 ? elements.length - 1 : currentFocusIndex - 1;
            elements[currentFocusIndex].focus();
            break;
          case 'Home':
            e.preventDefault();
            currentFocusIndex = 0;
            elements[currentFocusIndex].focus();
            break;
          case 'End':
            e.preventDefault();
            currentFocusIndex = elements.length - 1;
            elements[currentFocusIndex].focus();
            break;
        }
      });
    }

    // ハンバーガーメニューのアクション処理
    function handleHamburgerMenuAction(action) {
      switch (action) {
        case 'show-toc':
          // 目次を表示
          const tocMobileBtn = document.getElementById('toc-mobile-btn');
          if (tocMobileBtn) tocMobileBtn.click();
          break;
        case 'font-size':
          // 文字サイズメニューを開く
          if (settingsMenu) {
            settingsMenu.classList.add('open');
            settingsMenuOverlay.classList.add('open');
          }
          break;
        case 'theme':
          // テーマメニューを開く
          if (settingsMenu) {
            settingsMenu.classList.add('open');
            settingsMenuOverlay.classList.add('open');
          }
          break;
        case 'export-comments-page':
          exportComments(true);
          break;
        case 'export-comments-all':
          exportComments(false);
          break;
        case 'import-comments':
          if (commentsImport) commentsImport.click();
          break;
        case 'download-pdf':
          window.print();
          break;
      }
    }

    // 設定メニュー開閉機能
    if (settingsToggleBtn && settingsMenu && settingsMenuOverlay) {
      const openSettingsMenu = () => {
        settingsMenu.classList.add('open');
        settingsMenuOverlay.classList.add('open');
      };

      const closeSettingsMenu = () => {
        settingsMenu.classList.remove('open');
        settingsMenuOverlay.classList.remove('open');
      };

      settingsToggleBtn.addEventListener('click', openSettingsMenu);
      settingsMenuClose.addEventListener('click', closeSettingsMenu);
      settingsMenuOverlay.addEventListener('click', closeSettingsMenu);

      // ESCキーでメニューを閉じる
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && settingsMenu.classList.contains('open')) {
          closeSettingsMenu();
        }
      });
    }

    // テーマ切替機能
    if (themeSelect) {
      const mq = window.matchMedia('(prefers-color-scheme: dark)');
      function applyTheme(mode) {
        if (mode === 'auto') {
          document.body.setAttribute('data-theme', mq.matches ? 'dark' : 'light');
        } else {
          document.body.setAttribute('data-theme', mode);
        }
      }
      const saved = localStorage.getItem(STORAGE_KEYS.theme) || 'auto';
      themeSelect.value = saved;
      applyTheme(saved);
      mq.addEventListener('change', () => { if ((localStorage.getItem(STORAGE_KEYS.theme) || 'auto') === 'auto') applyTheme('auto'); });
      themeSelect.addEventListener('change', (e) => {
        const theme = e.target.value;
        localStorage.setItem(STORAGE_KEYS.theme, theme);
        applyTheme(theme);
      });
    }

    // 文字サイズ変更機能
    if (fontSizeSelect) {
      const currentSize = localStorage.getItem(STORAGE_KEYS.fontSize) || 'M';
      fontSizeSelect.value = currentSize;
      document.body.setAttribute('data-font-size', currentSize);
      fontSizeSelect.addEventListener('change', (e) => {
        const size = e.target.value;
        document.body.setAttribute('data-font-size', size);
        localStorage.setItem(STORAGE_KEYS.fontSize, size);
      });
    }

    // モバイル用目次ボタン
    if (tocMobileBtn) {
      tocMobileBtn.addEventListener('click', () => {
        const tocPanel = document.getElementById('quarto-sidebar');
        if (tocPanel) tocPanel.classList.toggle('mobile-open');
      });
    }

    // コメント出力機能
    if (commentsExportPage) {
      commentsExportPage.addEventListener('click', () => exportComments(true));
    }
    if (commentsExportAll) {
      commentsExportAll.addEventListener('click', () => exportComments(false));
    }

    // コメントインポート機能
    if (commentsImport && commentsImportButton) {
      commentsImport.addEventListener('change', (e) => importCommentsFromFile(e.target.files[0]));
      commentsImportButton.addEventListener('click', () => commentsImport.click());
    }
  }

  function setupLeftPanelTabs() {
    const sidebar = document.getElementById('quarto-sidebar');
    if (!sidebar) return;
    const menuContainer = sidebar.querySelector('.sidebar-menu-container');
    if (!menuContainer) return;
    const marginSidebar = document.getElementById('quarto-margin-sidebar');
    const pageToc = marginSidebar ? marginSidebar.querySelector('#TOC') : null;

    const tabWrapper = document.createElement('div');
    tabWrapper.className = 'toc-switcher';
    tabWrapper.innerHTML = `
<div class="toc-tabs">
        <button type="button" class="toc-tab active" data-tab="site">各章</button>
        <button type="button" class="toc-tab" data-tab="page">章内</button>
        <button type="button" class="toc-tab" data-tab="all">全体</button>
      </div>
      <div class="toc-panel toc-site-content"></div>
      <div class="toc-panel toc-page-content hidden"></div>
      <div class="toc-panel toc-all-content hidden"></div>
    `;

    const menuCloneForAll = menuContainer.cloneNode(true);
    const parent = menuContainer.parentNode;
    parent.replaceChild(tabWrapper, menuContainer);
    const sitePanel = tabWrapper.querySelector('.toc-site-content');
    sitePanel.appendChild(menuContainer);
    // デフォルト: 各章タブは第2階層まで展開
    try { setSidebarDepth(menuContainer, 2); } catch (e) { console.warn('setSidebarDepth failed for site', e); }

    const pagePanel = tabWrapper.querySelector('.toc-page-content');
    // 章内タブ: 独自TOCシステムで生成
    try { 
      if (pageToc) {
        pagePanel.appendChild(pageToc);
        pagePanel.classList.add('page-toc');
      }
      // 親要素を確保して後で初期化（onload時にも実行される）
    } catch (e) { console.warn('TOC setup failed', e); }

    const allPanel = tabWrapper.querySelector('.toc-all-content');
    if (menuCloneForAll) {
      // 各章タブ: 第2階層まで展開（従来のナビゲーション）
      setSidebarDepth(menuCloneForAll, 2);
      allPanel.appendChild(menuCloneForAll);
    } else {
      allPanel.innerHTML = '<p class="toc-empty">メニューを読み込めませんでした。</p>';
    }

    const tabButtons = tabWrapper.querySelectorAll('.toc-tab');
    const panels = { site: sitePanel, page: pagePanel, all: allPanel };
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const target = button.dataset.tab;
        tabButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        Object.values(panels).forEach(p => p.classList.add('hidden'));
        if (panels[target]) panels[target].classList.remove('hidden');
      });
    });
  }

  function setupRightSidebar() {
    ensureRightTabs();
    refreshRightPanels();
    const onResize = debounce(() => {
      ensureRightTabs();
      refreshRightPanels();
    }, 200);
    window.addEventListener('resize', onResize);
    window.addEventListener('orientationchange', onResize);
    window.addEventListener('hashchange', () => { setTimeout(refreshRightPanels, 60); });
  }

  function refreshRightPanels() {
    applyFootnoteLayout();
    renderCommentsPanel();
    if (SIDENOTES_ON) {
      renderSidenotes(currentRightTab());
    } else {
      activateRightTab(currentRightTab(), { skipSave: true });
    }
  }

  function ensureRightTabs() {
    const marginSidebar = document.getElementById('quarto-margin-sidebar');
    if (!marginSidebar) return;
    let wrapper = marginSidebar.querySelector('.right-switcher');
    if (!wrapper) {
      wrapper = document.createElement('div');
      wrapper.className = 'right-switcher';
      wrapper.innerHTML = `
        <div class="toc-tabs">
          <button type="button" class="toc-tab" data-tab="footnotes">脚注</button>
          <button type="button" class="toc-tab" data-tab="comments">コメント</button>
          <button type="button" class="toc-tab" data-tab="both">両方</button>
        </div>
        <div class="sidenotes-toolbar">
          <label class="sidenotes-toggle"><input type="checkbox" id="sidenotes-toggle"> 傍注表示</label>
        </div>
        <div class="toc-panel right-footnotes"></div>
        <div class="toc-panel right-comments" style="display:none"></div>
        <div class="toc-panel right-both" style="display:none"></div>
      `;
      marginSidebar.innerHTML = '';
      marginSidebar.appendChild(wrapper);

      const tabs = wrapper.querySelectorAll('.toc-tab');
      tabs.forEach(btn => {
        btn.addEventListener('click', () => {
          activateRightTab(btn.dataset.tab || 'footnotes');
        });
      });

      const sidenotesToggle = wrapper.querySelector('#sidenotes-toggle');
      if (sidenotesToggle) {
        sidenotesToggle.addEventListener('change', (e) => setSidenotesMode(e.target.checked));
      }
      const savedTab = getSavedRightTab();
      activateRightTab(savedTab, { skipSave: true });
      if (sidenotesToggle) {
        sidenotesToggle.checked = true;
        setSidenotesMode(true);
      } else {
        setSidenotesMode(false);
      }
    } else {
      const toggle = wrapper.querySelector('#sidenotes-toggle');
      if (toggle) toggle.checked = SIDENOTES_ON;
      activateRightTab(getSavedRightTab(), { skipSave: true });
    }
  }

  let SIDENOTES_ON = false;
  let SIDENOTES_ITEMS = [];

  function activateRightTab(tab, opts = {}) {
    const marginSidebar = document.getElementById('quarto-margin-sidebar');
    if (!marginSidebar) return;
    const wrapper = marginSidebar.querySelector('.right-switcher');
    if (!wrapper) return;
    const tabs = Array.from(wrapper.querySelectorAll('.toc-tab'));
    const normalized = ['footnotes', 'comments', 'both'].includes(tab) ? tab : 'footnotes';
    tabs.forEach(btn => btn.classList.toggle('active', btn.dataset.tab === normalized));
    const footPanel = wrapper.querySelector('.right-footnotes');
    const commPanel = wrapper.querySelector('.right-comments');
    const bothPanel = wrapper.querySelector('.right-both');
    if (SIDENOTES_ON) {
      if (footPanel) footPanel.style.display = 'none';
      if (commPanel) commPanel.style.display = 'none';
      if (bothPanel) bothPanel.style.display = 'none';
      renderSidenotes(normalized);
    } else {
      if (footPanel) footPanel.style.display = normalized === 'footnotes' ? '' : 'none';
      if (commPanel) commPanel.style.display = normalized === 'comments' ? '' : 'none';
      if (bothPanel) bothPanel.style.display = normalized === 'both' ? '' : 'none';
    }
    if (!opts.skipSave) saveRightTab(normalized);
  }

  function currentRightTab() {
    const active = document.querySelector('#quarto-margin-sidebar .toc-tab.active');
    if (active) return active.getAttribute('data-tab') || 'footnotes';
    return getSavedRightTab();
  }

  function setSidenotesMode(on) {
    const ms = document.getElementById('quarto-margin-sidebar');
    if (!ms) return;
    const foot = ms.querySelector('.right-footnotes');
    const comm = ms.querySelector('.right-comments');
    const both = ms.querySelector('.right-both');
    SIDENOTES_ON = !!on;
    if (SIDENOTES_ON) {
      ms.classList.add('sidenotes-on');
      if (foot) foot.style.display = 'none';
      if (comm) comm.style.display = 'none';
      if (both) both.style.display = 'none';
      renderSidenotes(currentRightTab());
      window.addEventListener('scroll', updateSidenotesPositions, { passive: true });
      window.addEventListener('resize', updateSidenotesPositions);
    } else {
      ms.classList.remove('sidenotes-on');
      clearSidenotes();
      window.removeEventListener('scroll', updateSidenotesPositions);
      window.removeEventListener('resize', updateSidenotesPositions);
      activateRightTab(currentRightTab(), { skipSave: true });
    }
  }

  function clearSidenotes() {
    const ms = document.getElementById('quarto-margin-sidebar');
    ms.querySelectorAll('.margin-note').forEach(n => n.remove());
    SIDENOTES_ITEMS = [];
  }

  function renderSidenotes(mode) {
    clearSidenotes();
    const ms = document.getElementById('quarto-margin-sidebar');
    if (!ms) return;
    const makeNote = (opts) => {
      const note = document.createElement('div');
      note.className = 'margin-note' + (opts.kind==='comment' ? ' comment' : '');
      note.innerHTML = `
        <div class=\"meta\"><span>${opts.time||''}</span>${opts.moveHtml||''}${opts.showMenu ? '<button class="menu" title="メニュー" style="margin-left:auto;background:none;border:none;cursor:pointer;font-size:16px;line-height:1;">⋯</button>' : ''}</div>
        ${opts.targetHtml||''}
        <div class=\"body\">${opts.bodyHtml||''}</div>
      `;
      ms.appendChild(note);
      return note;
    };

    const footnotes = gatherActiveFootnotes();
    const comments = gatherActiveCommentsWithElements();

    const entries = [];
    if (mode !== 'comments') {
      footnotes.forEach(fn => {
        if (!fn.ref) return;
        entries.push({ kind: 'foot', el: fn.ref, def: fn.li });
      });
    }
    if (mode !== 'footnotes') {
      comments.forEach(item => {
        if (!item.el) return;
        entries.push({ kind: 'comment', el: item.el, rec: item.rec });
      });
    }

    SIDENOTES_ITEMS = entries.map(entry => {
      if (entry.kind === 'comment') {
        const rec = entry.rec;
        const note = makeNote({
          kind: 'comment',
          time: fmtMMDDHHmm(rec.t),
          moveHtml: `<a href="#" class="mv">移動</a>`,
          targetHtml: `<div class="target">${escapeHtml((rec.text||'').slice(0,80))}</div>`,
          bodyHtml: escapeHtml(rec.body||''),
          showMenu: true
        });
        note.querySelector('.mv')?.addEventListener('click', (e)=>{ e.preventDefault(); scrollToComment(rec); });
        note.querySelector('.menu')?.addEventListener('click', (e)=>{ e.stopPropagation(); openCommentMenu(note, rec, { x: e.clientX, y: e.clientY }); });
        return { kind: 'comment', el: entry.el, node: note };
      } else {
        const txt = entry.def ? entry.def.innerText || entry.def.textContent || '' : '';
        const note = makeNote({
          kind: 'foot',
          bodyHtml: escapeHtml(txt),
          moveHtml: '',
          showMenu: false
        });
        note.querySelector('.menu')?.remove();
        return { kind: 'foot', el: entry.el, node: note };
      }
    });

    updateSidenotesPositions();
  }

  function rightSidebarBaseOffset() {
    const ms = document.getElementById('quarto-margin-sidebar');
    if (!ms) return 0;
    const switcher = ms.querySelector('.right-switcher');
    return switcher ? switcher.offsetHeight + 12 : 0;
  }

  function updateSidenotesPositions() {
    if (!SIDENOTES_ON) return;
    const ms = document.getElementById('quarto-margin-sidebar');
    if (!ms) return;
    const msTop = ms.getBoundingClientRect().top;
    const viewH = window.innerHeight || document.documentElement.clientHeight;
    const baseOffset = rightSidebarBaseOffset();

    SIDENOTES_ITEMS.forEach(item => { if (item.node) item.node.style.display = 'none'; });

    const desired = SIDENOTES_ITEMS
      .filter(item => item.el && item.node && item.el.getClientRects().length)
      .map(item => {
        const rect = item.el.getBoundingClientRect();
        return { item, rect, desiredTop: rect.top - msTop };
      })
      .sort((a,b)=>a.desiredTop-b.desiredTop);

    const gap = 8;
    let cursor = baseOffset;
    desired.forEach(({item, rect, desiredTop}) => {
      const node = item.node;
      if (!node) return;
      const visible = !(rect.bottom < 0 || rect.top > viewH);
      if (!visible) {
        node.style.display = 'none';
        return;
      }
      const targetTop = Math.max(cursor, desiredTop + baseOffset);
      node.style.display = 'block';
      node.style.top = targetTop + 'px';
      cursor = targetTop + node.offsetHeight + gap;
    });
  }

  function applyFootnoteLayout() {
    const isPortrait = window.matchMedia('(orientation: portrait)').matches || (window.innerHeight > window.innerWidth);
    if (isPortrait) {
      renderInlineFootnotes();
    } else {
      renderSidebarFootnotes();
    }
  }

  function renderSidebarFootnotes() {
    document.querySelectorAll('.footnote-inline').forEach(n => n.remove());
    const marginSidebar = document.getElementById('quarto-margin-sidebar');
    if (!marginSidebar) return;
    const footHost = marginSidebar.querySelector('.right-footnotes') || marginSidebar;
    const bothHost = marginSidebar.querySelector('.right-both');
    footHost.innerHTML = '';
    if (bothHost) bothHost.innerHTML = '';

    const headerRow = document.createElement('div');
    headerRow.style.cssText = 'display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;';
    const header = document.createElement('h2');
    header.className = 'footnotes-title';
    header.textContent = '脚注';
    const sort = document.createElement('select');
    sort.innerHTML = '<option value="pos">本文位置順</option><option value="num">番号順</option>';
    sort.value = localStorage.getItem('footnotes-sort') || 'pos';
    sort.addEventListener('change', () => { localStorage.setItem('footnotes-sort', sort.value); renderSidebarFootnotes(); });
    headerRow.appendChild(header); headerRow.appendChild(sort);
    footHost.appendChild(headerRow);

    const footnotes = gatherActiveFootnotes();
    if (!footnotes.length) {
      footHost.insertAdjacentHTML('beforeend','<p class="footnotes-empty">このページには脚注がありません。</p>');
      if (bothHost) bothHost.insertAdjacentHTML('beforeend','<p class="footnotes-empty">このページには脚注/コメントがありません。</p>');
      return;
    }

    const items = footnotes.slice();
    const mode = sort.value;
    if (mode === 'pos') items.sort((a,b)=>a.pos-b.pos);
    else items.sort((a,b)=> (a.id||'').localeCompare(b.id||''));

    const wrapper = document.createElement('div');
    wrapper.className = 'margin-footnotes';
    const ol = document.createElement('ol');
    items.forEach((it, idx) => {
      const clone = it.li.cloneNode(true);
      if (!clone.querySelector('.footnote-num')) {
        const num = document.createElement('span');
        num.className = 'footnote-num';
        num.textContent = (idx + 1) + '. ';
        clone.insertBefore(num, clone.firstChild);
      }
      it.displayIndex = idx + 1;
      it.clone = clone;
      ol.appendChild(clone);
    });
    wrapper.appendChild(ol);
    footHost.appendChild(wrapper);

    // 両方タブ: コメントと脚注を本文位置で混在
    if (bothHost) renderBothPanel(bothHost, items);

    setupScrollSyncForFootnotes(footHost, items);
  }

  function renderBothPanel(host, footItems) {
    const commentAnchors = gatherActiveCommentsWithElements();
    const commItems = commentAnchors.map(({ rec, el }) => {
      const rect = el ? el.getBoundingClientRect() : null;
      const top = rect ? (rect.top + window.scrollY) : Infinity;
      return { type: 'comment', top, rec };
    });
    const footMixed = (footItems || []).map((f) => ({
      type: 'foot',
      top: f.pos,
      id: f.id,
      displayIndex: f.displayIndex || 0,
      clone: f.li.cloneNode(true)
    }));
    const merged = commItems.concat(footMixed).sort((a, b) => a.top - b.top);

    host.innerHTML = '';
    const header = document.createElement('h2');
    header.className = 'footnotes-title';
    header.textContent = '両方';
    host.appendChild(header);

    const list = document.createElement('div');
    list.className = 'both-mixed-list';
    list.style.cssText = 'display:flex; flex-direction:column; gap:8px;';

    merged.forEach(item => {
      if (item.type === 'comment') {
        const rec = item.rec;
        const card = document.createElement('div');
        card.className = 'comment-card';
        card.style.cssText = 'padding:10px;background:#fff;border-radius:6px;border-left:3px solid #ff9800;box-shadow:0 1px 3px rgba(0,0,0,0.08);';
        const meta = document.createElement('div');
        meta.className = 'comment-meta';
        meta.style.cssText = 'font-size:12px;color:#6c757d;margin-bottom:6px;display:flex;gap:8px;align-items:center;';
        const t = document.createElement('span');
        t.textContent = fmtMMDDHHmm(rec.t);
        const move = document.createElement('a');
        move.href = '#';
        move.textContent = '移動';
        move.addEventListener('click', (e) => { e.preventDefault(); scrollToComment(rec); });
        meta.appendChild(t);
        meta.appendChild(move);
        const target = document.createElement('div');
        target.className = 'comment-snippet';
        target.style.cssText = 'font-size:13px;color:#495057;background:#fff3e0;padding:6px 8px;border-radius:4px;margin-bottom:6px;';
        target.textContent = rec.text || '';
        const body = document.createElement('div');
        body.className = 'comment-body';
        body.style.cssText = 'white-space:pre-wrap; line-height:1.5;';
        body.textContent = rec.body || '';
        card.appendChild(meta);
        card.appendChild(target);
        card.appendChild(body);
        list.appendChild(card);
      } else {
        const wrapper = document.createElement('div');
        wrapper.className = 'both-footnote-card';
        wrapper.style.cssText = 'padding:10px;background:#fff;border-radius:6px;border-left:3px solid #6c757d;box-shadow:0 1px 3px rgba(0,0,0,0.06);';
        const clone = item.clone;
        if (!clone.querySelector('.footnote-num')) {
          const num = document.createElement('span');
          num.className = 'footnote-num';
          const displayNum = item.displayIndex || (footMixed.indexOf(item) + 1);
          num.textContent = displayNum + '. ';
          clone.insertBefore(num, clone.firstChild);
        }
        wrapper.appendChild(clone);
        list.appendChild(wrapper);
      }
    });
    host.appendChild(list);
    setupScrollSyncForBoth(host, merged);
  }

  function setupScrollSyncForFootnotes(host, items) {
    const mode = localStorage.getItem('footnotes-sort') || 'pos';
    if (mode !== 'pos') return;
    const onScroll = () => {
      const center = window.scrollY + window.innerHeight/2;
      let best = null, bestD = Infinity;
      items.forEach(it => {
        const d = Math.abs((it.pos ?? Infinity) - center);
        if (d < bestD) { best = it; bestD = d; }
      });
      if (best) {
        const nodes = host.querySelectorAll('ol > li');
        const idx = items.indexOf(best);
        const li = nodes[idx];
        const container = document.getElementById('quarto-margin-sidebar') || host;
        if (li && container) {
          const targetTop = li.offsetTop - (container.clientHeight/2 - li.clientHeight/2);
          container.scrollTo({ top: Math.max(0, targetTop), behavior: 'smooth' });
        }
      }
    };
    window.addEventListener('scroll', onScroll, { passive: true });
  }

  function setupScrollSyncForBoth(host, items) {
    const onScroll = () => {
      const center = window.scrollY + window.innerHeight/2;
      let bestIndex = -1, bestD = Infinity;
      items.forEach((it, i) => {
        const d = Math.abs((it.top ?? Infinity) - center);
        if (d < bestD) { bestD = d; bestIndex = i; }
      });
      if (bestIndex >= 0) {
        const list = host.lastElementChild; // list container
        const card = list && list.children[bestIndex];
        const container = document.getElementById('quarto-margin-sidebar') || host;
        if (card && container) {
          const targetTop = card.offsetTop - (container.clientHeight/2 - card.clientHeight/2);
          container.scrollTo({ top: Math.max(0, targetTop), behavior: 'smooth' });
        }
      }
    };
    window.addEventListener('scroll', onScroll, { passive: true });
  }

  function renderCommentsPanel() {
    const marginSidebar = document.getElementById('quarto-margin-sidebar');
    if (!marginSidebar) return;
    const commHost = marginSidebar.querySelector('.right-comments');
    if (!commHost) return;
    const list = getActiveComments();
    commHost.innerHTML = '';

    const header = document.createElement('div');
    header.style.cssText = 'display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;';
    const title = document.createElement('h2');
    title.className = 'footnotes-title';
    title.textContent = 'コメント';
    const sort = document.createElement('select');
    sort.innerHTML = '<option value="new">新しい順</option><option value="pos">本文位置順</option><option value="old">古い順</option>';
    sort.value = localStorage.getItem('comments-sort') || 'new';
    sort.addEventListener('change', () => { localStorage.setItem('comments-sort', sort.value); renderCommentsPanel(); });
    header.appendChild(title); header.appendChild(sort);
    commHost.appendChild(header);

    if (!list.length) { commHost.insertAdjacentHTML('beforeend','<p class="footnotes-empty">コメントはありません。</p>'); return; }

    const computePos = (rec) => {
      const el = findCommentAnchorElement(rec);
      const top = el ? (el.getBoundingClientRect().top + window.scrollY) : Infinity;
      return top;
    };

    let arr = list.slice();
    const mode = sort.value;
    if (mode === 'new') arr.sort((a,b)=>b.t-a.t);
    else if (mode === 'old') arr.sort((a,b)=>a.t-b.t);
    else if (mode === 'pos') arr.sort((a,b)=>computePos(a)-computePos(b));

    const ul = document.createElement('ul');
    ul.className = 'comment-list';
    ul.style.listStyle = 'none'; ul.style.padding = '0'; ul.style.margin = '0';

    arr.forEach(rec => {
      const li = document.createElement('li');
      li.dataset.id = rec.id;
      li.className = 'comment-item';
      li.style.cssText = 'margin:12px 0; padding:10px; background:#fff; border-radius:6px; border-left:3px solid #6c757d; box-shadow:0 1px 3px rgba(0,0,0,0.08); position:relative;';
      const meta = document.createElement('div');
      meta.className = 'comment-meta';
      meta.style.cssText = 'font-size:12px; color:#6c757d; margin-bottom:6px; display:flex; gap:8px; align-items:center;';
      const time = fmtMMDDHHmm(rec.t);
      const move = document.createElement('a');
      move.href = '#'; move.textContent = '移動';
      move.addEventListener('click', (e) => { e.preventDefault(); scrollToComment(rec); });
      const menuBtn = document.createElement('button');
      menuBtn.textContent = '⋯';
      menuBtn.setAttribute('aria-label','メニュー');
      menuBtn.style.cssText = 'margin-left:auto;background:none;border:none;cursor:pointer;font-size:18px;line-height:1;';
      menuBtn.addEventListener('click', (e) => { e.stopPropagation(); openCommentMenu(li, rec, {x:e.clientX,y:e.clientY}); });
      meta.innerHTML = `<span>${time}</span>`;
      meta.appendChild(move);
      meta.appendChild(menuBtn);

      const target = document.createElement('div');
      target.className = 'comment-snippet';
      target.style.cssText = 'font-size:13px; color:#495057; background:#f8f9fa; padding:6px 8px; border-radius:4px; margin-bottom:6px;';
      target.textContent = rec.text || '';
      const body = document.createElement('div');
      body.className = 'comment-body';
      body.style.cssText = 'white-space:pre-wrap; line-height:1.5;';
      body.textContent = rec.body || '';
      li.appendChild(meta); li.appendChild(target); li.appendChild(body);
      ul.appendChild(li);
    });

    commHost.appendChild(ul);

    setupScrollSyncForComments(commHost, arr);
  }

  function openCommentMenu(li, rec, pt) {
    closeAnyInlineMenu();
    const menu = document.createElement('div');
    menu.className = 'comment-menu-popup';
    menu.style.cssText = 'position:fixed; background:#fff; border:1px solid #e1e5eb; box-shadow:0 4px 12px rgba(0,0,0,0.12); border-radius:6px; z-index:10001; padding:6px;';
    menu.innerHTML = '<button type="button" data-act="edit" style="display:block;width:100%;text-align:left;padding:6px 10px;background:none;border:none;cursor:pointer;">編集</button>\n<button type="button" data-act="del" style="display:block;width:100%;text-align:left;padding:6px 10px;background:none;border:none;cursor:pointer;">削除</button>';
    document.body.appendChild(menu);
    const x = pt?.x || (li.getBoundingClientRect().right - 10);
    const y = pt?.y || (li.getBoundingClientRect().top + 20);
    menu.style.left = x + 'px';
    menu.style.top = y + 'px';
    const onDoc = (e)=>{ if (!menu.contains(e.target)) { closeAnyInlineMenu(); document.removeEventListener('mousedown', onDoc, true);} };
    document.addEventListener('mousedown', onDoc, true);
    menu.addEventListener('click', (e) => {
      const act = e.target?.getAttribute('data-act');
      if (act === 'edit') editComment(rec);
      if (act === 'del') deleteComment(rec);
      closeAnyInlineMenu();
    });
  }

  function closeAnyInlineMenu(){ document.querySelectorAll('.comment-menu-popup').forEach(n=>n.remove()); }

  function editComment(rec) {
    const overlay = document.createElement('div');
    overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:10000;display:flex;align-items:center;justify-content:center;';
    const dialog = document.createElement('div');
    dialog.style.cssText = 'background:#fff;color:#222;max-width:600px;width:92%;padding:16px;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,0.25);';
    dialog.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <h3 style="margin:0;font-size:16px;">コメント編集</h3>
        <button type=\"button\" aria-label=\"閉じる\" style=\"background:none;border:none;font-size:18px;cursor:pointer;\">×</button>
      </div>
      <div style="font-size:13px;color:#555;background:#f8f9fa;border:1px solid #e9ecef;padding:8px;border-radius:4px;margin-bottom:8px;">対象: ${(rec.text||'').slice(0,140)}</div>
      <textarea id="comment-edit-area" rows="6" style="width:100%;font-size:14px;padding:8px;border-radius:6px;border:1px solid #ced4da;resize:vertical;">${(rec.body||'')}</textarea>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
        <button type="button" id="comment-edit-cancel" style="padding:6px 12px;border:1px solid #dee2e6;border-radius:4px;background:#f8f9fa;cursor:pointer;">キャンセル</button>
        <button type="button" id="comment-edit-save" style="padding:6px 12px;border:1px solid #0d6efd;border-radius:4px;background:#0d6efd;color:#fff;cursor:pointer;">保存</button>
      </div>
    `;
    overlay.appendChild(dialog);
    document.body.appendChild(overlay);
    const close = ()=>overlay.remove();
    dialog.querySelector('[aria-label="閉じる"]').addEventListener('click', close);
    dialog.querySelector('#comment-edit-cancel').addEventListener('click', close);
    dialog.querySelector('#comment-edit-save').addEventListener('click', () => {
      const v = (dialog.querySelector('#comment-edit-area').value||'').trim();
      if (!v) return;
      const key = pageKey();
      const arr = COMMENTS_DB[key]||[];
      const idx = arr.findIndex(x=>x.id===rec.id);
      if (idx>=0) {
        arr[idx].body = v;
        arr[idx].t = Date.now();
        COMMENTS_DB[key]=arr;
        saveComments();
        refreshRightPanels();
      }
      close();
    });
  }

  function deleteComment(rec) {
    if (!confirm('このコメントを削除しますか？')) return;
    const key = pageKey();
    const arr = COMMENTS_DB[key]||[];
    COMMENTS_DB[key] = arr.filter(x=>x.id!==rec.id);
    saveComments();
    // マーカーも削除
    document.querySelectorAll(`.text-marker[data-comment-id="${rec.id}"]`).forEach(el => {
      const p = el.parentNode; while (el.firstChild) p.insertBefore(el.firstChild, el); p.removeChild(el);
    });
    refreshRightPanels();
  }

  function setupScrollSyncForComments(host, items) {
    const mode = localStorage.getItem('comments-sort') || 'new';
    if (mode !== 'pos') return;
    const onScroll = () => {
      const center = window.scrollY + window.innerHeight/2;
      let best = null, bestD = Infinity;
      items.forEach(rec => {
        const el = findCommentAnchorElement(rec);
        const top = el ? (el.getBoundingClientRect().top + window.scrollY) : Infinity;
        const d = Math.abs(top - center);
        if (d < bestD) { best = rec; bestD = d; }
      });
      if (best) {
        const li = host.querySelector(`li[data-id="${best.id}"]`);
        const container = document.getElementById('quarto-margin-sidebar') || host;
        if (li && container) {
          const targetTop = li.offsetTop - (container.clientHeight/2 - li.clientHeight/2);
          container.scrollTo({ top: Math.max(0, targetTop), behavior: 'smooth' });
        }
      }
    };
    window.addEventListener('scroll', onScroll, { passive: true });
  }

  function scrollToComment(rec) {
    try {
      const first = (rec.ranges && rec.ranges[0]);
      if (!first) return;
      const node = getNodeByPathSafe(first.s);
      if (!node) return;
      let el = node.nodeType === Node.ELEMENT_NODE ? node : node.parentElement;
      while (el && el !== document.body && !(el instanceof HTMLElement)) el = el.parentElement;
      if (!el) return;
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      const prev = el.style.boxShadow;
      el.style.transition = 'box-shadow 0.3s ease';
      el.style.boxShadow = '0 0 0 3px rgba(26,115,232,0.5)';
      setTimeout(() => { el.style.boxShadow = prev || ''; }, 1600);
    } catch (e) { console.warn('scrollToComment failed', e); }
  }

  function getNodeByPathSafe(path) {
    try { let n=document.body; for (const idx of path||[]) { if (!n || !n.childNodes[idx]) return null; n = n.childNodes[idx]; } return n; } catch { return null; }
  }

  function renderInlineFootnotes() {
    const marginSidebar = document.getElementById('quarto-margin-sidebar');
    if (marginSidebar) marginSidebar.innerHTML = '';
    document.querySelectorAll('.footnote-inline').forEach(n => n.remove());
    const active = getActiveChapterSection();
    const scope = active || document;
    const refSelector = 'a[role="doc-noteref"], a.footnote-ref';
    const refs = Array.from(scope.querySelectorAll(refSelector)).filter(ref => !active || active.contains(ref));
    if (!refs.length) return;
    refs.forEach(ref => {
      const href = ref.getAttribute('href') || ref.getAttribute('data-footnote-href');
      if (!href || !href.startsWith('#')) return;
      const id = href.slice(1);
      const target = document.getElementById(id);
      if (!target) return;
      if (active) {
        const section = target.closest('section.chapter-page');
        if (section && section !== active) return;
      }
      const numberText = (ref.textContent || '').replace(/[^0-9]/g, '') || '';
      const host = findHostParagraph(ref);
      if (!host) return;
      const clone = target.cloneNode(true);
      clone.querySelectorAll('.footnote-back, .footnote-backref, [role="doc-backlink"]').forEach(a => a.remove());
      const container = document.createElement('div');
      container.className = 'footnote-inline';
      const numSpan = document.createElement('span');
      numSpan.className = 'footnote-num';
      numSpan.textContent = (numberText ? numberText : '') + '. ';
      container.appendChild(numSpan);
      while (clone.firstChild) container.appendChild(clone.firstChild);
      host.insertAdjacentElement('afterend', container);
    });
  }

  function findHostParagraph(el) {
    let p = el;
    while (p && p !== document.body) {
      if (p.tagName === 'P' || p.tagName === 'LI') return p;
      p = p.parentElement;
    }
    return null;
  }

  function debounce(fn, ms) {
    let t;
    return (...args) => { clearTimeout(t); t = setTimeout(() => fn.apply(this, args), ms); };
  }

  function setupMarkerFunctionality() {
    let markersDB = JSON.parse(localStorage.getItem(STORAGE_KEYS.markers) || '{}');
    let pendingSerializedRange = null;

    // 既存マーカーを復元
    restoreMarkers();
    restoreCommentMarkers();

    // テキスト選択でツールバーを表示（UI要素上は無効）
    document.addEventListener('mouseup', (e) => {
      if (closestInteractive(e.target)) return;
      const sel = window.getSelection();
      if (!sel || sel.rangeCount === 0) { hideMarkerToolbar(); pendingSerializedRange = null; return; }
      const text = sel.toString().trim();
      if (text) {
        // 選択状態を保持（ボタン操作で選択が消えても適用できるように）
        try { pendingSerializedRange = serializeRange(sel.getRangeAt(0)); } catch { pendingSerializedRange = null; }
        showMarkerToolbar();
      } else {
        hideMarkerToolbar();
        pendingSerializedRange = null;
      }
    });

    function closestInteractive(el){
      return el.closest('.marker-toolbar, .js-header, .global-search-dialog, #quarto-sidebar');
    }

    function showMarkerToolbar() {
      let toolbar = document.querySelector('.marker-toolbar');
      if (!toolbar) {
        toolbar = createMarkerToolbar();
        document.body.appendChild(toolbar);
      }
      toolbar.classList.add('show');
    }

    function createMarkerToolbar() {
      const toolbar = document.createElement('div');
      toolbar.className = 'marker-toolbar';
      toolbar.innerHTML = `
        <div class="marker-colors" role="toolbar" aria-label="ハイライト色選択">
          <button class="marker-color-btn" data-color="yellow" title="黄"></button>
          <button class="marker-color-btn" data-color="green" title="緑"></button>
          <button class="marker-color-btn" data-color="blue" title="青"></button>
          <button class="marker-color-btn" data-color="pink" title="ピンク"></button>
          <button class="marker-comment-btn" title="選択範囲にコメント">💬</button>
        </div>
        <button class="marker-clear-btn" title="このページのマーカーを全消去">全消去</button>
      `;
      toolbar.querySelectorAll('.marker-color-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          applyMarker(btn.dataset.color);
          hideMarkerToolbar();
        });
      });
      const commentBtn = toolbar.querySelector('.marker-comment-btn');
      if (commentBtn) {
        commentBtn.addEventListener('click', () => {
          openCommentDialog();
        });
      }
      toolbar.querySelector('.marker-clear-btn').addEventListener('click', () => {
        clearAllMarkers();
        hideMarkerToolbar();
        window.getSelection().removeAllRanges();
      });
      return toolbar;
    }

    function openCommentDialog() {
      const selection = window.getSelection();
      let baseRange = null;
      if (selection && selection.rangeCount > 0 && selection.toString().trim()) {
        baseRange = selection.getRangeAt(0);
      } else if (pendingSerializedRange) {
        baseRange = deserializeRange(pendingSerializedRange);
      }
      if (!baseRange || baseRange.collapsed) return;

      const overlay = document.createElement('div');
      overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:10000;display:flex;align-items:center;justify-content:center;';
      const dialog = document.createElement('div');
      dialog.style.cssText = 'background:#fff;color:#222;max-width:600px;width:92%;padding:16px;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,0.25);';
      dialog.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <h3 style="margin:0;font-size:16px;">コメントを追加</h3>
          <button type="button" aria-label="閉じる" style="background:none;border:none;font-size:18px;cursor:pointer;">×</button>
        </div>
        <div style="font-size:13px;color:#555;background:#f8f9fa;border:1px solid #e9ecef;padding:8px;border-radius:4px;margin-bottom:8px;" id="comment-snippet"></div>
        <textarea id="comment-textarea" rows="6" style="width:100%;font-size:14px;padding:8px;border-radius:6px;border:1px solid #ced4da;resize:vertical;" placeholder="ここにコメントを入力（長文可）"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
          <button type="button" id="comment-cancel" style="padding:6px 12px;border:1px solid #dee2e6;border-radius:4px;background:#f8f9fa;cursor:pointer;">キャンセル</button>
          <button type="button" id="comment-save" style="padding:6px 12px;border:1px solid #0d6efd;border-radius:4px;background:#0d6efd;color:#fff;cursor:pointer;">保存</button>
        </div>
      `;
      overlay.appendChild(dialog);
      document.body.appendChild(overlay);

      const close = () => overlay.remove();
      dialog.querySelector('button[aria-label="閉じる"]').addEventListener('click', close);
      dialog.querySelector('#comment-cancel').addEventListener('click', close);

      // 選択スニペット表示
      const snippet = baseRange.cloneContents().textContent || window.getSelection().toString();
      dialog.querySelector('#comment-snippet').textContent = `対象: ${snippet?.slice(0,140) || ''}`;

      dialog.querySelector('#comment-save').addEventListener('click', () => {
        const body = (dialog.querySelector('#comment-textarea').value || '').trim();
        if (!body) { dialog.querySelector('#comment-textarea').focus(); return; }
        const segs = getTextSegments(baseRange);
        if (!segs.length) { close(); return; }
        const serializedRanges = segs.map(seg => ({ s: getPath(seg.node), so: seg.start, e: getPath(seg.node), eo: seg.end }));
        const rec = { id: `comment-${Date.now()}-${Math.floor(Math.random()*1000)}`, ranges: serializedRanges, text: snippet, body, t: Date.now(), slug: getCurrentChapterSlug() || null };
        const key = pageKey();
        if (!COMMENTS_DB[key]) COMMENTS_DB[key] = [];
        COMMENTS_DB[key].push(rec);
        saveComments();
        // 橙色マーカー適用
        segs.forEach(seg => {
          const span = document.createElement('span');
          span.className = 'text-marker marker-orange';
          span.setAttribute('data-comment-id', rec.id);
          applyColorStyles(span, 'orange');
          wrapBySplitText(seg.node, seg.start, seg.end, span);
        });
        refreshRightPanels();
        close();
      });
    }

    function applyMarker(color) {
      const selection = window.getSelection();
      let baseRange = null;
      if (selection && selection.rangeCount > 0 && selection.toString().trim()) {
        baseRange = selection.getRangeAt(0);
      } else if (pendingSerializedRange) {
        baseRange = deserializeRange(pendingSerializedRange);
      }
      if (!baseRange || baseRange.collapsed) return;

      const markerId = `marker-${Date.now()}-${Math.floor(Math.random()*1000)}`;
      const segments = getTextSegments(baseRange);
      if (!segments.length) return;

      const serializedRanges = [];
      segments.forEach(seg => {
        // 分割済みサブレンジをスタイル付与
        const span = document.createElement('span');
        span.className = `text-marker marker-${color}`;
        span.setAttribute('data-marker-id', markerId);
        applyColorStyles(span, color);
        span.addEventListener('dblclick', () => removeMarkerGroup(markerId));
        span.addEventListener('contextmenu', (e) => { e.preventDefault(); cycleMarkerColorGroup(markerId); });

        // 信頼性の高いsplitTextベースのラップ（file://でも安定）
        const serialized = { s: getPath(seg.node), so: seg.start, e: getPath(seg.node), eo: seg.end };
        wrapBySplitText(seg.node, seg.start, seg.end, span);
        serializedRanges.push(serialized);
      });

      selection.removeAllRanges();

      const page = window.location.pathname;
      if (!markersDB[page]) markersDB[page] = [];
      markersDB[page].push({ id: markerId, color, ranges: serializedRanges, t: Date.now() });
      saveMarkers();
      pendingSerializedRange = null;
    }

    // 選択範囲に交差するテキストノードをサブレンジに分割
    function getTextSegments(range) {
      const segments = [];

      // ルートがテキストノードの場合を考慮
      if (range.commonAncestorContainer && range.commonAncestorContainer.nodeType === Node.TEXT_NODE) {
        const node = range.commonAncestorContainer;
        const start = (node === range.startContainer) ? range.startOffset : 0;
        const end = (node === range.endContainer) ? range.endOffset : (node.nodeValue || '').length;
        if (start !== end) segments.push({ node, start, end });
        return segments;
      }

      const walker = document.createTreeWalker(
        range.commonAncestorContainer,
        NodeFilter.SHOW_TEXT,
        {
          acceptNode: (node) => {
            try {
              return range.intersectsNode(node) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
            } catch (e) {
              // フォールバック: compareBoundaryPoints
              if (!node.nodeValue) return NodeFilter.FILTER_REJECT;
              const r = document.createRange();
              r.selectNodeContents(node);
              const endVsStart = range.compareBoundaryPoints(Range.END_TO_START, r);
              if (endVsStart <= 0) return NodeFilter.FILTER_REJECT;
              const startVsEnd = range.compareBoundaryPoints(Range.START_TO_END, r);
              if (startVsEnd >= 0) return NodeFilter.FILTER_REJECT;
              return NodeFilter.FILTER_ACCEPT;
            }
          }
        }
      );

      let node;
      while ((node = walker.nextNode())) {
        let start = 0;
        let end = node.nodeValue.length;
        if (node === range.startContainer && range.startContainer.nodeType === Node.TEXT_NODE) start = range.startOffset;
        if (node === range.endContainer && range.endContainer.nodeType === Node.TEXT_NODE) end = range.endOffset;
        if (start !== end) segments.push({ node, start, end });
      }
      return segments;
    }

    function hideMarkerToolbar() {
      const toolbar = document.querySelector('.marker-toolbar');
      if (toolbar) toolbar.classList.remove('show');
    }

    function removeMarkerGroup(markerId) {
      document.querySelectorAll(`.text-marker[data-marker-id="${markerId}"]`).forEach(el => {
        const parent = el.parentNode;
        while (el.firstChild) parent.insertBefore(el.firstChild, el);
        parent.removeChild(el);
      });
      const page = window.location.pathname;
      if (markersDB[page]) {
        markersDB[page] = markersDB[page].filter(m => m.id !== markerId);
        if (!markersDB[page].length) delete markersDB[page];
        saveMarkers();
      }
    }

    function clearAllMarkers() {
      document.querySelectorAll('.text-marker').forEach(n => {
        const parent = n.parentNode;
        while (n.firstChild) parent.insertBefore(n.firstChild, n);
        parent.removeChild(n);
      });
      delete markersDB[window.location.pathname];
      saveMarkers();
    }

    function cycleMarkerColorGroup(markerId) {
      const order = ['yellow','green','blue','pink'];
      const els = Array.from(document.querySelectorAll(`.text-marker[data-marker-id="${markerId}"]`));
      if (!els.length) return;
      const el = els[0];
      const current = order.find(c => el.classList.contains(`marker-${c}`)) || 'yellow';
      const next = order[(order.indexOf(current)+1)%order.length];
      els.forEach(e => { order.forEach(c => e.classList.remove(`marker-${c}`)); e.classList.add(`marker-${next}`); applyColorStyles(e, next); });
      const page = window.location.pathname;
      const rec = (markersDB[page]||[]).find(m => m.id === markerId);
      if (rec) { rec.color = next; saveMarkers(); }
    }

    function saveMarkers(){ localStorage.setItem(STORAGE_KEYS.markers, JSON.stringify(markersDB)); }

    function restoreMarkers() {
      const page = window.location.pathname;
      const list = (markersDB[page] || []);
      list.forEach(m => {
        // 互換性: 古い形式 {range} を {ranges:[range]} に変換
        const ranges = m.ranges || (m.range ? [m.range] : []);
        ranges.forEach(rSerialized => {
        const tn = getNodeByPath(rSerialized.s);
        if (!tn || tn.nodeType !== Node.TEXT_NODE) return;
        const span = document.createElement('span');
        span.className = `text-marker marker-${m.color}`;
        span.setAttribute('data-marker-id', m.id);
        applyColorStyles(span, m.color);
        span.addEventListener('dblclick', () => removeMarkerGroup(m.id));
        span.addEventListener('contextmenu', (e) => { e.preventDefault(); cycleMarkerColorGroup(m.id); });
        wrapBySplitText(tn, rSerialized.so, rSerialized.eo, span);
        });
      });
    }

    function restoreCommentMarkers() {
      try {
        const list = (COMMENTS_DB[pageKey()] || []);
        list.forEach(rec => {
          (rec.ranges || []).forEach(r => {
            if (!r || typeof r.so !== 'number' || typeof r.eo !== 'number' || r.so === r.eo) return;
            const tn = getNodeByPath(r.s);
            if (!tn || tn.nodeType !== Node.TEXT_NODE) return;
            const span = document.createElement('span');
            span.className = 'text-marker marker-orange';
            span.setAttribute('data-comment-id', rec.id);
            applyColorStyles(span, 'orange');
            wrapBySplitText(tn, r.so, r.eo, span);
          });
        });
      } catch (e) {
        console.warn('restoreCommentMarkers failed', e);
      }
    }

    // 範囲のシリアライズ/デシリアライズ
    function serializeRange(range) {
      return {
        s: getPath(range.startContainer), so: range.startOffset,
        e: getPath(range.endContainer), eo: range.endOffset
      };
    }
    function deserializeRange(obj) {
      try {
        const sc = getNodeByPath(obj.s);
        const ec = getNodeByPath(obj.e);
        if (!sc || !ec) return null;
        const r = document.createRange();
        r.setStart(sc, Math.min(obj.so, nodeMaxOffset(sc)));
        r.setEnd(ec, Math.min(obj.eo, nodeMaxOffset(ec)));
        return r;
      } catch { return null; }
    }
    function nodeIndex(node){ let i=0; while(node && node.previousSibling){ node = node.previousSibling; i++; } return i; }
    function getPath(node){ const p=[]; let n=node; while(n && n !== document.body){ p.push(nodeIndex(n)); n = n.parentNode; } return p.reverse(); }
    function getNodeByPath(path){ let n=document.body; for(const idx of path){ if(!n || !n.childNodes[idx]) return null; n = n.childNodes[idx]; } return n; }
    function nodeMaxOffset(n){ return n.nodeType===Node.TEXT_NODE ? (n.nodeValue||'').length : (n.childNodes?n.childNodes.length:0); }

    function wrapBySplitText(textNode, start, end, wrapper) {
      try {
        let mid = textNode;
        if (start > 0) mid = textNode.splitText(start);
        let tail = mid;
        const len = end - start;
        if (len < mid.nodeValue.length) tail = mid.splitText(len);
        const parent = mid.parentNode;
        parent.insertBefore(wrapper, mid);
        wrapper.appendChild(mid);
      } catch (e) {
        console.warn('wrapBySplitText failed', e);
      }
    }

    function applyColorStyles(el, color) {
      // インラインスタイルで確実に可視化（CSSが読み込めないfile://時の保険）
      const map = {
        yellow: 'rgba(255, 235, 59, 0.6)',
        green:  'rgba(129, 199, 132, 0.5)',
        blue:   'rgba(100, 181, 246, 0.5)',
        pink:   'rgba(244, 143, 177, 0.5)',
        orange: 'rgba(255, 152, 0, 0.45)'
      };
      el.style.backgroundColor = map[color] || 'rgba(255, 235, 59, 0.6)';
      el.style.boxShadow = 'inset 0 -0.15em 0 rgba(0,0,0,0.08)';
    }
  }

  function setupMobileFootnoteToggle() {
    document.querySelectorAll('.footnote-ref').forEach(footnote => {
      footnote.addEventListener('click', (e) => {
        e.preventDefault();
        const footnoteId = footnote.getAttribute('href');
        const footnoteDef = document.querySelector(footnoteId);
        if (footnoteDef) footnoteDef.classList.toggle('expanded');
      });
    });
  }

  function disableDefaultQuartoSearch() {
    try {
      const defaultBtn = document.getElementById('quarto-search');
      if (defaultBtn) defaultBtn.remove();
      const defaultPanel = document.getElementById('quarto-search-results');
      if (defaultPanel) defaultPanel.remove();
      const defaultOptions = document.getElementById('quarto-search-options');
      if (defaultOptions) defaultOptions.remove();
      if (window.Quarto && typeof window.Quarto.doc === 'object') {
        window.Quarto.doc.disableSearch = true;
      }
    } catch (e) {
      console.warn('Failed to disable default Quarto search', e);
    }
  }

  function setupSidebarSearch() {
    const sidebarSearch = document.querySelector('#quarto-sidebar .sidebar-search');
    if (!sidebarSearch) return;

    sidebarSearch.innerHTML = '';

    const form = document.createElement('form');
    form.className = 'sidebar-search-form';
    form.setAttribute('role', 'search');
    form.setAttribute('aria-label', 'サイト内検索フォーム');

    const input = document.createElement('input');
    input.type = 'search';
    input.id = 'sidebar-search-input';
    input.placeholder = 'キーワードを検索...';
    input.setAttribute('aria-label', 'キーワードを検索');
    input.autocomplete = 'off';

    form.appendChild(input);
    sidebarSearch.appendChild(form);

    const resultsWrapper = document.createElement('div');
    resultsWrapper.className = 'sidebar-search-results hidden';
    resultsWrapper.innerHTML = `
      <div class="sidebar-search-header">
        <span class="sidebar-search-query"></span>
        <button type="button" class="sidebar-search-clear" aria-label="検索結果を閉じる">×</button>
      </div>
      <div class="sidebar-search-summary"></div>
      <div class="sidebar-search-items"></div>
      <div class="sidebar-search-empty">検索結果はここに表示されます。</div>
    `;
    sidebarSearch.appendChild(resultsWrapper);

    SEARCH_RESULTS_VIEW.sidebarContainer = resultsWrapper;
    SEARCH_RESULTS_VIEW.sidebarSummary = resultsWrapper.querySelector('.sidebar-search-summary');
    SEARCH_RESULTS_VIEW.sidebarList = resultsWrapper.querySelector('.sidebar-search-items');
    SEARCH_RESULTS_VIEW.sidebarQuery = resultsWrapper.querySelector('.sidebar-search-query');
    SEARCH_RESULTS_VIEW.sidebarClearBtn = resultsWrapper.querySelector('.sidebar-search-clear');

    if (SEARCH_RESULTS_VIEW.sidebarClearBtn) {
      SEARCH_RESULTS_VIEW.sidebarClearBtn.addEventListener('click', (event) => {
        event.preventDefault();
        clearSidebarSearchResults();
      });
    }

    const openOverlayWithQuery = (raw) => {
      const query = (typeof raw === 'string' ? raw : '').trim();
      const handle = openSearchOverlay(query);
      if (handle && handle.input) {
        const end = handle.input.value.length;
        handle.input.focus();
        handle.input.setSelectionRange(end, end);
      }
    };

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      openOverlayWithQuery(input.value);
    });

    input.addEventListener('keydown', (event) => {
      if (event.key === 'Enter') {
        event.preventDefault();
        openOverlayWithQuery(input.value);
      }
    });

    input.addEventListener('input', (event) => {
      const value = event.target.value;
      const overlay = document.querySelector('.global-search-overlay');
      if (!overlay) {
        if (value.trim().length >= 1) {
          openOverlayWithQuery(value);
        }
        return;
      }
      const overlayInput = overlay.querySelector('#global-search-input');
      if (overlayInput && overlayInput.value !== value) {
        overlayInput.value = value;
        overlayInput.dispatchEvent(new Event('input', { bubbles: true }));
      }
    });

    restoreSearchSession();
  }

  const SEARCH_SESSION_KEY = 'quarto-search-session';

  function saveSearchSession(session) {
    try {
      sessionStorage.setItem(SEARCH_SESSION_KEY, JSON.stringify(session));
    } catch (error) {
      console.warn('Search session save failed', error);
    }
  }

  function loadSearchSession() {
    try {
      const raw = sessionStorage.getItem(SEARCH_SESSION_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch (error) {
      console.warn('Search session load failed', error);
      return null;
    }
  }

  function restoreSearchSession() {
    const session = loadSearchSession();
    if (!session || !Array.isArray(session.results) || !session.results.length) {
      clearSidebarSearchResults();
      return;
    }

    SEARCH_RESULTS_VIEW.sidebarData = session;
    renderSidebarSearchResults(session);

    const currentUrl = new URL(window.location.href, window.location.origin);
    if (session.active) {
      const target = new URL(session.active.url, window.location.href);
      if (target.origin === currentUrl.origin && target.pathname === currentUrl.pathname) {
        requestAnimationFrame(() => {
          clearSearchHighlights();
          scrollToMatchOnPage(session.query, session.active.matchIndex || 0);
        });
      }
    }
  }

  function clearSidebarSearchResults() {
    if (SEARCH_RESULTS_VIEW.sidebarContainer) {
      SEARCH_RESULTS_VIEW.sidebarContainer.classList.add('hidden');
      const empty = SEARCH_RESULTS_VIEW.sidebarContainer.querySelector('.sidebar-search-empty');
      if (empty) empty.classList.remove('hidden');
    }
    if (SEARCH_RESULTS_VIEW.sidebarSummary) {
      SEARCH_RESULTS_VIEW.sidebarSummary.innerHTML = '';
    }
    if (SEARCH_RESULTS_VIEW.sidebarList) {
      SEARCH_RESULTS_VIEW.sidebarList.innerHTML = '';
    }
    if (SEARCH_RESULTS_VIEW.sidebarQuery) {
      SEARCH_RESULTS_VIEW.sidebarQuery.textContent = '';
    }
    SEARCH_RESULTS_VIEW.sidebarData = null;
    clearSearchHighlights();
    try {
      sessionStorage.removeItem(SEARCH_SESSION_KEY);
    } catch (error) {
      console.warn('Failed to clear search session', error);
    }
  }

  function renderSidebarSearchResults(session) {
    const container = SEARCH_RESULTS_VIEW.sidebarContainer;
    if (!container) return;

    SEARCH_RESULTS_VIEW.sidebarData = session;

    const empty = container.querySelector('.sidebar-search-empty');
    const summary = SEARCH_RESULTS_VIEW.sidebarSummary;
    const list = SEARCH_RESULTS_VIEW.sidebarList;
    const queryLabel = SEARCH_RESULTS_VIEW.sidebarQuery;

    if (!session || !Array.isArray(session.results) || !session.results.length) {
      clearSidebarSearchResults();
      return;
    }

    container.classList.remove('hidden');
    if (empty) empty.classList.add('hidden');
    if (queryLabel) {
      queryLabel.textContent = `「${session.query}」`;
    }
    if (summary) {
      const hiddenCount = session.results.reduce((sum, item) => sum + (item.remainingMatches || 0), 0);
      const totalMatches = session.results.length + hiddenCount;
      summary.innerHTML = `<p><strong>${totalMatches}</strong>件の結果（「${escapeHtml(session.query)}」）</p>`;
    }
    if (list) {
      list.innerHTML = '';
      session.results.forEach((result, index) => {
        const itemBtn = document.createElement('button');
        itemBtn.type = 'button';
        itemBtn.className = 'sidebar-search-item';
        if (session.active &&
            session.active.url === result.url &&
            session.active.matchIndex === result.matchIndex) {
          itemBtn.classList.add('active');
        }

        itemBtn.innerHTML = `
          <span class="sidebar-search-item-title">${escapeHtml(result.title || result.url)}</span>
          <span class="sidebar-search-item-order">${result.matchIndex + 1}/${result.totalMatches || result.matchCount || 1}</span>
          <span class="sidebar-search-item-count">${result.totalMatches || result.matchCount || 1}件</span>
          <div class="sidebar-search-item-context">${result.context}</div>
        `;

        itemBtn.addEventListener('click', () => {
          handleSidebarResultSelection(result, index);
        });
        list.appendChild(itemBtn);
      });
    }
  }

  function handleSidebarResultSelection(result, index) {
    if (!SEARCH_RESULTS_VIEW.sidebarData) return;
    const session = SEARCH_RESULTS_VIEW.sidebarData;
    session.active = {
      url: result.url,
      matchIndex: result.matchIndex,
      index
    };
    session.timestamp = Date.now();
    saveSearchSession(session);
    renderSidebarSearchResults(session);
    navigateToSearchResult(result, session.query);
  }

  function handleOverlayResultSelection(result) {
    if (!result) return;
    const activePayload = convertResultToSession(result);
    const session = {
      query: SEARCH_RESULTS_VIEW.query,
      results: convertOverlayResultsForSession(SEARCH_RESULTS_VIEW.results),
      active: {
        url: activePayload.url,
        matchIndex: activePayload.matchIndex || 0
      },
      timestamp: Date.now()
    };
    SEARCH_RESULTS_VIEW.sidebarData = session;
    saveSearchSession(session);
    renderSidebarSearchResults(session);
    if (typeof SEARCH_RESULTS_VIEW.closeOverlay === 'function') {
      SEARCH_RESULTS_VIEW.closeOverlay();
    }
    navigateToSearchResult(activePayload, session.query);
  }

  function resolveResultUrl(url) {
    try {
      const resolved = new URL(url, window.location.href);
      return resolved.href;
    } catch {
      return url;
    }
  }

  function convertOverlayResultsForSession(results) {
    return results.map(convertResultToSession);
  }

  function convertResultToSession(result) {
    const page = result.page || {};
    return {
      url: resolveResultUrl(page.url || result.url || window.location.href),
      title: page.title || result.title || (page.url || 'ページ'),
      chapter: page.chapter || result.chapter || '',
      context: result.context || '',
      matchCount: result.matchCount || 1,
      totalMatches: result.totalMatches || result.matchCount || 1,
      remainingMatches: result.remainingMatches || 0,
      matchIndex: result.matchIndex || 0
    };
  }

  function navigateToSearchResult(result, query) {
    if (!result) return;
    const targetUrl = new URL(result.url, window.location.href);
    const currentUrl = new URL(window.location.href);
    const sameDocument = targetUrl.origin === currentUrl.origin && targetUrl.pathname === currentUrl.pathname;

    if (sameDocument) {
      if (targetUrl.hash && targetUrl.hash !== window.location.hash) {
        window.location.hash = targetUrl.hash;
      }
      requestAnimationFrame(() => {
        if (!scrollToMatchOnPage(query, result.matchIndex || 0) && targetUrl.hash) {
          const targetEl = document.querySelector(targetUrl.hash);
          if (targetEl && typeof targetEl.scrollIntoView === 'function') {
            targetEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      });
    } else {
      window.location.href = targetUrl.href;
    }
  }

  let activeSearchHighlights = [];

  function clearSearchHighlights() {
    if (!activeSearchHighlights.length) return;
    activeSearchHighlights.forEach(span => {
      try {
        if (!span || !span.parentNode) return;
        const parent = span.parentNode;
        while (span.firstChild) {
          parent.insertBefore(span.firstChild, span);
        }
        parent.removeChild(span);
      } catch (error) {
        console.warn('Failed clearing highlight', error);
      }
    });
    activeSearchHighlights = [];
  }

  function highlightRange(range) {
    if (!range) return;
    const mark = document.createElement('mark');
    mark.className = 'search-hit-highlight';
    try {
      range.surroundContents(mark);
      activeSearchHighlights.push(mark);
      mark.scrollIntoView({ behavior: 'smooth', block: 'center' });
      setTimeout(() => {
        mark.classList.add('search-hit-fade');
      }, 100);
    } catch (error) {
      console.warn('Failed to highlight range', error);
    }
  }

  function scrollToMatchOnPage(query, matchIndex) {
    if (!query) return false;
    clearSearchHighlights();
    const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null);
    const target = query.toLowerCase();
    let occurrence = -1;
    let node = walker.nextNode();
    while (node) {
      if (!(node.parentElement && node.parentElement.closest('.global-search-overlay'))) {
        const text = node.textContent || '';
        const lower = text.toLowerCase();
        let pos = 0;
        while (true) {
          const found = lower.indexOf(target, pos);
          if (found === -1) break;
          occurrence += 1;
          if (occurrence === matchIndex) {
            const range = document.createRange();
            range.setStart(node, found);
            range.setEnd(node, found + query.length);
            highlightRange(range);
            return true;
          }
          pos = found + query.length;
        }
      }
      node = walker.nextNode();
    }
    return false;
  }
  function setupGlobalSearch() {
    const openBtn = document.getElementById('search-open-btn');
    if (openBtn) openBtn.addEventListener('click', (e) => { e.preventDefault(); openSearchOverlay(); });

    window.quartoOpenSearch = (initialQuery = '') => {
      if (typeof initialQuery !== 'string') initialQuery = '';
      openSearchOverlay(initialQuery);
    };

    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && (e.key === 'k' || e.key === 'K')) {
        e.preventDefault();
        openSearchOverlay();
      }
    }, true);
  }

  const SEARCH_STATE = {
    pages: [],
    index: {},
    loading: false,
    loaded: false,
    localSections: []
  };

  const SEARCH_RESULTS_VIEW = {
    results: [],
    query: '',
    rendered: 0,
    chunkSize: 20,
    totalCount: 0,
    summaryEl: null,
    listEl: null,
    loadMoreWrapper: null,
    loadMoreBtn: null,
    lastChapter: '',
    lastPage: '',
    closeOverlay: null,
    overlayKeyHandler: null,
    overlayClickHandler: null,
    sidebarContainer: null,
    sidebarSummary: null,
    sidebarList: null,
    sidebarQuery: null,
    sidebarClearBtn: null,
    sidebarData: null
  };

  const MAX_SNIPPETS_PER_PAGE = 20;
  const MAX_MATCHES_SCAN = 400;

  function collectBookPages() {
    if (SEARCH_STATE.pages.length) return SEARCH_STATE.pages;
    // file:// では他ページfetchがブロックされるため現在ページのみ
    if (location.protocol === 'file:') {
      const sections = Array.from(document.querySelectorAll('section.chapter-page'));
      const baseUrl = window.location.href.split('#')[0];
      if (!sections.length) {
        SEARCH_STATE.localSections = [];
        SEARCH_STATE.pages = [baseUrl];
        return SEARCH_STATE.pages;
      }
      SEARCH_STATE.localSections = sections.map(section => {
        const id = section.id || '';
        const url = id ? `${baseUrl}#${id}` : baseUrl;
        return { id, url, element: section };
      });
      SEARCH_STATE.pages = SEARCH_STATE.localSections.map(entry => entry.url);
      return SEARCH_STATE.pages;
    }
    const sidebar = document.querySelector('#quarto-sidebar .sidebar-menu-container');
    const hrefs = new Set();
    if (sidebar) {
      sidebar.querySelectorAll('a[href]')?.forEach(a => {
        const href = a.getAttribute('href');
        if (!href) return;
        if (href.startsWith('http')) return;
        if (href.startsWith('#')) return;
        hrefs.add(new URL(href, window.location.href).href);
      });
    }
    // Also add current page
    hrefs.add(window.location.href);
    SEARCH_STATE.pages = Array.from(hrefs);
    SEARCH_STATE.localSections = [];
    return SEARCH_STATE.pages;
  }

  function normalizeWhitespace(text) {
    return (text || '').replace(/\s+/g, ' ').trim();
  }

  function deriveSectionTitle(section, fallback) {
    if (!section) return fallback || 'このページ';
    const selectors = ['h1 .chapter-title', 'h1', '.chapter-title', 'header .title', 'h2', 'h3'];
    for (const sel of selectors) {
      const el = section.querySelector(sel);
      if (el) {
        const txt = normalizeWhitespace(el.textContent);
        if (txt) return txt;
      }
    }
    const heading = Array.from(section.querySelectorAll('h1, h2, h3, h4, h5')).find(h => normalizeWhitespace(h.textContent));
    if (heading) return normalizeWhitespace(heading.textContent);
    const id = section.id || '';
    if (id) return normalizeWhitespace(id.replace(/^page-/, '').replace(/[-_]+/g, ' ')) || (fallback || 'このページ');
    return fallback || 'このページ';
  }

  function extractSectionText(section) {
    if (!section) return '';
    const clone = section.cloneNode(true);
    const removable = [
      'script',
      'style',
      'nav',
      '.single-pager',
      '.margin-note',
      '.right-footnotes',
      '.right-comments',
      '.right-both',
      '.comment-menu-popup',
      '.global-search-overlay',
      '.global-search-dialog',
      '.marker-toolbar'
    ];
    removable.forEach(sel => clone.querySelectorAll(sel).forEach(el => el.remove()));
    return normalizeWhitespace(clone.textContent || '');
  }

  async function buildSearchIndex() {
    if (SEARCH_STATE.loaded || SEARCH_STATE.loading) return;
    SEARCH_STATE.loading = true;
    SEARCH_STATE.index = {};
    const pages = collectBookPages();

    if (location.protocol === 'file:') {
      const baseUrl = window.location.href.split('#')[0];
      if (!SEARCH_STATE.localSections || !SEARCH_STATE.localSections.length) {
        collectBookPages();
      }
      const docTitle = normalizeWhitespace(document.querySelector('header .title')?.textContent || document.title || '');
      const sections = (SEARCH_STATE.localSections && SEARCH_STATE.localSections.length)
        ? SEARCH_STATE.localSections
        : [];
      const seen = new Set();
      if (sections.length) {
        sections.forEach(entry => {
          const section = entry.element;
          const url = entry.url || (entry.id ? `${baseUrl}#${entry.id}` : baseUrl);
          const title = deriveSectionTitle(section, docTitle || baseUrl);
          const text = extractSectionText(section);
          SEARCH_STATE.index[url] = { url, title, text, slug: entry.id };
          seen.add(url);
        });
        const hasIndex = sections.some(entry => (entry.id || '').toLowerCase() === 'page-index');
        if (!hasIndex) {
          const main = document.querySelector('main#quarto-document-content') || document.querySelector('main') || document.body;
          if (main) {
            const text = extractSectionText(main);
            const url = baseUrl;
            if (!seen.has(url)) {
              const title = deriveSectionTitle(main, docTitle || baseUrl);
              SEARCH_STATE.index[url] = { url, title, text };
            }
          }
        }
      } else {
        const main = document.querySelector('main#quarto-document-content') || document.querySelector('main') || document.body;
        const text = extractSectionText(main);
        SEARCH_STATE.index[baseUrl] = { url: baseUrl, title: docTitle || baseUrl, text };
      }
      SEARCH_STATE.loaded = true;
      SEARCH_STATE.loading = false;
      return;
    }

    const fetchPage = async (url) => {
      try {
        const res = await fetch(url);
        const html = await res.text();
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const title = (doc.querySelector('header .title')?.textContent || doc.querySelector('title')?.textContent || '').trim();
        const main = doc.querySelector('main') || doc.querySelector('#quarto-document-content') || doc.body;
        const text = (main.textContent || '').replace(/\s+/g, ' ').trim();
        return { url, title, text };
      } catch (e) {
        console.warn('Search: failed to fetch', url, e);
        return { url, title: url, text: '' };
      }
    };

    const results = await Promise.all(pages.map(fetchPage));
    results.forEach(r => { SEARCH_STATE.index[r.url] = r; });
    SEARCH_STATE.loaded = true;
    SEARCH_STATE.loading = false;
  }

  function openSearchOverlay(initialQuery = '') {
    const startQuery = (typeof initialQuery === 'string') ? initialQuery.trim() : '';
    let overlay = document.querySelector('.global-search-overlay');
    if (overlay) overlay.remove();

    overlay = document.createElement('div');
    overlay.className = 'global-search-overlay';
    overlay.innerHTML = `
      <div class="global-search-dialog" role="dialog" aria-modal="true" aria-label="全ページ検索">
        <div class="global-search-header">
          <h3>検索</h3>
          <button class="global-search-close" aria-label="閉じる">×</button>
        </div>
        <div class="global-search-input-wrapper">
          <input id="global-search-input" type="text" placeholder="キーワードを入力 (Ctrl/Cmd + K)" autocomplete="off" />
          <button id="global-search-btn">検索</button>
        </div>
        <div class="global-search-results">
          <div class="search-help">検索語を入力してください。</div>
        </div>
      </div>
    `;
    document.body.appendChild(overlay);
    overlay.style.display = 'block';
    document.body.classList.add('search-overlay-active');

    const close = () => {
      if (overlay && overlay.parentNode) {
        overlay.parentNode.removeChild(overlay);
      }
      document.body.classList.remove('search-overlay-active');
      if (SEARCH_RESULTS_VIEW.overlayKeyHandler) {
        document.removeEventListener('keydown', SEARCH_RESULTS_VIEW.overlayKeyHandler, true);
        SEARCH_RESULTS_VIEW.overlayKeyHandler = null;
      }
      if (SEARCH_RESULTS_VIEW.overlayClickHandler) {
        document.removeEventListener('click', SEARCH_RESULTS_VIEW.overlayClickHandler, true);
        SEARCH_RESULTS_VIEW.overlayClickHandler = null;
      }
      resetSearchResultsView();
      SEARCH_RESULTS_VIEW.closeOverlay = null;
    };
    overlay.addEventListener('click', (e) => { if (e.target === overlay) close(); });
    overlay.querySelector('.global-search-close')?.addEventListener('click', close);

    const input = overlay.querySelector('#global-search-input');
    const btn = overlay.querySelector('#global-search-btn');
    const syncSidebarInput = (value) => {
      const sidebarInput = document.getElementById('sidebar-search-input');
      if (!sidebarInput || sidebarInput === document.activeElement) return;
      if (sidebarInput.value !== value) sidebarInput.value = value;
    };
    input.value = startQuery;
    input.focus();

    const ensureIndex = async () => {
      if (!SEARCH_STATE.loaded) {
        const results = overlay.querySelector('.global-search-results');
        results.innerHTML = '<div class="search-loading">索引を作成中...</div>';
        await buildSearchIndex();
      }
    };

    const doSearch = async () => {
      const q = (input.value || '').trim();
      syncSidebarInput(q);
      const resultsEl = overlay.querySelector('.global-search-results');
      if (!q) {
        resultsEl.innerHTML = '<div class="search-help">検索語を入力してください。</div>';
        resetSearchResultsView();
        return;
      }
      await ensureIndex();
      const results = [];
      for (const url of Object.keys(SEARCH_STATE.index)) {
        const item = SEARCH_STATE.index[url];
        if (!item || !item.text) continue;
        const page = {
          url,
          title: item.title || url,
          chapter: item.title || ''
        };
        const matches = findMatches(item.text, q, MAX_SNIPPETS_PER_PAGE);
        matches.forEach(match => {
          results.push({
            page,
            context: match.context,
            matchCount: match.totalMatches,
            totalMatches: match.totalMatches,
            matchIndex: match.matchIndex,
            remainingMatches: match.remainingMatches
          });
        });
      }
      renderResults(resultsEl, results, q);
    };

    const debouncedSearch = debounce(doSearch, 200);

    const dialog = overlay.querySelector('.global-search-dialog');
    const keyHandler = (event) => {
      if (event.key === 'Escape') {
        event.preventDefault();
        close();
      }
    };
    const clickHandler = (event) => {
      if (dialog && !dialog.contains(event.target)) {
        close();
      }
    };
    document.addEventListener('keydown', keyHandler, true);
    document.addEventListener('click', clickHandler, true);
    SEARCH_RESULTS_VIEW.overlayKeyHandler = keyHandler;
    SEARCH_RESULTS_VIEW.overlayClickHandler = clickHandler;
    SEARCH_RESULTS_VIEW.closeOverlay = close;

    input.addEventListener('input', () => { debouncedSearch(); });
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); doSearch(); }
      if (e.key === 'Escape') { e.preventDefault(); close(); }
    });
    btn.addEventListener('click', () => { doSearch(); });

    if (startQuery.length) {
      doSearch();
      const end = input.value.length;
      input.setSelectionRange(end, end);
    }

    return { overlay, input, close };
  }

  function findMatches(text, query, limit) {
    if (!text || !query) return [];
    const sanitized = text.replace(/\s+/g, ' ');
    const hay = sanitized.toLowerCase();
    const needle = query.toLowerCase();
    const indices = [];
    let pos = 0;
    let safety = 0;
    while (pos < hay.length) {
      const idx = hay.indexOf(needle, pos);
      if (idx === -1) break;
      indices.push(idx);
      pos = idx + needle.length;
      safety += 1;
      if (safety >= MAX_MATCHES_SCAN) break;
    }
    const total = indices.length;
    if (!total) return [];
    const clamp = Math.min(total, limit || MAX_SNIPPETS_PER_PAGE);
    const results = [];
    for (let i = 0; i < clamp; i += 1) {
      const start = Math.max(0, indices[i] - 80);
      const end = Math.min(sanitized.length, indices[i] + query.length + 80);
      let snippet = sanitized.slice(start, end);
      snippet = highlight(snippet, query);
      if (start > 0) snippet = '…' + snippet;
      if (end < sanitized.length) snippet = snippet + '…';
      const remainingMatches = (total > clamp && i === clamp - 1) ? total - clamp : 0;
      if (remainingMatches > 0) {
        snippet += `<span class="search-result-more">他${remainingMatches}件の一致</span>`;
      }
      results.push({
        context: snippet,
        matchIndex: i,
        totalMatches: total,
        remainingMatches
      });
    }
    return results;
  }

  function escapeHtml(s) {
    return (s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
  }

  function highlight(text, query) {
    const escQ = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    return text.replace(new RegExp(escQ, 'gi'), m => `<mark>${escapeHtml(m)}</mark>`);
  }

  function fmtMMDDHHmm(t){
    const d = new Date(t); const pad = (n)=>String(n).padStart(2,'0');
    return `${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }

  function renderResults(container, results, query) {
    if (!container) return;

    if (!results.length) {
      container.innerHTML = `<div class="search-no-results"><p>一致が見つかりませんでした。</p><ul><li>語句を短くする</li><li>別のキーワードを試す</li></ul></div>`;
      resetSearchResultsView();
      return;
    }

    resetSearchResultsView();
    clearSearchHighlights();
    SEARCH_RESULTS_VIEW.results = results;
    SEARCH_RESULTS_VIEW.query = query;
    SEARCH_RESULTS_VIEW.totalCount = results.length + results.reduce((sum, r) => sum + (r.remainingMatches || 0), 0);

    container.innerHTML = '';

    const summary = document.createElement('div');
    summary.className = 'search-results-summary';
    container.appendChild(summary);
    SEARCH_RESULTS_VIEW.summaryEl = summary;

    const listWrap = document.createElement('div');
    listWrap.className = 'search-results-items';
    container.appendChild(listWrap);
    SEARCH_RESULTS_VIEW.listEl = listWrap;

    const loadMoreWrapper = document.createElement('div');
    loadMoreWrapper.className = 'search-load-more-wrapper';
    const loadMoreBtn = document.createElement('button');
    loadMoreBtn.type = 'button';
    loadMoreBtn.className = 'search-load-more-btn';
    loadMoreBtn.textContent = 'さらに表示';
    loadMoreWrapper.appendChild(loadMoreBtn);
    container.appendChild(loadMoreWrapper);
    SEARCH_RESULTS_VIEW.loadMoreWrapper = loadMoreWrapper;
    SEARCH_RESULTS_VIEW.loadMoreBtn = loadMoreBtn;
    loadMoreBtn.addEventListener('click', () => renderOverlayResultsChunk());

    renderOverlayResultsChunk(true);
  }

  function renderOverlayResultsChunk(reset = false) {
    const state = SEARCH_RESULTS_VIEW;
    if (!state.listEl) return;

    if (reset) {
      state.listEl.innerHTML = '';
      state.rendered = 0;
      state.lastChapter = '';
      state.lastPage = '';
    }

    const total = state.results.length;
    if (state.rendered >= total) {
      updateOverlayResultsSummary();
      if (state.loadMoreWrapper) state.loadMoreWrapper.style.display = 'none';
      return;
    }

    const limit = Math.min(total, state.rendered + state.chunkSize);
    for (let i = state.rendered; i < limit; i += 1) {
      const result = state.results[i];
      const chapter = result.page?.chapter || '';
      const pageUrl = result.page?.url || '';

      if (chapter && (chapter !== state.lastChapter || pageUrl !== state.lastPage)) {
        const section = document.createElement('section');
        section.className = 'search-chapter-section';
        const heading = document.createElement('h4');
        heading.className = 'search-chapter-title';
        heading.textContent = chapter;
        section.appendChild(heading);
        state.listEl.appendChild(section);
        state.lastChapter = chapter;
        state.lastPage = pageUrl;
      }

      const item = document.createElement('div');
      item.className = 'search-result-item';

      const titleRow = document.createElement('div');
      titleRow.className = 'search-result-title';

      const link = document.createElement('a');
      link.className = 'search-result-link';
      link.href = result.page?.url || '#';
      link.textContent = result.page?.title || result.page?.url || 'ページ';
      link.addEventListener('click', (event) => {
        event.preventDefault();
        handleOverlayResultSelection(result);
      });

      const order = document.createElement('span');
      order.className = 'search-snippet-order';
      order.textContent = `${(result.matchIndex || 0) + 1}/${result.totalMatches || result.matchCount || 1}`;

      const badge = document.createElement('span');
      badge.className = 'search-match-count';
      badge.textContent = `${result.totalMatches || result.matchCount || 1}件`;

      titleRow.appendChild(link);
      titleRow.appendChild(order);
      titleRow.appendChild(badge);
      item.appendChild(titleRow);

      const ctx = document.createElement('div');
      ctx.className = 'search-result-context';
      ctx.innerHTML = result.context;
      item.appendChild(ctx);

      state.listEl.appendChild(item);
    }

    state.rendered = limit;
    updateOverlayResultsSummary();

    if (state.loadMoreWrapper) {
      state.loadMoreWrapper.style.display = state.rendered >= total ? 'none' : '';
    }
  }

  function updateOverlayResultsSummary() {
    const state = SEARCH_RESULTS_VIEW;
    if (!state.summaryEl) return;
    const hiddenCount = state.results.reduce((sum, item) => sum + (item.remainingMatches || 0), 0);
    const totalMatches = state.results.length + hiddenCount;
    const shownMatches = Math.min(state.rendered, state.results.length);
    const escapedQuery = escapeHtml(state.query);
    state.summaryEl.innerHTML = `
      <p><strong>${totalMatches}</strong>件の結果（「${escapedQuery}」）</p>
      <p class="search-results-muted">${shownMatches}件を表示中${hiddenCount > 0 ? `（他${hiddenCount}件）` : ''}</p>
    `;
  }

  function resetSearchResultsView() {
    SEARCH_RESULTS_VIEW.results = [];
    SEARCH_RESULTS_VIEW.query = '';
    SEARCH_RESULTS_VIEW.rendered = 0;
    SEARCH_RESULTS_VIEW.totalCount = 0;
    SEARCH_RESULTS_VIEW.summaryEl = null;
    SEARCH_RESULTS_VIEW.listEl = null;
    SEARCH_RESULTS_VIEW.loadMoreWrapper = null;
    SEARCH_RESULTS_VIEW.loadMoreBtn = null;
    SEARCH_RESULTS_VIEW.lastChapter = '';
    SEARCH_RESULTS_VIEW.lastPage = '';
  }

  function setupKeyboardShortcuts() {
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const dialogs = document.querySelectorAll('.global-search-dialog');
        dialogs.forEach(dialog => dialog.remove());
      }
    });
  }

  function setupScrollPosition() {
    const scrollY = sessionStorage.getItem(STORAGE_KEYS.scrollPosition);
    if (scrollY) window.scrollTo(0, parseInt(scrollY));
    window.addEventListener('beforeunload', () => {
      sessionStorage.setItem(STORAGE_KEYS.scrollPosition, window.scrollY);
    });
  }

  function expandAllInMenu(root) {
    try {
      root.querySelectorAll('.collapse').forEach(el => {
        el.classList.add('show');
        el.style.height = 'auto';
      });
      root.querySelectorAll('[data-bs-toggle="collapse"]').forEach(tg => {
        tg.setAttribute('aria-expanded', 'true');
      });
      root.querySelectorAll('[data-bs-toggle="collapse"]').forEach(tg => {
        tg.removeAttribute('data-bs-toggle');
        tg.removeAttribute('data-bs-target');
      });
    } catch (e) {
      console.warn('Failed to expand all menu levels:', e);
    }
  }

  // Quarto左サイドバー（各章/全体）: 指定階層まで展開、それ以降を折りたたみ
  function setSidebarDepth(root, maxDepth) {
    try {
      const togglers = root.querySelectorAll('[data-bs-toggle="collapse"][data-bs-target]');
      const getDepthForTarget = (target) => {
        let d = 1; let n = target;
        while (n && n !== root) { if (n.tagName === 'UL') d++; n = n.parentElement; }
        return d;
      };
      togglers.forEach(tg => {
        const sel = tg.getAttribute('data-bs-target');
        if (!sel || sel[0] !== '#') return;
        const target = root.querySelector(sel);
        if (!target) return;
        const depth = getDepthForTarget(target);
        const open = (maxDepth === Infinity) || (depth <= maxDepth);
        target.classList.toggle('show', !!open);
        target.style.height = open ? 'auto' : '';
        tg.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    } catch (e) {
      console.warn('setSidebarDepth error:', e);
    }
  }

  // ページ内目次: ツリー化 + 展開/格納トグルを付与（デフォルト階層まで展開）
  // 階層判定は必ずMarkdownの#数（= 見出しタグH1..H6のレベル）に従う
  function enhancePageToc(panel, defaultDepth) {
    const nav = panel.querySelector('nav#TOC');
    if (!nav) return;
    const getHeadingLevelFromLink = (a) => {
      try {
        if (!a) return null;
        const href = a.getAttribute('href') || '';
        if (!href.startsWith('#')) return null;
        const id = href.slice(1);
        const h = document.getElementById(id);
        if (!h) return null;
        const tag = (h.tagName || '').toUpperCase();
        if (/^H[1-6]$/.test(tag)) return parseInt(tag.slice(1), 10);
        return null;
      } catch { return null; }
    };

    nav.querySelectorAll('li').forEach(li => {
      const childUl = li.querySelector(':scope > ul');
      const link = li.querySelector(':scope > a');
      const level = getHeadingLevelFromLink(link);

      if (childUl) {
        li.classList.add('has-children');
        const toggle = document.createElement('span');
        toggle.className = 'toc-toggle';
        toggle.textContent = '▾';
        if (link && link.parentNode === li) {
          const row = document.createElement('div');
          row.className = 'li-row';
          li.insertBefore(row, link);
          row.appendChild(toggle);
          row.appendChild(link);
        } else {
          li.insertBefore(toggle, li.firstChild);
        }
        toggle.addEventListener('click', () => {
          li.classList.toggle('collapsed');
          toggle.textContent = li.classList.contains('collapsed') ? '▸' : '▾';
        });
      }

      // 初期展開状態は # のレベルで判定
      if (level != null) {
        const open = (defaultDepth === Infinity) || (level <= defaultDepth);
        if (open) {
          li.classList.remove('collapsed');
          const t = li.querySelector(':scope > .toc-toggle');
          if (t) t.textContent = '▾';
        } else {
          li.classList.add('collapsed');
          const t = li.querySelector(':scope > .toc-toggle');
          if (t) t.textContent = '▸';
        }
      }
    });
  }

  // 独自TOCシステム
  const CustomTOC = {
    // 現在のページの見出しを取得
    getPageHeadings: function() {
      const headmap = new Map();
      let maxDepth = 0;
      
      // メインコンテンツから見出しを取得
      const allHeadings = document.querySelectorAll('main h1, main h2, main h3, main h4, main h5, main h6');
      
      allHeadings.forEach(heading => {
        const text = heading.textContent || heading.innerText || '';
        if (!text.trim()) return;
        
        const level = parseInt(heading.tagName.slice(1), 10);
        const id = heading.id || this.generateIdFromText(text);
        
        headmap.set(id, {
          id: id,
          text: text,
          level: level,
          element: heading,
          children: []
        });
        maxDepth = Math.max(maxDepth, level);
      });
      
      return { headings: headmap, maxDepth: maxDepth };
    },
    
    // テキストからIDを生成（Quarto互換）
    generateIdFromText: function(text) {
      return text
        .replace(/\s+/g, ' ')
        .trim()
        .toLowerCase()
        .replace(/[^\w\s-]/g, '')
        .replace(/\s+/g, '-');
    },
    
    // ページ外TOC：すべてのページ情報（静的データ）
    getAllPagesTOC: function() {
      // ページ構成を静的に定義する
      return [
        {
          title: "AJMUN 37th 平和への課題：補遺",
          url: "../index.html",
          type: "cover"
        },
        {
          title: "フロント挨拶",
          url: "../content/00_front.html",
          type: "front"
        },
        {
          title: "第1章 プロジェクトの概要",
          url: "../content/01_ch01.html",
          type: "chapter",
          sections: [
            "1.1 はじめに",
            "1.2 プロジェクトの目的",
            "1.2.1 課題認識",
            "1.2.2 解決方針",
            "1.3 技術選定",
            "1.3.1 Quarto + Pandoc",
            "1.3.2 UDP明朝フォント",
            "1.4 プロジェクト構成",
            "1.4.1 ディレクトリ構造",
            "1.4.2 ファイル配置戦略",
            "1.5 開発アプローチ",
            "1.5.1 プログレッシブエンハンスメント",
            "1.5.2 アクセシビリティ優先"
          ]
        },
        {
          title: "第2章 技術的課題と解決策",
          url: "../content/02_ch02.html",
          type: "chapter",
          sections: [
            "2.1 日本語組版の課題",
            "2.1.1 文字エンコーディング",
            "2.1.2 フォントの扱い",
            "2.2 レスポンシブデザイン",
            "2.2.1 標長画面の制約",
            "2.2.2 モバイルへの対応",
            "2.3 パフォーマンスの最適化",
            "2.3.1 読み込み時間の短縮",
            "2.3.2 スムーズな操作感"
          ]
        },
        {
          title: "第3章 実装方針",
          url: "../content/03_ch03.html",
          type: "chapter",
          sections: [
            "3.1 開発アプローチ",
            "3.1.1 プロジェクト構造",
            "3.1.2 ビルドシステム",
            "3.2 技術選択",
            "3.3 品質保証"
          ]
        },
        {
          title: "コラム1：Webフォントの歴史",
          url: "../content/20_col01.html",
          type: "column",
          sections: [
            "デジタルタイポグラフィの発展",
            "画像フォントの時代",
            "Webフォントの登場",
            "日本語対応の課題",
            "サブセット化の重要性"
          ]
        },
        {
          title: "コラム2：アクセシビリティの重要性",
          url: "../content/21_col02.html",
          type: "column",
          sections: [
            "リテラシーの多様性",
            "視覚的配慮",
            "聴覚的配慮",
            "身体的配慮",
            "技術的な実装"
          ]
        },
        {
          title: "第4章 UI/UX設計",
          url: "../content/04_ch04.html",
          type: "chapter",
          sections: [
            "4.1 基本原則",
            "4.2 コンポーネント設計",
            "4.3 アクセシビリティ"
          ]
        },
        {
          title: "第5章 パフォーマンス最適化",
          url: "../content/05_ch05.html",
          type: "chapter",
          sections: [
            "5.1 読み込み速度",
            "5.2 レンダリングの効率化",
            "5.3 キャッシュ戦略"
          ]
        },
        {
          title: "第6章 国連の制度",
          url: "./06_ch06.html",
          type: "chapter",
          sections: [
            "はじめに",
            "第1節 国連という組織",
            "第1項 概要・組織構造",
            "第2項 安全保障理事会",
            "第3項 国連の紛争対処",
            "第4項 安保理決議に基づく義務",
            "コラム 安保理決議の拘束力",
            "第2節 国連財政",
            "第2項 PKO予算",
            "第3節 国連による経済制裁",
            "第1項 国際連合憲章における経済制裁措置",
            "第2項 冷戦下の経済制裁",
            "第3項 冷戦後の経済制裁",
            "第3項 経済制裁に伴う問題とその後",
            "第4項 国連憲章第50条の注解",
            "第4節 国連平和維持活動(PKO)",
            "参考文献"
          ]
        },
        {
          title: "第7章 まとめと展望",
          url: "../content/07_ch07.html",
          type: "chapter",
          sections: [
            "7.1 プロジェクトの成果",
            "7.2 技術的貢献",
            "7.3 今後の発展",
            "まとめ"
          ]
        },
        {
          title: "コラム3：今後の技術動向",
          url: "../content/22_col03.html",
          type: "column",
          sections: [
            "新しい技術の登場",
            "Variable Fonts",
            "Container Queries",
            "Web Components",
            "発展の可能性",
            "PWA化",
            "オフライン対応",
            "マルチデバイス同期"
          ]
        },
        {
          title: "編集後記",
          url: "../content/90_afterword.html",
          type: "appendix",
          sections: [
            "執筆の経緯",
            "技術的な挑戦",
            "フォント埋込",
            "レスポンシブ設計",
            "脚注処理",
            "読者の皆様へ",
            "今後の展望",
            "結びに"
          ]
        },
        {
          title: "参考文献",
          url: "../content/95_references.html",
          type: "appendix"
        },
        {
          title: "索引",
          url: "../content/96_index.html",
          type: "appendix",
          sections: [
            "あ", "う", "か", "こ", "し", "た", "は", "ろ"
          ]
        }
      ];
    },
    
    // ページ内TOCを生成（章内タブ用）
    generatePageTOC: function(maxDepth) {
      const { headings } = this.getPageHeadings();
      
      if (headings.size === 0) {
        return '<p class="toc-empty">このページには見出しがありません。</p>';
      }
      
      // 見出しレベルの階層構造を構築
      const tocStructure = [];
      let currentLevel = 1;
      let currentParents = [tocStructure];
      
      headings.forEach((heading, id) => {
        const headingLevel = heading.level;
        const item = {
          id: id,
          text: heading.text,
          level: headingLevel,
          children: []
        };
        
        // レベルに合わせて親を調整
        while (currentParents.length > headingLevel) {
          currentParents.pop();
        }
        while (currentParents.length <= headingLevel) {
          if (currentParents[currentParents.length - 1] && currentParents[currentParents.length - 1].children) {
            const parent = currentParents[currentParents.length - 1].children;
            parent.push({ level: headingLevel, children: [] });
            currentParents.push(parent[parent.length - 1].children);
          } else {
            currentParents.push([]);
          }
        }
        
        if (currentParents.length > 0) {
          currentParents[currentParents.length - 1].push(item);
        }
      });
      
      return this.renderTOCStructure(tocStructure, maxDepth);
    },
    
    // 全体TOCを生成（全体タブ用）
    generateAllPagesTOC: function() {
      const pages = this.getAllPagesTOC();
      
      let html = '<ul class="custom-toc-list">';
      
      pages.forEach(page => {
        const activeClass = page.url.includes(window.location.pathname.replace(/\/[^\/]+\..+$/, '').split('/').pop()) ? 'active' : '';
        
        html += `<li class="custom-toc-item ${activeClass}" data-type="${page.type}">`;
        html += `<a href="${page.url}" class="custom-toc-link ${activeClass}">${page.title}</a>`;
        
        if (page.sections && page.sections.length > 0) {
          html += '<ul class="custom-toc-child-list">';
          page.sections.forEach(sectionName => {
            const sectionId = this.generateIdFromText(sectionName);
            html += `<li class="custom-toc-child-item"><a href="${page.url}#${sectionId}" class="custom-toc-child-link">${sectionName}</a></li>`;
          });
          html += '</ul>';
        }
        
        html += '</li>';
      });
      
      html += '</ul>';
      return html;
    },
    
    // TOC構造をHTMLに変換
    renderTOCStructure: function(structure, maxDepth = Infinity) {
      let html = '<ul class="custom-toc-list">';
      
      function renderItems(items, currentDepth = 1) {
        let resultHtml = '';
        
        items.forEach(item => {
          if (Array.isArray(item)) {
            // レベルが配列の場合の子要素
            if (currentDepth <= maxDepth) {
              resultHtml += '<ul class="custom-toc-child-list">';
              item.forEach(childItem => {
                resultHtml += renderItems([childItem], currentDepth + 1);
              });
              resultHtml += '</ul>';
            }
          } else if (item && item.id) {
            // 見出しアイテム
            const activeClass = document.getElementById(item.id)?.classList.contains('active') ? 'active' : '';
            resultHtml += `<li class="custom-toc-item level-${item.level} ${activeClass}">`;
            resultHtml += `<a href="#${item.id}" class="custom-toc-link ${activeClass}">${item.text}</a>`;
            
            if (item.children && item.children.length > 0 && currentDepth < maxDepth) {
              resultHtml += '<ul class="custom-toc-child-list">';
              item.children.forEach(child => {
                resultHtml += renderItems([child], currentDepth + 1);
              });
              resultHtml += '</ul>';
            }
            
            resultHtml += '</li>';
          }
        });
        
        return resultHtml;
      }
      
      structure.forEach(item => {
        html += renderItems([item], 1);
      });
      
      html += '</ul>';
      return html;
    },
    
    // TOCを初期化
    initializeCustomTOC: function() {
      // 章内タブ用TOC
      const pageTOCPanel = document.querySelector('.toc-page-content');
      if (pageTOCPanel) {
        const pageTOC = this.generatePageTOC(Infinity);
        pageTOCPanel.innerHTML = pageTOC;
      }
      
      // 全体タブ用TOC
      const allTOCPanel = document.querySelector('.toc-all-content');
      if (allTOCPanel) {
        const allTOC = this.generateAllPagesTOC();
        allTOCPanel.innerHTML = allTOC;
        
        // 階層折りたたみ機能
        this.setupTOCToggling(allTOCPanel);
      }
    },
    
    // TOCの階層展開/折りたたみ機能
    setupTOCToggling: function(container) {
      const toggleButtons = container.querySelectorAll('.custom-toc-item > .custom-toc-link');
      
      toggleButtons.forEach(link => {
        const listItem = link.closest('.custom-toc-item');
        const childList = listItem.querySelector('.custom-toc-child-list');
        
        if (childList) {
          // 開閉ボタンを追加
          const toggleBtn = document.createElement('span');
          toggleBtn.className = 'custom-toc-toggle';
          toggleBtn.textContent = '▾';
          
          link.parentNode.insertBefore(toggleBtn, link);
          link.style.paddingLeft = '20px';
          
          // 第4階層以下はデフォルトで折りたたむ
          const level = parseInt(listItem.className.match(/level-(\d+)/)?.[1] || 1, 10);
          const collapsed = level >= 4;
          
          if (collapsed) {
            childList.style.display = 'none';
            toggleBtn.textContent = '▸';
          }
          
          toggleBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            const isCollapsed = childList.style.display === 'none';
            childList.style.display = isCollapsed ? '' : 'none';
            toggleBtn.textContent = isCollapsed ? '▾' : '▸';
          });
          
          // 親リンクのクリック動作
          link.addEventListener('click', (e) => {
            e.stopPropagation();
          });
        }
      });
    }
  };

  // コメントエクスポート/インポート
  function exportComments(pageOnly) {
    try {
      const data = pageOnly ? { [pageKey()]: COMMENTS_DB[pageKey()]||[] } : COMMENTS_DB;
      const blob = new Blob([JSON.stringify({ version:'1.0', exportedAt: new Date().toISOString(), data }, null, 2)], { type:'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const base = pageOnly ? (pageKey().split('/').pop()||'page') : 'all';
      a.download = `comments_${base}_${new Date().toISOString().slice(0,10)}.json`;
      document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
    } catch (e) { alert('コメント出力に失敗しました'); }
  }
  function importCommentsFromFile(file) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const json = JSON.parse(reader.result);
        const incoming = json.data || {};
        // マージ
        Object.keys(incoming).forEach(k => {
          if (!Array.isArray(incoming[k])) return;
          if (!COMMENTS_DB[k]) COMMENTS_DB[k] = [];
          const existingIds = new Set(COMMENTS_DB[k].map(r=>r.id));
          incoming[k].forEach(rec => { if (!existingIds.has(rec.id)) COMMENTS_DB[k].push(rec); });
        });
        saveComments();
        refreshRightPanels();
        alert('コメントをインポートしました');
      } catch (e) {
        alert('コメント読込に失敗しました');
      }
    };
    reader.readAsText(file, 'utf-8');
  }

})();
</script>




</body></html>